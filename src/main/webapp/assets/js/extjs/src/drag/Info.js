Ext.define("Ext.drag.Info",{requires:["Ext.Promise"],constructor:function(a,g){if(!a){return;}var i=this,k=a.getLocal(),c,d,h,l,m,j,f,b;i.source=a;i.local=k;m=i.getEventXY(g);f=g.getXY();c=a.getElement();b=c.getXY();m=k?c.getLocalXY():b;l=m[0];j=m[1];i.initialEvent=g;i.eventTarget=g.target;i.cursor={current:{x:l,y:j},delta:{x:0,y:0},initial:{x:f[0],y:f[1]},offset:{x:f[0]-b[0],y:f[1]-b[1]}};
i.element={current:{x:l,y:j},delta:{x:0,y:0},initial:{x:l,y:j}};i.proxy={instance:a.getProxy(),current:{x:l,y:j},delta:{x:0,y:0},initial:{x:l,y:j},element:c,isUnderCursor:false,isElement:true};i.types=[];i.data={};a.describe(i);h=i.proxy;d=h.instance.setupElement(i);h.isElement=d===a.getElement();h.element=d;
if(d){h.width=d.getWidth();h.height=d.getHeight();}if(h.isElement){c=i.element;c.current=h.current;c.delta=h.delta;}i.needsCursorCheck=h.element&&a.manager&&a.manager.pointerBug;},cursor:null,element:null,eventTarget:null,files:null,isNative:false,proxy:null,source:null,target:null,types:null,valid:false,clearData:function(a){Ext.Array.remove(this.types,a);
delete this.data[a];},clone:function(){var b=this,a=new Ext.drag.Info();a.cursor=Ext.merge({},b.cursor);a.data=Ext.apply({},b.data);a.element=Ext.merge({},b.element);a.eventTarget=b.eventTarget;a.proxy=Ext.merge({},b.proxy);a.source=b.source;a.target=b.target;a.types=Ext.Array.clone(b.types);a.valid=b.valid;
return a;},getData:function(b){var d=this,e=d.data,c=d.dataTransfer,a;if(c){a=c.getData(b);}else{if(!d.finalized){Ext.raise("Unable to call getData until the drop is complete");}a=e[b];if(typeof a==="function"){e[b]=a=a.call(d.source,d);}if(!a&&a!==0){a="";}}return Ext.Promise.resolve(a);},setData:function(a,b){Ext.Array.include(this.types,a);
this.data[a]=b;},destroy:function(){var a=this;a.eventTarget=a.data=a.proxy=a.targetMap=a.targetMap=a.types=a.elementMap=a.possibleTargets=a.target=null;a.callParent();},privates:{data:null,dataTransfer:null,elementMap:null,possibleTargets:null,targetMap:null,copyNativeData:function(c,b){var a=b.browserEvent.dataTransfer;
this.target=c;this.dataTransfer=a;this.files=a.files;},finalize:function(){var a=this,b=a.target;a.finalized=true;if(b){b.info=null;b.handleDrop(a);}},getAlignXY:function(h,f){var e=this,a=e.source,b=e.cursor.offset,d=a.getProxy(),c=e.proxy.element,g=a.getConstrain(),i=[h,f];if(c){if(e.proxy.isElement){i[0]-=b.x;
i[1]-=b.y;}else{i=d.adjustCursorOffset(e,i);}if(g){i=g.constrain(i,e);}}return i;},getEventXY:function(c){var b=c.getXY(),a=this.source;if(this.local){b=a.convertToLocalXY(b);}return b;},onNativeDragEnter:function(c,b){var a=this;a.valid=c.accepts(a);c.info=a;a.copyNativeData(c,b);},onNativeDragLeave:function(c,b){var a=this;
if(a.target===c){c.info=null;a.valid=false;a.target=a.dataTransfer=a.files=null;}},onNativeDragMove:function(b,a){this.copyNativeData(b,a);},onNativeDrop:function(b,a){this.copyNativeData(b,a);b.info=null;},setActive:function(d){var a=this,b=a.source,c=a.target,e=c!==d;if(c&&e){c.handleDragLeave(a);c.info=null;
}a.target=d;if(d){if(e){a.valid=!!a.possibleTargets[d.getId()]&&d.accepts(a)!==false;d.handleDragEnter(a);d.info=a;}d.handleDragMove(a);}else{a.valid=false;}if(e){b.getProxy().update(a);}},update:function(a,k){var i=this,o=i.getEventXY(a),l=o[0],j=o[1],b=i.getAlignXY(l,j),e=b[0],d=b[1],c=i.proxy,n=i.cursor,g=n.current,m=n.delta,f=n.initial,h=c.instance;
g.x=l;g.y=j;m.x=l-f.x;m.y=j-f.y;g=c.current;m=c.delta;f=c.initial;g.x=e;g.y=d;m.x=e-f.x;m.y=d-f.y;if(i.needsCursorCheck){c.isUnderCursor=!(l<e||j<d||l>c.width+e||j>c.height+d);}if(!k&&h){h.setXY(i,b);}}}});