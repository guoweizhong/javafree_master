Ext.define("Ext.util.TaskRunner",{interval:10,timerId:null,constructor:function(a){var b=this;if(typeof a=="number"){b.interval=a;}else{if(a){Ext.apply(b,a);}}b.tasks=[];b.timerFn=Ext.Function.bind(b.onTick,b);},newTask:function(b){var a=new Ext.util.TaskRunner.Task(b);a.manager=this;return a;},start:function(a){var c=this,b=Ext.Date.now();
if(!a.pending){c.tasks.push(a);a.pending=true;}a.stopped=false;a.taskStartTime=b;a.taskRunTime=a.fireOnStart!==false?0:a.taskStartTime;a.taskRunCount=0;if(!c.firing){if(a.fireOnStart!==false){c.startTimer(0,b);}else{c.startTimer(a.interval,b);}}return a;},stop:function(b,e){var d=this,f=d.tasks,a=0,c;
if(!b.stopped){b.stopped=true;b.pending=false;if(b.onStop){b.onStop.call(b.scope||b,b);}}if(e){Ext.Array.remove(f,b);}for(c=0;!a&&c<f.length;c++){if(!f[c].stopped){a++;}}if(!a){clearTimeout(d.timerId);d.timerId=null;}return b;},stopAll:function(b){var a=this;Ext.each(this.tasks,function(c){a.stop(c,b);
},null,true);},firing:false,nextExpires:1e+99,onTick:function(){var o=this,f=o.tasks,q=o.fireIdleEvent,a=Ext.Date.now(),p=1e+99,k=f.length,d=Ext.GlobalEvents,c,n,h,b,e,g,m;o.timerId=null;o.firing=true;for(h=0;h<k||h<(k=f.length);++h){b=f[h];if(!(g=b.stopped)){c=b.taskRunTime+b.interval;if(c<=a){e=1;if(b.hasOwnProperty("fireIdleEvent")){q=b.fireIdleEvent;
}else{q=o.fireIdleEvent;}b.taskRunCount++;if(b.args){m=b.addCountToArgs?b.args.concat([b.taskRunCount]):b.args;}else{m=[b.taskRunCount];}if(o.disableTryCatch){e=b.run.apply(b.scope||b,m);}else{try{e=b.run.apply(b.scope||b,m);}catch(j){try{Ext.log({fn:b.run,prefix:"Error while running task",stack:j.stack,msg:j,level:"error"});
if(b.onError){e=b.onError.call(b.scope||b,b,j);}}catch(l){}}}b.taskRunTime=a;if(e===false||b.taskRunCount===b.repeat){o.stop(b);g=true;}else{g=b.stopped;c=a+b.interval;}}if(!g&&b.duration&&b.duration<=(a-b.taskStartTime)){o.stop(b);g=true;}}if(g){b.pending=false;if(!n){n=f.slice(0,h);}}else{if(n){n.push(b);
}if(p>c){p=c;}}}if(n){o.tasks=n;}o.firing=false;if(o.tasks.length){o.startTimer(p-a,Ext.Date.now());}if(q!==false&&d.hasListeners.idle){d.fireEvent("idle");}},startTimer:function(e,c){var d=this,b=c+e,a=d.timerId;if(a&&d.nextExpires-b>d.interval){clearTimeout(a);a=null;}if(!a){if(e<d.interval){e=d.interval;
}d.timerId=Ext.defer(d.timerFn,e);d.nextExpires=b;}}},function(){var b=this,a=b.prototype;a.destroy=a.stopAll;b.Task=new Ext.Class({isTask:true,stopped:true,fireOnStart:false,constructor:function(c){Ext.apply(this,c);},restart:function(c){if(c!==undefined){this.interval=c;}this.manager.start(this);},start:function(c){if(this.stopped){this.restart(c);
}},stop:function(c){this.manager.stop(this,c);},destroy:function(){this.stop(true);}});a=b.Task.prototype;a.destroy=a.stop;});