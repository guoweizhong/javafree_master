Ext.define("Ext.util.XTemplateParser",{requires:["Ext.String"],constructor:function(a){Ext.apply(this,a);},doTpl:Ext.emptyFn,parse:function(l){var v=this,p=l.length,o={elseif:"elif"},q=v.topRe,c=v.actionsRe,e,d,i,n,g,j,h,u,r,b,f,a,k;v.level=0;v.stack=d=[];for(e=0;e<p;e=b){q.lastIndex=e;n=q.exec(l);if(!n){v.doText(l.substring(e,p));
break;}r=n.index;b=q.lastIndex;if(e<r){i=l.substring(e,r);if(!(k&&Ext.String.trim(i)==="")){v.doText(i);}}k=false;if(n[1]){b=l.indexOf("%}",r+2);v.doEval(l.substring(r+2,b));b+=2;}else{if(n[2]){b=l.indexOf("]}",r+2);v.doExpr(l.substring(r+2,b));b+=2;}else{if(n[3]){v.doTag(n[3]);}else{if(n[4]){f=null;
while((u=c.exec(n[4]))!==null){i=u[2]||u[3];if(i){i=Ext.String.htmlDecode(i);g=u[1];g=o[g]||g;f=f||{};j=f[g];if(typeof j=="string"){f[g]=[j,i];}else{if(j){f[g].push(i);}else{f[g]=i;}}}}if(!f){if(v.elseRe.test(n[4])){v.doElse();}else{if(v.defaultRe.test(n[4])){v.doDefault();}else{v.doTpl();d.push({type:"tpl"});
}}}else{if(f["if"]){v.doIf(f["if"],f);d.push({type:"if"});}else{if(f["switch"]){v.doSwitch(f["switch"],f);d.push({type:"switch"});k=true;}else{if(f["case"]){v.doCase(f["case"],f);}else{if(f["elif"]){v.doElseIf(f["elif"],f);}else{if(f["for"]){++v.level;if(a=v.propRe.exec(n[4])){f.propName=a[1]||a[2];}v.doFor(f["for"],f);
d.push({type:"for",actions:f});}else{if(f["foreach"]){++v.level;if(a=v.propRe.exec(n[4])){f.propName=a[1]||a[2];}v.doForEach(f["foreach"],f);d.push({type:"foreach",actions:f});}else{if(f.exec){v.doExec(f.exec,f);d.push({type:"exec",actions:f});}}}}}}}}}else{if(n[0].length===5){d.push({type:"tpl"});}else{h=d.pop();
v.doEnd(h.type,h.actions);if(h.type=="for"||h.type=="foreach"){--v.level;}}}}}}}},topRe:/(?:(\{\%)|(\{\[)|\{([^{}]+)\})|(?:<tpl([^>]*)\>)|(?:<\/tpl>)/g,actionsRe:/\s*(elif|elseif|if|for|foreach|exec|switch|case|eval|between)\s*\=\s*(?:(?:"([^"]*)")|(?:'([^']*)'))\s*/g,propRe:/prop=(?:(?:"([^"]*)")|(?:'([^']*)'))/,defaultRe:/^\s*default\s*$/,elseRe:/^\s*else\s*$/});
