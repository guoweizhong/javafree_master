Ext.define("Ext.util.LocalStorage",{id:null,destroyed:false,lazyKeys:true,prefix:"",session:false,_keys:null,_store:null,_users:0,statics:{cache:{},get:function(e){var d=this,b=d.cache,c={_users:1},a;if(Ext.isString(e)){c.id=e;}else{Ext.apply(c,e);}if(!(a=b[c.id])){a=new d(c);}else{if(a===true){Ext.raise('Creating a shared instance of private local store "'+d.id+'".');
}++a._users;}return a;},supported:true},constructor:function(a){var b=this;Ext.apply(b,a);if(!b.hasOwnProperty("id")){Ext.raise("No id was provided to the local store.");}if(b._users){Ext.util.LocalStorage.cache[b.id]=b;}else{if(Ext.util.LocalStorage.cache[b.id]){Ext.raise('Cannot create duplicate instance of local store "'+b.id+'". Use Ext.util.LocalStorage.get() to share instances.');
}Ext.util.LocalStorage.cache[b.id]=true;}b.init();},init:function(){var a=this,b=a.id;if(!a.prefix&&b){a.prefix=b+"-";}a._store=(a.session?window.sessionStorage:window.localStorage);},destroy:function(){var a=this;if(a._users){Ext.log.warn("LocalStorage(id="+a.id+") destroyed while in use");}delete Ext.util.LocalStorage.cache[a.id];
a._store=a._keys=null;a.callParent();},getKeys:function(){var e=this,a=e._store,f=e.prefix,d=e._keys,g=f.length,c,b;if(!d){e._keys=d=[];for(c=a.length;c--;){b=a.key(c);if(b.length>g){if(f===b.substring(0,g)){d.push(b.substring(g));}}}}return d;},release:function(){if(!--this._users){this.destroy();}},save:Ext.emptyFn,clear:function(){var d=this,a=d._store,e=d.prefix,c=d._keys||d.getKeys(),b;
for(b=c.length;b--;){a.removeItem(e+c[b]);}c.length=0;},key:function(a){var b=this._keys||this.getKeys();return(0<=a&&a<b.length)?b[a]:null;},getItem:function(b){var a=this.prefix+b;return this._store.getItem(a);},removeItem:function(c){var f=this,b=f.prefix+c,a=f._store,e=f._keys,d=a.length;a.removeItem(b);
if(e&&d!==a.length){if(f.lazyKeys){f._keys=null;}else{Ext.Array.remove(e,c);}}},setItem:function(c,g){var f=this,b=f.prefix+c,a=f._store,e=a.length,d=f._keys;a.setItem(b,g);if(d&&e!==a.length){d.push(c);}}},function(){var a=this;if("localStorage" in window){return;}if(!Ext.isIE){a.supported=false;a.prototype.init=function(){Ext.raise("Local storage is not supported on this browser");
};return;}a.override({data:null,flushDelay:1,init:function(){var c=this,d=c.data,b;c.el=b=document.createElement("div");b.id=(c.id||(c.id="extjs-localstore"));b.addBehavior("#default#userdata");Ext.getHead().dom.appendChild(b);b.load(c.id);d=b.getAttribute("xdata");c.data=d=(d?Ext.decode(d):{});c._flushFn=function(){c._timer=null;
c.save(0);};},destroy:function(){var c=this,b=c.el;if(b){if(c._timer){c.save();}b.parentNode.removeChild(b);c.data=c.el=null;c.callParent();}},getKeys:function(){var c=this,b=c._keys;if(!b){c._keys=b=Ext.Object.getKeys(c.data);}return b;},save:function(b){var c=this;if(!b){if(c._timer){clearTimeout(c._timer);
c._timer=null;}c.el.setAttribute("xdata",Ext.encode(c.data));c.el.save(c.id);}else{if(!c._timer){c._timer=Ext.defer(c._flushFn,b);}}},clear:function(){var b=this;b.data={};b._keys=null;b.save(b.flushDelay);},getItem:function(b){var c=this.data;return(b in c)?c[b]:null;},removeItem:function(b){var d=this,c=d._keys,e=d.data;
if(b in e){delete e[b];if(c){if(d.lazyKeys){d._keys=null;}else{Ext.Array.remove(c,b);}}d.save(d.flushDelay);}},setItem:function(b,f){var d=this,e=d.data,c=d._keys;if(c&&!(b in e)){c.push(b);}e[b]=f;d.save(d.flushDelay);}});});