Ext.define("Ext.ux.DataView.Animated",{alias:"plugin.ux-animated-dataview",defaults:{duration:750,idProperty:"id"},constructor:function(a){Ext.apply(this,a||{},this.defaults);},init:function(a){var e=this,d=a.store,c=a.all,b={interval:20},g=e.duration;e.dataview=a;a.blockRefresh=true;a.updateIndexes=Ext.Function.createSequence(a.updateIndexes,function(){this.getTargetEl().select(this.itemSelector).each(function(i,j,h){i.dom.id=Ext.util.Format.format("{0}-{1}",a.id,d.getAt(h).internalId);
},this);},a);e.dataviewID=a.id;e.cachedStoreData={};e.cacheStoreData(d.data||d.snapshot);a.on("resize",function(){var h=a.store;if(h.getCount()>0){}},this);a.store.on({datachanged:f,scope:this,buffer:50});function f(){var k=a.getTargetEl(),p=k.getY(),q=k.getPadding("t"),m=e.getAdded(d),w=e.getRemoved(d),r=e.getRemaining(d),y,v,t,o=new Ext.dom.Fly(),l=e.dataview.getInherited().rtl,u,h,n=l?"right":"left",s={};
if(!k){return;}Ext.iterate(w,function(A,i){t=e.dataviewID+"-"+A;Ext.fx.Manager.stopAnimation(t);i.dom=Ext.getDom(t);if(!i.dom){delete w[A];}});e.cacheStoreData(d);var j={},z={};Ext.iterate(r,function(A,i){if(o.attach(Ext.getDom(e.dataviewID+"-"+A))){u=j[A]={top:o.getY()-p-o.getMargin("t")-q};u[n]=e.getItemX(o);
}else{delete r[A];}});a.refresh();Ext.iterate(w,function(A,i){k.dom.appendChild(i.dom);o.attach(i.dom).animate({duration:g,opacity:0,callback:function(C){var B=Ext.get(C.target.id);if(B){B.destroy();}}});delete i.dom;});if(!d.getCount()){return;}y=c.slice();for(v=y.length-1;v>=0;v--){t=d.getAt(v).internalId;
o.attach(y[v]);z[t]={dom:o.dom,top:o.getY()-p-o.getMargin("t")-q};z[t][n]=e.getItemX(o);h=j[t]||z[t];s.position="absolute";s.top=h.top+"px";s[n]=h.left+"px";o.applyStyles(s);}var x=function(){var H=new Date()-b.taskStartTime,J=H/g;if(J>=1){s.position=s.top=s[n]="";for(t in z){o.attach(z[t].dom).applyStyles(s);
}Ext.TaskManager.stop(b);}else{for(t in r){var B=j[t],E=z[t],C=B.top,F=E.top,A=B[n],G=E[n],D=J*Math.abs(C-F),I=J*Math.abs(A-G),K=C>F?C-D:C+D,i=A>G?A-I:A+I;s.top=K+"px";s[n]=i+"px";o.attach(E.dom).applyStyles(s);}}};Ext.iterate(m,function(A,i){if(o.attach(Ext.getDom(e.dataviewID+"-"+A))){o.setOpacity(0);
o.animate({duration:g,opacity:1});}});Ext.TaskManager.stop(b);b.run=x;Ext.TaskManager.start(b);e.cacheStoreData(d);}},getItemX:function(b){var c=this.dataview.getInherited().rtl,a=b.up("");if(c){return a.getViewRegion().right-b.getRegion().right+b.getMargin("r");}else{return b.getX()-a.getX()-b.getMargin("l")-a.getPadding("l");
}},cacheStoreData:function(a){var b=this.cachedStoreData={};a.each(function(c){b[c.internalId]=c;});},getExisting:function(){return this.cachedStoreData;},getExistingCount:function(){var c=0,b=this.getExisting();for(var a in b){c++;}return c;},getAdded:function(a){var c=this.cachedStoreData,b={};a.each(function(d){if(c[d.internalId]==null){b[d.internalId]=d;
}});return b;},getRemoved:function(a){var b=this.cachedStoreData,c={},d;for(d in b){if(a.findBy(function(e){return e.internalId==d;})==-1){c[d]=b[d];}}return c;},getRemaining:function(a){var c=this.cachedStoreData,b={};a.each(function(d){if(c[d.internalId]!=null){b[d.internalId]=d;}});return b;}});