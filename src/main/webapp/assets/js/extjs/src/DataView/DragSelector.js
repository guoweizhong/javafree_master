Ext.define("Ext.ux.DataView.DragSelector",{requires:["Ext.dd.DragTracker","Ext.util.Region"],init:function(b){var a=b.getScrollable();if(a&&(a.getX()||a.getY())&&(Ext.supports.PointerEvents||Ext.supports.MSPointerEvents)){Ext.log.warn("DragSelector not available on PointerEvent devices");return;}this.dataview=b;
b.mon(b,{beforecontainerclick:this.cancelClick,scope:this,render:{fn:this.onRender,scope:this,single:true}});},onRender:function(){this.tracker=Ext.create("Ext.dd.DragTracker",{dataview:this.dataview,el:this.dataview.el,onBeforeStart:this.onBeforeStart,onStart:this.onStart.bind(this),onDrag:this.onDrag.bind(this),onEnd:Ext.Function.createDelayed(this.onEnd,100,this)});
this.dragRegion=Ext.create("Ext.util.Region");},onBeforeStart:function(a){return a.target===this.dataview.getEl().dom;},onStart:function(b){var a=this.dataview;this.dragging=true;this.fillRegions();this.getProxy().show();a.getSelectionModel().deselectAll();},cancelClick:function(){return !this.dragging;
},onDrag:function(k){var j=this.dataview.getSelectionModel(),p=this.dragRegion,o=this.bodyRegion,m=this.getProxy(),f=this.regions,b=f.length,l=this.tracker.startXY,r=this.tracker.getXY(),d=Math.min(l[0],r[0]),c=Math.min(l[1],r[1]),a=Math.abs(l[0]-r[0]),q=Math.abs(l[1]-r[1]),n,g,h;Ext.apply(p,{top:c,left:d,right:d+a,bottom:c+q});
p.constrainTo(o);m.setBox(p);for(h=0;h<b;h++){n=f[h];g=p.intersect(n);if(g){j.select(h,true);}else{j.deselect(h);}}},onEnd:function(c){var a=this.dataview,b=a.getSelectionModel();this.dragging=false;this.getProxy().hide();},getProxy:function(){if(!this.proxy){this.proxy=this.dataview.getEl().createChild({tag:"div",cls:"x-view-selector"});
}return this.proxy;},fillRegions:function(){var a=this.dataview,b=this.regions=[];a.all.each(function(c){b.push(c.getRegion());});this.bodyRegion=a.getEl().getRegion();}});