Ext.define("Ext.ux.DataView.Draggable",{requires:"Ext.dd.DragZone",ghostCls:"x-dataview-draggable-ghost",ghostTpl:['<tpl for=".">',"{title}","</tpl>"],init:function(a,b){this.dataview=a;a.on("render",this.onRender,this);Ext.apply(this,{itemSelector:a.itemSelector,ghostConfig:{}},b||{});Ext.applyIf(this.ghostConfig,{itemSelector:"img",cls:this.ghostCls,tpl:this.ghostTpl});
},onRender:function(){var b=this,a=Ext.apply({},b.ddConfig||{},{dvDraggable:b,dataview:b.dataview,getDragData:b.getDragData,getTreeNode:b.getTreeNode,afterRepair:b.afterRepair,getRepairXY:b.getRepairXY});b.dragZone=Ext.create("Ext.dd.DragZone",b.dataview.getEl(),a);b.dataview.setItemsDraggable(true);
},getDragData:function(h){var a=this.dvDraggable,b=this.dataview,c=b.getSelectionModel(),g=h.getTarget(a.itemSelector),d,f;if(g){h.preventDefault();if(!b.isSelected(g)){c.select(b.getRecord(g));}d=b.getSelectedNodes();f={copy:true,nodes:d,records:c.getSelection(),item:true};if(d.length===1){f.single=true;
f.ddel=g;}else{f.multi=true;f.ddel=a.prepareGhost(c.getSelection());}return f;}return false;},getTreeNode:function(){},afterRepair:function(){this.dragging=false;var a=this.dragData.nodes,c=a.length,b;for(b=0;b<c;b++){Ext.get(a[b]).frame("#8db2e3",1);}},getRepairXY:function(c){if(this.dragData.multi){return false;
}else{var a=Ext.get(this.dragData.ddel),b=a.getXY();b[0]+=a.getPadding("t")+a.getMargin("t");b[1]+=a.getPadding("l")+a.getMargin("l");return b;}},prepareGhost:function(a){return this.createGhost(a).getEl().dom;},createGhost:function(b){var c=this,a;if(c.ghost){(a=c.ghost.store).loadRecords(b);}else{a=Ext.create("Ext.data.Store",{model:b[0].self});
a.loadRecords(b);c.ghost=Ext.create("Ext.view.View",Ext.apply({renderTo:document.createElement("div"),store:a},c.ghostConfig));c.ghost.container.skipGarbageCollection=c.ghost.el.skipGarbageCollection=true;}a.clearData();return c.ghost;},destroy:function(){var a=this.ghost;if(a){a.container.destroy();
a.destroy();}this.callParent();}});