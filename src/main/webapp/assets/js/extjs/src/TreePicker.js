Ext.define("Ext.ux.TreePicker",{extend:"Ext.form.field.Picker",xtype:"treepicker",uses:["Ext.tree.Panel"],triggerCls:Ext.baseCSSPrefix+"form-arrow-trigger",config:{store:null,displayField:null,columns:null,selectOnTab:true,maxPickerHeight:300,minPickerHeight:100},editable:false,initComponent:function(){var a=this;
a.callParent(arguments);a.mon(a.store,{scope:a,load:a.onLoad,update:a.onUpdate});},createPicker:function(){var c=this,b=new Ext.tree.Panel({baseCls:Ext.baseCSSPrefix+"boundlist",shrinkWrapDock:2,store:c.store,floating:true,displayField:c.displayField,columns:c.columns,minHeight:c.minPickerHeight,maxHeight:c.maxPickerHeight,manageHeight:false,shadow:false,listeners:{scope:c,itemclick:c.onItemClick,itemkeydown:c.onPickerKeyDown}}),a=b.getView();
if(Ext.isIE9&&Ext.isStrict){a.on({scope:c,highlightitem:c.repaintPickerView,unhighlightitem:c.repaintPickerView,afteritemexpand:c.repaintPickerView,afteritemcollapse:c.repaintPickerView});}return b;},repaintPickerView:function(){var a=this.picker.getView().getEl().dom.style;a.display=a.display;},onItemClick:function(b,a,c,f,d){this.selectItem(a);
},onPickerKeyDown:function(b,a,f,c,g){var d=g.getKey();if(d===g.ENTER||(d===g.TAB&&this.selectOnTab)){this.selectItem(a);}},selectItem:function(a){var b=this;b.setValue(a.getId());b.fireEvent("select",b,a);b.collapse();},onExpand:function(){var b=this.picker,a=b.store,d=this.value,c;if(d){c=a.getNodeById(d);
}if(!c){c=a.getRoot();}b.ensureVisible(c,{select:true,focus:true});},setValue:function(c){var b=this,a;b.value=c;if(b.store.loading){return b;}a=c?b.store.getNodeById(c):b.store.getRoot();if(c===undefined){a=b.store.getRoot();b.value=a.getId();}else{a=b.store.getNodeById(c);}b.setRawValue(a?a.get(b.displayField):"");
return b;},getSubmitValue:function(){return this.value;},getValue:function(){return this.value;},onLoad:function(){var a=this.value;if(a){this.setValue(a);}},onUpdate:function(a,e,b,c){var d=this.displayField;if(b==="edit"&&c&&Ext.Array.contains(c,d)&&this.value===e.getId()){this.setRawValue(e.get(d));
}}});