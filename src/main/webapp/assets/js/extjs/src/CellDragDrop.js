Ext.define("Ext.ux.CellDragDrop",{extend:"Ext.plugin.Abstract",alias:"plugin.celldragdrop",uses:["Ext.view.DragZone"],enforceType:false,applyEmptyText:false,emptyText:"",dropBackgroundColor:"green",noDropBackgroundColor:"red",dragText:"{0} selected row{1}",ddGroup:"GridDD",enableDrop:true,enableDrag:true,containerScroll:false,init:function(a){var b=this;
a.on("render",b.onViewRender,b,{single:true});},destroy:function(){var a=this;a.dragZone=a.dropZone=Ext.destroy(a.dragZone,a.dropZone);a.callParent();},enable:function(){var a=this;if(a.dragZone){a.dragZone.unlock();}if(a.dropZone){a.dropZone.unlock();}a.callParent();},disable:function(){var a=this;if(a.dragZone){a.dragZone.lock();
}if(a.dropZone){a.dropZone.lock();}a.callParent();},onViewRender:function(a){var b=this,c;if(b.enableDrag){if(b.containerScroll){c=a.getEl();}b.dragZone=new Ext.view.DragZone({view:a,ddGroup:b.dragGroup||b.ddGroup,dragText:b.dragText,containerScroll:b.containerScroll,scrollEl:c,getDragData:function(j){var h=this.view,i=j.getTarget(h.getItemSelector()),g=h.getRecord(i),f=j.getTarget(h.getCellSelector()),d,k;
if(i){d=document.createElement("div");d.className="x-form-text";d.appendChild(document.createTextNode(f.textContent||f.innerText));k=h.getHeaderByCell(f);return{event:new Ext.EventObjectImpl(j),ddel:d,item:j.target,columnName:k.dataIndex,record:g};}},onInitDrag:function(e,k){var h=this,j=h.dragData,g=h.view,d=g.getSelectionModel(),f=j.record,i=j.ddel;
if(!d.isSelected(f)){d.select(f,true);}Ext.fly(h.ddel).update(i.textContent||i.innerText);h.proxy.update(h.ddel);h.onStartDrag(e,k);return true;}});}if(b.enableDrop){b.dropZone=new Ext.dd.DropZone(a.el,{view:a,ddGroup:b.dropGroup||b.ddGroup,containerScroll:true,getTargetFromEvent:function(h){var g=this,f=g.view,d=h.getTarget(f.cellSelector),i,j;
if(d){i=f.findItemByChild(d);j=f.getHeaderByCell(d);if(i&&j){return{node:d,record:f.getRecord(i),columnName:j.dataIndex};}}},onNodeEnter:function(k,d,j,i){var f=this,h=k.record.getField(k.columnName).type.toUpperCase(),g=i.record.getField(i.columnName).type.toUpperCase();delete f.dropOK;if(!k||k.node===i.item.parentNode){return;
}if(b.enforceType&&h!==g){f.dropOK=false;if(b.noDropCls){Ext.fly(k.node).addCls(b.noDropCls);}else{Ext.fly(k.node).applyStyles({backgroundColor:b.noDropBackgroundColor});}return false;}f.dropOK=true;if(b.dropCls){Ext.fly(k.node).addCls(b.dropCls);}else{Ext.fly(k.node).applyStyles({backgroundColor:b.dropBackgroundColor});
}},onNodeOver:function(h,d,g,f){return this.dropOK?this.dropAllowed:this.dropNotAllowed;},onNodeOut:function(i,d,h,g){var f=this.dropOK?b.dropCls:b.noDropCls;if(f){Ext.fly(i.node).removeCls(f);}else{Ext.fly(i.node).applyStyles({backgroundColor:""});}},onNodeDrop:function(h,d,g,f){if(this.dropOK){h.record.set(h.columnName,f.record.get(f.columnName));
if(b.applyEmptyText){f.record.set(f.columnName,b.emptyText);}return true;}},onCellDrop:Ext.emptyFn});}}});