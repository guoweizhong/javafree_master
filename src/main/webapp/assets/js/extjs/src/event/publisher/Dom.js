Ext.define("Ext.event.publisher.Dom",{extend:"Ext.event.publisher.Publisher",requires:["Ext.event.Event"],type:"dom",handledDomEvents:[],reEnterCount:0,captureEvents:{animationstart:1,animationend:1,resize:1,focus:1,blur:1},directEvents:{mouseenter:1,mouseleave:1,pointerenter:1,pointerleave:1,MSPointerEnter:1,MSPointerLeave:1,load:1,unload:1,beforeunload:1,error:1,DOMContentLoaded:1,DOMFrameContentLoaded:1,hashchange:1,scroll:1,online:1,offline:1},blockedPointerEvents:{pointerover:1,pointerout:1,pointerenter:1,pointerleave:1,MSPointerOver:1,MSPointerOut:1,MSPointerEnter:1,MSPointerLeave:1},blockedCompatibilityMouseEvents:{mouseenter:1,mouseleave:1},constructor:function(){var b=this,a=Ext.supports.PassiveEventListener;
b.listenerOptions=a?{passive:false}:false;b.captureOptions=a?{passive:false,capture:true}:true;b.bubbleSubscribers={};b.captureSubscribers={};b.directSubscribers={};b.directCaptureSubscribers={};b.delegatedListeners={};b.initHandlers();Ext.onInternalReady(b.onReady,b);b.callParent();b.registerDomEvents();
},registerDomEvents:function(){var f=this,d=Ext.event.publisher.Publisher.publishersByEvent,a=f.handledDomEvents,e=a.length,c,b;for(c=0;c<e;c++){b=a[c];f.handles[b]=1;d[b]=f;}},onReady:function(){var d=this,a=d.handledDomEvents,c,b;if(a){for(b=0,c=a.length;b<c;b++){d.addDelegatedListener(a[b]);}}Ext.getWin().on("unload",d.destroy,d,{priority:-10000});
},initHandlers:function(){var a=this;a.onDelegatedEvent=Ext.bind(a.onDelegatedEvent,a);a.onDirectEvent=Ext.bind(a.onDirectEvent,a);a.onDirectCaptureEvent=Ext.bind(a.onDirectCaptureEvent,a);},addDelegatedListener:function(a){var b=this;b.delegatedListeners[a]=1;b.target.addEventListener(a,b.onDelegatedEvent,b.captureEvents[a]?b.captureOptions:b.listenerOptions);
},removeDelegatedListener:function(a){var b=this;delete b.delegatedListeners[a];b.target.removeEventListener(a,b.onDelegatedEvent,b.captureEvents[a]?b.captureOptions:b.listenerOptions);},addDirectListener:function(b,c,a){var d=this;c.dom.addEventListener(b,a?d.onDirectCaptureEvent:d.onDirectEvent,a?d.captureOptions:d.listenerOptions);
},removeDirectListener:function(b,c,a){var d=this;c.dom.removeEventListener(b,a?d.onDirectCaptureEvent:d.onDirectEvent,a?d.captureOptions:d.listenerOptions);},subscribe:function(c,b,f,a){var d=this,e,g;if(f&&!d.directEvents[b]){e=a?d.captureSubscribers:d.bubbleSubscribers;if(!d.handles[b]&&!d.delegatedListeners[b]){d.addDelegatedListener(b);
}if(e[b]){++e[b];}else{e[b]=1;}}else{e=a?d.directCaptureSubscribers:d.directSubscribers;g=c.id;e=e[b]||(e[b]={});if(e[g]){++e[g];}else{e[g]=1;d.addDirectListener(b,c,a);}}},unsubscribe:function(e,f,b,i){var h=this,g,d,a,c;if(b&&!h.directEvents[f]){g=h.captureSubscribers;d=h.bubbleSubscribers;a=i?g:d;
if(a[f]){--a[f];}if(!h.handles[f]&&!d[f]&&!g[f]){this.removeDelegatedListener(f);}}else{a=i?h.directCaptureSubscribers:h.directSubscribers;c=e.id;a=a[f];if(a[c]){--a[c];}if(!a[c]){delete a[c];h.removeDirectListener(f,e,i);}}},getPropagatingTargets:function(d){var c=d,b=[],a;while(c){b.push(c);a=c.parentNode;
if(!a){a=c.defaultView;}c=a;}return b;},publish:function(k,g,b){var n=this,l=false,c=false,q,o,h,a,f,m,d,p;b=b||false;if(!g){if(k instanceof Array){Ext.raise("Propagation targets must be supplied when publishing an array of events.");}h=k.target;if(n.captureEvents[k.type]){a=Ext.cache[h.id];g=a?[a]:[];
}else{g=n.getPropagatingTargets(h);}}q=Ext.Array.from(k);m=g.length;p=q.length;for(f=0;f<p;f++){o=q[f].type;if(!l&&n.captureSubscribers[o]){l=true;}if(!c&&n.bubbleSubscribers[o]){c=true;}}if(l){for(f=m;f--;){a=Ext.cache[g[f].id];if(a){for(d=0;d<p;d++){k=q[d];n.fire(a,k.type,k,false,true);if(!b&&k.claimed){b=true;
d=n.filterClaimed(q,k);p=q.length;}if(k.stopped){q.splice(d,1);d--;p--;}}}}}if(c&&!k.stopped){for(f=0;f<m;f++){a=Ext.cache[g[f].id];if(a){for(d=0;d<p;d++){k=q[d];n.fire(a,k.type,k,false,false);if(!b&&k.claimed&&n.filterClaimed){b=true;d=n.filterClaimed(q,k);p=q.length;}if(k.stopped){q.splice(d,1);d--;
p--;}}}}}},publishDelegatedDomEvent:function(a){this.publish(a);},fire:function(c,b,f,g,a){var d;if(c.hasListeners[b]){d=c.events[b];if(d){if(a&&g){d=d.directCaptures;}else{if(a){d=d.captures;}else{if(g){d=d.directs;}}}if(d){f.setCurrentTarget(c.dom);d.fire(f,f.target);}}}},onDelegatedEvent:function(a){if(Ext.elevateFunction){Ext.elevateFunction(this.doDelegatedEvent,this,[a]);
}else{this.doDelegatedEvent(a);}},doDelegatedEvent:function(c){var b=this,a;c=new Ext.event.Event(c);a=c.time;if(!b.isEventBlocked(c)){b.beforeEvent(c);Ext.frameStartTime=a;b.reEnterCountAdjusted=false;b.reEnterCount++;b.publishDelegatedDomEvent(c);if(!b.reEnterCountAdjusted){b.reEnterCount--;}b.afterEvent(c);
}},onDirectEvent:function(a){if(Ext.elevateFunction){Ext.elevateFunction(this.doDirectEvent,this,[a,false]);}else{this.doDirectEvent(a,false);}},onDirectCaptureEvent:function(a){if(Ext.elevateFunction){Ext.elevateFunction(this.doDirectEvent,this,[a,true]);}else{this.doDirectEvent(a,true);}},doDirectEvent:function(g,b){var d=this,f=g.currentTarget,a,c;
g=new Ext.event.Event(g);a=g.time;if(d.isEventBlocked(g)){return;}d.beforeEvent(g);Ext.frameStartTime=a;c=Ext.cache[f.id];if(c){d.reEnterCountAdjusted=false;d.reEnterCount++;d.fire(c,g.type,g,true,b);if(!d.reEnterCountAdjusted){d.reEnterCount--;}}d.afterEvent(g);},beforeEvent:function(c){var f=c.browserEvent,a=Ext.event.publisher.Dom,b,d;
if(f.type==="touchstart"){b=f.touches;if(b.length===1){d=b[0];a.lastTouchStartX=d.pageX;a.lastTouchStartY=d.pageY;}}},afterEvent:function(d){var f=d.browserEvent,c=f.type,b=Ext.event.publisher.Dom,a=Ext.GlobalEvents;if(d.self.pointerEvents[c]&&d.pointerType!=="mouse"){b.lastScreenPointerEventTime=Ext.now();
}if(c==="touchend"){b.lastTouchEndTime=Ext.now();}if(!this.reEnterCount&&a.hasListeners.idle&&!a.idleEventMask[c]){a.fireEvent("idle");}},isEventBlocked:function(f){var d=this,c=f.type,a=Ext.event.publisher.Dom,b=Ext.now();if(Ext.isGecko&&f.type==="click"&&f.button===2){return true;}return(d.blockedPointerEvents[c]&&f.pointerType!=="mouse")||(d.blockedCompatibilityMouseEvents[c]&&(b-a.lastScreenPointerEventTime<1000))||(Ext.supports.TouchEvents&&f.self.mouseEvents[f.type]&&Math.abs(f.pageX-a.lastTouchStartX)<15&&Math.abs(f.pageY-a.lastTouchStartY)<15&&(Ext.now()-a.lastTouchEndTime)<1000);
},destroy:function(){var b=Ext.dom["GarbageCollector"],a;for(a in this.delegatedListeners){this.removeDelegatedListener(a);}Ext.Reaper.flush();if(b){b.collect();}this.callParent();},reset:function(){var a=Ext.event.publisher.Dom;a.lastScreenPointerEventTime=a.lastTouchEndTime=a.lastTouchStartX=a.lastTouchStartY=undefined;
}},function(b){var d=document,c=d.defaultView,a=b.prototype;if((Ext.os.is.iOS&&Ext.os.version.getMajor()<5)||Ext.browser.is.AndroidStock||!(c&&c.addEventListener)){a.target=d;}else{a.target=c;}b.instance=new b();});