Ext.define("Ext.event.gesture.Drag",{extend:"Ext.event.gesture.SingleTouch",priority:100,startPoint:null,previousPoint:null,lastPoint:null,handledEvents:["dragstart","drag","dragend","dragcancel"],config:{minDistance:8},constructor:function(){this.callParent(arguments);this.initInfo();},initInfo:function(){this.info={touch:null,previous:{x:0,y:0},x:0,y:0,delta:{x:0,y:0},absDelta:{x:0,y:0},flick:{velocity:{x:0,y:0}},direction:{x:0,y:0},time:0,previousTime:{x:0,y:0},longpress:false};
},onTouchStart:function(c){var b=this,a=b.callParent([c]);if(a!==false){b.startTime=c.time;b.startPoint=c.changedTouches[0].point;}return a;},tryDragStart:function(c){var b=this,a=c.changedTouches[0].point,f=b.getMinDistance(),d=Ext.Element.getViewportScale(),g=Math.round(Math.abs(a.getDistanceTo(b.startPoint)*d));
if(g>=f){b.doDragStart(c);}},doDragStart:function(g,b){var c=this,h=g.changedTouches[0],a=h.point,f=c.info,d;if(b){d=Ext.now();c.startTime=d;c.startPoint=a;f.longpress=true;}else{d=g.time;}c.isStarted=true;c.previousPoint=c.lastPoint=a;c.resetInfo("x",g,h);c.resetInfo("y",g,h);f.time=d;c.fire("dragstart",g,f);
},onTouchMove:function(c){var b=this,d,a;if(!b.startPoint){return;}if(!b.isStarted){b.tryDragStart(c);}if(!b.isStarted){return;}d=c.changedTouches[0];a=d.point;if(b.lastPoint){b.previousPoint=b.lastPoint;}b.lastPoint=a;b.lastMoveEvent=c;b.updateInfo("x",c,d);b.updateInfo("y",c,d);b.info.time=c.time;b.fire("drag",c,b.info);
},onAxisDragEnd:function(a,c){var b=c.time-c.previousTime[a];if(b>0){c.flick.velocity[a]=(c[a]-c.previous[a])/b;}},resetInfo:function(c,g,f){var h=this,i=h.lastPoint[c],a=h.startPoint[c],j=i-a,d=c.toUpperCase(),b=h.info;b.touch=f;b.delta[c]=j;b.absDelta[c]=Math.abs(j);b.previousTime[c]=h.startTime;b.previous[c]=a;
b[c]=i;b.direction[c]=0;b["start"+d]=h.startPoint[c];b["previous"+d]=b.previous[c];b["page"+d]=b[c];b["delta"+d]=b.delta[c];b["absDelta"+d]=b.absDelta[c];b["previousDelta"+d]=0;b.startTime=h.startTime;},updateInfo:function(d,i,h){var j=this,l=j.lastPoint[d],f=j.previousPoint[d],a=j.startPoint[d],m=l-a,c=j.info,k=c.direction,g=d.toUpperCase(),b=c.previous[d];
c.touch=h;c.delta[d]=m;c.absDelta[d]=Math.abs(m);if(l!==b&&l!==c[d]){c.previous[d]=c[d];c.previousTime[d]=c.time;}c[d]=l;if(l>f){k[d]=1;}else{if(l<f){k[d]=-1;}}c["start"+g]=a;c["previous"+g]=c.previous[d];c["page"+g]=c[d];c["delta"+g]=c.delta[d];c["absDelta"+g]=c.absDelta[d];c["previousDelta"+g]=c.previous[d]-a;
c.startTime=j.startTime;},onTouchEnd:function(d){var b=this,f,a,c;if(b.isStarted){f=d.changedTouches[0];a=f.point;c=b.info;b.lastPoint=a;b.updateInfo("x",d,f);b.updateInfo("y",d,f);c.time=d.time;b.onAxisDragEnd("x",c);b.onAxisDragEnd("y",c);b.fire("dragend",d,c);}return this.callParent([d]);},onCancel:function(c){var a=this,d=c.changedTouches[0],b=a.info;
if(!c.touches.length){a.lastPoint=d.point;}a.updateInfo("x",c,d);a.updateInfo("y",c,d);b.time=c.time;a.fire("dragcancel",c,b,true);},reset:function(){var a=this;a.lastPoint=a.startPoint=a.previousPoint=a.lastPoint=a.lastMoveEvent=null;a.initInfo();return a.callParent();}},function(a){var b=Ext.manifest.gestures;
a.instance=new a(b&&b.drag);});