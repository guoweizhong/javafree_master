Ext.define("Ext.list.Tree",{extend:"Ext.Gadget",xtype:"treelist",mixins:["Ext.mixin.ItemRippler"],requires:["Ext.list.RootTreeItem"],expanderFirstCls:Ext.baseCSSPrefix+"treelist-expander-first",expanderOnlyCls:Ext.baseCSSPrefix+"treelist-expander-only",highlightPathCls:Ext.baseCSSPrefix+"treelist-highlight-path",microCls:Ext.baseCSSPrefix+"treelist-micro",uiPrefix:Ext.baseCSSPrefix+"treelist-",element:{reference:"element",cls:Ext.baseCSSPrefix+"treelist "+Ext.baseCSSPrefix+"unselectable",listeners:{click:"onClick",touchstart:"onTouchStart",touchend:"onTouchEnd",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseover:"onMouseOver"},children:[{reference:"toolsElement",cls:Ext.baseCSSPrefix+"treelist-toolstrip",listeners:{click:"onToolStripClick",mouseover:"onToolStripMouseOver"}}]},cachedConfig:{animation:{duration:500,easing:"ease"},expanderFirst:true,expanderOnly:true},config:{defaults:{xtype:"treelistitem"},highlightPath:null,iconSize:null,indent:null,micro:false,overItem:null,selection:null,selectOnExpander:false,singleExpand:null,store:null,ui:null},twoWayBindable:{selection:1},publishes:{selection:1},defaultBindProperty:"store",constructor:function(a){this.callParent([a]);
this.publishState("selection",this.getSelection());},destroy:function(){var a=this;a.unfloatAll();a.activeFloater=null;a.setSelection(null);a.setStore(null);a.callParent();},updateOverItem:function(f,a){var e={},d=2,g,b;for(g=f;g;g=this.getItem(b.parentNode)){b=g.getNode();e[b.internalId]=true;g.setOver(d);
d=1;}if(a&&!a.destroyed){for(g=a;g;g=this.getItem(b.parentNode)){b=g.getNode();if(e[b.internalId]){break;}g.setOver(0);}}},applyMicro:function(a){return Boolean(a);},applySelection:function(c,a){var b=this.getStore();if(!b){c=null;}if(b&&c!==null&&!(c instanceof Ext.data.Model)){c=b.getNodeById(c);}if(c&&c.get("selectable")===false){c=a;
}return c;},updateSelection:function(c,a){var e=this,d,b;if(!e.destroying){d=e.getItem(a);if(d){d.setSelected(false);}d=e.getItem(c);if(d){d.setSelected(true);while(b=d.getParentItem()){b.setExpanded(true);d=b;}}e.fireEvent("selectionchange",e,c);}},applyStore:function(a){return a&&Ext.StoreManager.lookup(a,"tree");
},updateStore:function(b,d){var c=this,a;if(d){if(!d.destroyed){if(d.getAutoDestroy()){d.destroy();}else{c.storeListeners.destroy();}}c.removeRoot();c.storeListeners=null;}if(b){c.storeListeners=b.on({destroyable:true,scope:c,filterchange:"onFilterChange",nodeappend:"onNodeAppend",nodecollapse:"onNodeCollapse",nodeexpand:"onNodeExpand",nodeinsert:"onNodeInsert",noderemove:"onNodeRemove",rootchange:"onRootChange",update:"onNodeUpdate"});
a=b.getRoot();if(a){c.createRootItem(a);}}if(!c.destroying){c.updateLayout();}},updateExpanderFirst:function(a){this.element.toggleCls(this.expanderFirstCls,a);},updateExpanderOnly:function(a){this.element.toggleCls(this.expanderOnlyCls,!a);},updateHighlightPath:function(a){this.element.toggleCls(this.highlightPathCls,a);
},updateMicro:function(a){var b=this;if(!a){b.unfloatAll();b.activeFloater=null;}b.element.toggleCls(b.microCls,a);},updateUi:function(e,a){var d=this,c=d.element,b=d.uiPrefix;if(a){c.removeCls(b+a);}if(e){c.addCls(b+e);}delete d.iconSize;d.syncIconSize();},getItem:function(b){var c=this.itemMap,a;if(b&&c){a=c[b.internalId];
}return a||null;},getItemConfig:function(b,a){return Ext.apply({parentItem:a.isRootListItem?null:a,owner:this,node:b,indent:this.getIndent()},this.getDefaults());},privates:{checkForOutsideClick:function(b){var a=this.activeFloater;if(!a.element.contains(b.target)){this.unfloatAll();}},collapsingForExpand:false,createItem:function(f,b){var e=this,d=Ext.create(e.getItemConfig(f,b)),g=e.toolsElement,a,c;
if(b.isRootListItem){a=d.getToolElement();if(a){c=e.findVisiblePreviousSibling(f);if(!c){g.insertFirst(a);}else{c=e.getItem(c);a.insertAfter(c.getToolElement());}a.dom.setAttribute("data-recordId",f.internalId);a.isTool=true;}}e.itemMap[f.internalId]=d;return d;},createRootItem:function(a){var c=this,b;
c.itemMap={};c.rootItem=b=new Ext.list.RootTreeItem({indent:c.getIndent(),node:a,owner:c});c.element.appendChild(b.element);c.itemMap[a.internalId]=b;},findVisiblePreviousSibling:function(b){var a=b.previousSibling;while(a){if(a.data.visible){return a;}a=a.previousSibling;}return null;},floatItem:function(d,b){var c=this,a;
if(d.getFloated()){return;}if(c.toolMouseListeners){c.toolMouseListeners.destroy();c.floaterMouseListeners.destroy();c.floaterMouseListeners=c.toolMouseListeners=null;}c.unfloatAll();c.activeFloater=a=d;c.floatedByHover=b;d.setFloated(true);if(b){c.toolMouseListeners=d.getToolElement().monitorMouseLeave(300,c.checkForMouseLeave,c);
c.floaterMouseListeners=(d.floater||d).el.monitorMouseLeave(300,c.checkForMouseLeave,c);a.element.on("mouseover","onMouseOver",c);}else{Ext.on("mousedown","checkForOutsideClick",c);}},shouldRippleItem:function(a,b){if(a&&a.getSelected()){return false;}return this.mixins.itemrippler.shouldRippleItem.call(this,a,b);
},onTouchStart:function(a){this.doItemRipple(a);},onTouchEnd:function(a){this.doItemRipple(a);},doItemRipple:function(c){var b=this,a=c.getTarget("[data-recordId]"),d;if(a){d=a.getAttribute("data-recordId");a=b.itemMap[d];if(a&&b.shouldRippleItem(a,c)){this.rippleItem(a,c);}}},onClick:function(b){var a=b.getTarget("[data-recordId]"),c;
if(a){c=a.getAttribute("data-recordId");a=this.itemMap[c];if(a){a.onClick(b);}}},onMouseEnter:function(a){this.onMouseOver(a);},onMouseLeave:function(){this.setOverItem(null);},onMouseOver:function(b){var a=Ext.Component.from(b);this.setOverItem(a&&a.isTreeListItem&&a);},checkForMouseLeave:function(c){var b=this.activeFloater,a=c.getRelatedTarget();
if(b){if(a!==b.getToolElement().dom&&!b.element.contains(a)){this.unfloatAll();}}},onFilterChange:function(a){this.onRootChange(a.getRoot());},onNodeAppend:function(a,c){if(a){var b=this.itemMap[a.internalId];if(b){b.nodeInsert(c,null);}}},onNodeCollapse:function(b){var a=this.itemMap[b.internalId];if(a){a.nodeCollapse(b,this.collapsingForExpand);
}},onNodeExpand:function(f){var e=this,d=e.itemMap[f.internalId],g,b,c,a,h;if(d){if(!d.isRootItem&&e.getSingleExpand()){e.collapsingForExpand=true;a=(d.getParentItem()||e.rootItem).getNode();g=a.childNodes;for(c=0,b=g.length;c<b;++c){h=g[c];if(h!==f){h.collapse();}}e.collapsing=false;}d.nodeExpand(f);
}},onNodeInsert:function(a,d,b){var c=this.itemMap[a.internalId];if(c){c.nodeInsert(d,b);}},onNodeRemove:function(a,d,b){if(a&&!b){var c=this.itemMap[a.internalId];if(c){c.nodeRemove(d);}}},onNodeUpdate:function(a,e,b,d){var c=this.itemMap[e.internalId];if(c){c.nodeUpdate(e,d);}},onRootChange:function(a){var b=this;
b.removeRoot();if(a){b.createRootItem(a);}b.updateLayout();b.fireEvent("refresh",b);},removeItem:function(c){var d=this.itemMap,e=c.internalId,b,a;if(d){b=d[e];if(b.getParentItem()===null){a=b.getToolElement();if(a){this.toolsElement.removeChild(a);}}delete d[e];}},removeRoot:function(){var b=this,a=b.rootItem;
if(a){b.element.removeChild(a.element);b.rootItem=b.itemMap=Ext.destroy(a);}},onToolStripClick:function(b){var a=b.getTarget("[data-recordId]"),c;if(a){c=a.getAttribute("data-recordId");a=this.itemMap[c];if(a){if(a===this.activeFloater){this.unfloatAll();}else{this.floatItem(a,false);}}}},onToolStripMouseOver:function(b){var a=b.getTarget("[data-recordId]"),c;
if(a){c=a.getAttribute("data-recordId");a=this.itemMap[c];if(a){this.floatItem(a,true);}}},syncIconSize:function(){var b=this,a=b.iconSize||(b.iconSize=parseInt(b.element.getStyle("background-position"),10));b.setIconSize(a);},unfloatAll:function(){var b=this,a=b.activeFloater;if(a){a.setFloated(false);
b.activeFloater=null;if(b.floatedByHover){if(b.toolMouseListeners){b.toolMouseListeners.destroy();b.floaterMouseListeners.destroy();b.floaterMouseListeners=b.toolMouseListeners=null;}a.element.un("mouseover","onMouseOver",b);}else{Ext.un("mousedown","checkForOutsideClick",b);}}},defaultIconSize:22,updateIconSize:function(a){this.setIndent(a||this.defaultIconSize);
},updateIndent:function(b){var a=this.rootItem;if(a){a.setIndent(b);}}}});