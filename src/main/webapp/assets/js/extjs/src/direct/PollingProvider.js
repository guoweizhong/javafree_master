Ext.define("Ext.direct.PollingProvider",{extend:"Ext.direct.JsonProvider",alias:"direct.pollingprovider",requires:["Ext.Ajax","Ext.util.TaskRunner","Ext.direct.ExceptionEvent"],type:"polling",interval:3000,constructor:function(a){var b=this;b.callParent([a]);b.pollTask=Ext.TaskManager.newTask({run:b.runPoll,interval:b.interval,scope:b});
},destroy:function(){this.pollTask.stop(true);this.callParent();},doConnect:function(){var c=this,a=c.url,b=c.pollFn;if(b&&Ext.isString(b)){var d=b;c.pollFn=b=Ext.direct.Manager.parseMethod(b);if(!Ext.isFunction(b)){Ext.raise("Cannot resolve Ext Direct API method "+d+" for PollingProvider");}}else{if(Ext.isFunction(a)){Ext.log.warn("Using a function for url is deprecated, use pollFn instead.");
c.pollFn=b=a;c.url=a=null;}}if(a||b){c.setInterval(c.interval);c.pollTask.start();}},doDisconnect:function(){if(this.pollTask){this.pollTask.stop();}},getInterval:function(){return this.pollTask&&this.pollTask.interval;},setInterval:function(a){var b=this,c=b.pollTask;if(a<100){Ext.raise("Attempting to configure PollProvider "+b.id+" with interval that is less than 100ms.");
}b.interval=c.interval=a;if(b.isConnected()){c.restart(a);}},runPoll:function(){var e=this,b=e.url,c=e.pollFn,f=e.baseParams,a,d;if(e.fireEvent("beforepoll",e)!==false){if(c){a=c.directCfg.method.getArgs({params:f!==undefined?f:{},callback:e.onPollFn,scope:e});c.apply(window,a);}else{d={url:b,callback:e.onData,scope:e,params:f,headers:e.getHeaders()};
if(e.timeout!=null){d.timeout=e.timeout;}e.sendAjaxRequest(d);}e.fireEvent("poll",e);}},onData:function(e,h,b){var g=this,d,a,c,f;if(h){c=g.createEvents(b);for(d=0,a=c.length;d<a;++d){f=c[d];g.fireEvent("data",g,f);if(!f.status){g.fireEvent("exception",g,f);}}}else{f=new Ext.direct.ExceptionEvent({data:null,code:Ext.direct.Manager.exceptions.TRANSPORT,message:"Unable to connect to the server.",xhr:b});
g.fireEvent("data",g,f);g.fireEvent("exception",g,f);}g.callParent([e,h,b]);},onPollFn:function(a,c,d,b){this.onData(null,d,{responseText:a});},inheritableStatics:{checkConfig:function(a){return a&&a.type==="polling"&&(a.url||a.pollFn);}}});