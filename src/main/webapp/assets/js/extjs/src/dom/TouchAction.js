Ext.define("Ext.dom.TouchAction",{singleton:true,requires:["Ext.dom.Element","Ext.util.Point"],lastTouchStartTime:0,minMoveDistance:8,spaceRe:/\s+/,preventSingle:null,preventMulti:null,disabledOverflowDom:null,panXCls:Ext.baseCSSPrefix+"touch-action-pan-x",panYCls:Ext.baseCSSPrefix+"touch-action-pan-y",cssValues:["none","pan-x","pan-y","pan-x pan-y","pinch-zoom","pan-x pinch-zoom","pan-y pinch-zoom","pan-x pan-y pinch-zoom","double-tap-zoom","pan-x double-tap-zoom","pan-y double-tap-zoom","pan-x pan-y double-tap-zoom","pinch-zoom double-tap-zoom","pan-x pinch-zoom double-tap-zoom","pan-y pinch-zoom double-tap-zoom",""],objectValues:[{panX:false,panY:false,pinchZoom:false,doubleTapZoom:false},{panX:true,panY:false,pinchZoom:false,doubleTapZoom:false},{panX:false,panY:true,pinchZoom:false,doubleTapZoom:false},{panX:true,panY:true,pinchZoom:false,doubleTapZoom:false},{panX:false,panY:false,pinchZoom:true,doubleTapZoom:false},{panX:true,panY:false,pinchZoom:true,doubleTapZoom:false},{panX:false,panY:true,pinchZoom:true,doubleTapZoom:false},{panX:true,panY:true,pinchZoom:true,doubleTapZoom:false},{panX:false,panY:false,pinchZoom:false,doubleTapZoom:true},{panX:true,panY:false,pinchZoom:false,doubleTapZoom:true},{panX:false,panY:true,pinchZoom:false,doubleTapZoom:true},{panX:true,panY:true,pinchZoom:false,doubleTapZoom:true},{panX:false,panY:false,pinchZoom:true,doubleTapZoom:true},{panX:true,panY:false,pinchZoom:true,doubleTapZoom:true},{panX:false,panY:true,pinchZoom:true,doubleTapZoom:true},{panX:true,panY:true,pinchZoom:true,doubleTapZoom:true}],attributeName:"data-extTouchAction",constructor:function(){var e=this,a=Ext.supports;
if(a.TouchAction){e.cssProp="touch-action";}else{if(a.MSPointerEvents){e.cssProp="-ms-touch-action";}}if(a.TouchEvents){Ext.getWin().on({touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",scope:e,translate:false,capture:true,priority:5000});Ext.on({scroll:"onScroll",scope:e,destroyable:true});
}if(Ext.isFunction(Object.freeze)){var b=e.objectValues;for(var c=0,d=b.length;c<d;c++){Object.freeze(b[c]);}}},containsTargets:function(g,f){var b=true,d=f.type==="touchend"?f.changedTouches:f.touches,a,c;for(a=0,c=d.length;a<c;a++){if(!g.contains(d[a].target)){b=false;break;}}return b;},disableOverflow:function(e,c){var d=this,f=c?"overflow-y":"overflow-x",a,b;
if(!d.disabledOverflowDom&&!Ext.isiOS&&!Ext.getScrollbarSize().width){d.disabledOverflowDom=e;b=c?d.panXCls:d.panYCls;while(e){a=Ext.fly(e).getStyle(f);if(a==="auto"||a==="scroll"){Ext.fly(e).addCls(b);}e=e.parentNode;}}},get:function(c){var a=c.getAttribute(this.attributeName),b=null;if(a!=null){b=this.objectValues[a];
}return b;},getFlags:function(b){var a;if(typeof b==="number"){a=b;}else{a=0;if(b.panX!==false){a|=1;}if(b.panY!==false){a|=2;}if(b.pinchZoom!==false){a|=4;}if(b.doubleTapZoom!==false){a|=8;}}return a;},isScrollable:function(e,b,c){var a=Ext.fly(e).getStyle(b?"overflow-y":"overflow-x"),d=(a==="auto"||a==="scroll");
if(d){if(b){d=c?(e.scrollTop+e.clientHeight)<e.scrollHeight:e.scrollTop>0;}else{d=c?(e.scrollLeft+e.clientWidth)<e.scrollWidth:e.scrollLeft>0;}}return d;},lookupFlags:function(a){return parseInt((a.getAttribute&&a.getAttribute(this.attributeName))||15,10);},onScroll:function(){this.scrollOccurred=true;
this.isDoubleTap=false;},onTouchEnd:function(f){var d=this,g=f.target,a,b,c;a=f.touches.length;if(a===0){if(d.isDoubleTap){while(g){b=d.lookupFlags(g);if(b!=null){c=b&8;if(!c){f.preventDefault();}}g=g.parentNode;}}d.isDoubleTap=false;d.preventSingle=null;d.preventMulti=null;d.resetOverflow();}},onTouchMove:function(k){var l=this,n=null,i=k.target,c,m,q,o,r,b,p,f,a,h,g,j,d;
j=l.preventSingle;d=l.preventMulti;m=k.touches.length;if((m===1&&(j===false))||(d===false)){return;}if((m>1&&(d===true))||(m===1&&(j===true))){n=true;}else{if(m===1){r=k.getPoint();b=l.startPoint;f=Ext.Element.getViewportScale();a=r.getDistanceTo(l.startPoint)*f;h=r.x-b.x;g=r.y-b.y;p=Math.abs(g)>=Math.abs(h);
}while(i&&(i.nodeType===1)){c=l.lookupFlags(i);if(c&0){n=true;}else{if(m===1){q=!!(c&1);o=!!(c&2);if(q&&o){n=false;}else{if(!q&&!o){n=true;}else{if(a>=l.minMoveDistance){n=!!((q&&p)||(o&&!p));}}}if(!n&&l.isScrollable(i,p,(p?g:h)<0)){break;}}else{if(l.containsTargets(i,k)){n=!(c&4);}else{n=false;}}}if(n){break;
}i=i.parentNode;}}if(m===1){l.preventSingle=n;}else{if(m>1){l.preventMulti=n;}}if(n){k.preventDefault();}},onTouchStart:function(g){var d=this,f,c,h,b,a;if(g.touches.length===1){f=g.time;if(!d.scrollOccurred&&((f-d.lastTouchStartTime)<=500)){d.isDoubleTap=true;}d.lastTouchStartTime=f;d.scrollOccurred=false;
d.startPoint=g.getPoint();h=g.target;while(h){c=d.lookupFlags(h);if(c!=null){b=!!(c&1);a=!!(c&2);if(b!==a){d.disableOverflow(h,b);break;}}h=h.parentNode;}}else{d.isDoubleTap=false;}},resetOverflow:function(){var a=this,b=a.disabledOverflowDom;while(b){Ext.fly(b).removeCls([a.panXCls,a.panYCls]);b=b.parentNode;
}a.disabledOverflowDom=null;},set:function(g,f){var e=this,d=e.cssProp,a=e.getFlags(f),c=(a&Ext.supports.TouchAction),b=e.attributeName;if(d){Ext.fly(g).setStyle(d,e.cssValues[c]);}if(a===15){g.removeAttribute(b);}else{g.setAttribute(b,a);}}});