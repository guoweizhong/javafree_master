Ext.define("Ext.mixin.Bindable",{mixinId:"bindable",config:{bind:{$value:null,lazy:true},controller:null,defaultListenerScope:false,publishes:{$value:null,lazy:true,merge:function(b,a){return this.mergeSets(b,a);}},session:{$value:null,lazy:true},twoWayBindable:{$value:null,lazy:true,merge:function(b,a){return this.mergeSets(b,a);
}},viewModel:{$value:null,lazy:true}},defaultBindProperty:null,nameable:false,shareableName:false,reference:null,validRefRe:/^[a-z_][a-z0-9_]*$/i,getReference:function(){return this.reference;},initInheritedState:function(d){var e=this,a=e.reference,b=e.getController(),c=e.getConfig("viewModel",true),g=e.getConfig("session",true),f=e.getDefaultListenerScope();
if(b){d.controller=b;}if(f){d.defaultListenerScope=e;}else{if(b){d.defaultListenerScope=b;}}if(c){if(!c.isViewModel){c=e;}d.viewModel=c;}if(g){if(!g.isSession){g=e;}d.session=g;}if(a){e.referenceKey=(d.referencePath||"")+a;e.viewModelKey=(d.viewModelPath||"")+a;}},isBound:function(a){var b=this.getBind();
return !!(b&&(b[a||this.defaultBindProperty]));},lookupController:function(a){return this.getInheritedConfig("controller",a)||null;},lookupSession:function(a){var b=a?null:this.getSession();if(!b){b=this.getInheritedConfig("session",a);if(b&&!b.isSession){b=b.getInherited().session=b.getSession();}}return b||null;
},lookupViewModel:function(a){var b=a?null:this.getViewModel();if(!b){b=this.getInheritedConfig("viewModel",a);if(b&&!b.isViewModel){b=b.getInherited().viewModel=b.getViewModel();}}return b||null;},publishState:function(j,i){var h=this,b=h.publishedState,e=h.getBind(),g=e&&j&&e[j],f=0,c,a,d,k;if(g&&!g.syncing&&!g.isReadOnly()){if(!(g.calls===0&&(i==null||i===h.getInitialConfig()[j]))){g.setValue(i);
}}if(!(a=h.getPublishes())){return;}if(!(d=h.lookupViewModel())){return;}if(!(k=h.viewModelKey)){return;}b=b||(h.publishedState={});if(arguments.length===2){if(!a[j]){return;}if(!(i&&i.constructor===Object)&&!(i instanceof Array)){if(b[j]===i){return;}}k+=".";k+=j;}else{for(c in a){++f;if(c===j){b[c]=i;
}else{b[c]=h.getConfig(c);}}if(!f){return;}i=b;}d.set(k,i);},privates:{addBindableUpdater:function(c){var b=this,d=b.self.$config.configs,a=d[c],e;if(a&&!b.hasOwnProperty(e=a.names.update)){b[e]=a.bindableUpdater||(a.root.bindableUpdater=b.makeBindableUpdater(a));}},applyBind:function(d,k){if(!d){return d;
}var f=this,i=f.lookupViewModel(),e=f.getTwoWayBindable(),a=f._getBindTemplateScope,g,j,c,h;f.$hasBinds=true;if(!k||typeof k==="string"){k={};}if(!i){Ext.raise("Cannot use bind config without a viewModel");}if(Ext.isString(d)){if(!f.defaultBindProperty){Ext.raise(f.$className+" has no defaultBindProperty - "+"Please specify a bind object");
}g=d;d={};d[f.defaultBindProperty]=g;}for(j in d){c=d[j];g=k[j];if(g&&g.isBinding){g.destroy();g=null;h=true;}if(c){g=i.bind(c,f.onBindNotify,f);g._config=Ext.Config.get(j);g.getTemplateScope=a;if(!f[g._config.names.set]){Ext.raise("Cannot bind "+j+" on "+f.$className+" - missing a "+g._config.names.set+" method.");
}}if(h){delete k[j];}else{k[j]=g;}if(e&&e[j]){if(h){f.clearBindableUpdater(j);}else{if(!g.isReadOnly()){f.addBindableUpdater(j);}}}}return k;},applyController:function(a){if(a){a=Ext.Factory.controller(a);a.setView(this);}this.controller=a;return a;},updatePublishes:function(a){var b=this;if(b.lookupViewModel()){for(var c in a){b.addBindableUpdater(c);
b.publishState(c,b.getConfig(c,false,true));}}return a;},applySession:function(c){if(!c){return null;}if(!c.isSession){var b=this.lookupSession(true),a=(c===true)?{}:c;if(b){c=b.spawn(a);}else{c=new Ext.data["Session"](a);}}return c;},applyViewModel:function(b){var c=this,a,d;if(!b){return null;}if(!b.isViewModel){a={parent:c.lookupViewModel(true),view:c};
a.session=c.getSession();if(!d&&!a.parent){a.session=c.lookupSession();}if(b){if(b.constructor===Object){Ext.apply(a,b);}else{if(typeof b==="string"){a.type=b;}}}b=Ext.Factory.viewModel(a);}return b;},_getBindTemplateScope:function(){return this.scope.resolveListenerScope();},clearBindableUpdater:function(c){var b=this,d=b.self.$config.configs,a=d[c],e;
if(a&&b.hasOwnProperty(e=a.names.update)){if(b[e].$bindableUpdater){delete b[e];}}},destroyBindable:function(){var c=this,b=c.getConfig("viewModel",true),d=c.getConfig("session",true),a=c.getController();if(b&&b.isViewModel){b.destroy();c.setViewModel(null);}if(d&&d.isSession){if(d.getAutoDestroy()){d.destroy();
}c.setSession(null);}if(a){c.setController(null);a.destroy();}},initBindable:function(){var b=this,a=b.controller;b.initBindable=Ext.emptyFn;b.getBind();b.getPublishes();if(!b.viewModel){b.getViewModel();}if(a){a.initBindings();}},makeBindableUpdater:function(a){var c=a.names.update,b=function(f,d){var e=this,g=e.self.prototype[c];
if(g){g.call(e,f,d);}e.publishState(a.name,e[a.getInternalName(e)]);};b.$bindableUpdater=true;return b;},isSyncing:function(b){var d=this.getBind(),a=false,c;if(d){c=d[b];if(c){a=c.syncing>0;}}return a;},onBindNotify:function(b,a,c){c.syncing=(c.syncing+1)||1;this[c._config.names.set](b);--c.syncing;
},removeBindings:function(){var b=this,d,a,c;if(b.$hasBinds){d=b.getBind();if(d&&typeof d!=="string"){for(a in d){c=d[a];c.destroy();c._config=c.getTemplateScope=null;}}}b.setBind(null);},updateSession:function(b){var a=this.getInherited();if(b){a.session=b;}else{delete a.session;}},updateViewModel:function(b){var c=this,d=c.getInherited(),a=c.getController();
if(b){c.hasVM=true;d.viewModel=b;b.setView(c);if(a){a.initViewModel(b);}}else{delete d.viewModel;}c.viewModel=b;}}});