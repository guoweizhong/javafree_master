Ext.define("Ext.AnimationQueue",{singleton:true,constructor:function(){var a=this;a.queue=[];a.taskQueue=[];a.runningQueue=[];a.idleQueue=[];a.isRunning=false;a.isIdle=true;a.run=Ext.Function.bind(a.run,a);if(Ext.os.is.iOS){a.watch.$skipTimerCheck=true;Ext.interval(a.watch,500,a);}},start:function(c,b,a){var d=this;
d.queue.push(arguments);if(!d.isRunning){if(d.hasOwnProperty("idleTimer")){clearTimeout(d.idleTimer);delete d.idleTimer;}if(d.hasOwnProperty("idleQueueTimer")){clearTimeout(d.idleQueueTimer);delete d.idleQueueTimer;}d.isIdle=false;d.isRunning=true;d.startCountTime=Ext.now();d.count=0;d.doStart();}},clear:function(){var a=this;
clearTimeout(a.idleTimer);clearTimeout(a.idleQueueTimer);Ext.Function.cancelAnimationFrame(a.animationFrameId);a.animationFrameId=null;delete a.idleTimer;delete a.idleQueueTimer;a.queue.length=a.taskQueue.length=a.runningQueue.length=a.idleQueue.length=0;a.isRunning=false;a.isIdle=true;a.startCountTime=Ext.now();
a.count=0;},watch:function(){if(this.isRunning&&Ext.now()-this.lastRunTime>=500){this.run();}},run:function(){var g=this;g.animationFrameId=null;if(!g.isRunning){return;}var a=g.runningQueue,b=Ext.now(),d,f;g.lastRunTime=b;g.frameStartTime=b;a.push.apply(a,g.queue);for(d=0,f=a.length;d<f;d++){g.invoke(a[d]);
}a.length=0;var c=g.frameStartTime-g.startCountTime,e=++g.count;if(c>=200){g.onFpsChanged(e*1000/c,e,c);g.startCountTime=g.frameStartTime;g.count=0;}if(g.isRunning){g.doIterate();}},onFpsChanged:Ext.emptyFn,onStop:Ext.emptyFn,doStart:function(){if(!this.animationFrameId){this.animationFrameId=Ext.Function.requestAnimationFrame(this.run);
}this.lastRunTime=Ext.now();},doIterate:function(){if(!this.animationFrameId){this.animationFrameId=Ext.Function.requestAnimationFrame(this.run);}},doStop:function(){if(this.animationFrameId){Ext.Function.cancelAnimationFrame(this.animationFrameId);}this.animationFrameId=null;},stop:function(e,d,b){var h=this;
if(!h.isRunning){return;}var a=h.queue,g=a.length,c,f;for(c=0;c<g;c++){f=a[c];if(f[0]===e&&f[1]===d&&f[2]===b){a.splice(c,1);c--;g--;}}if(g===0){h.doStop();h.onStop();h.isRunning=false;if(h.idleQueue.length&&!h.idleTimer){h.idleTimer=Ext.defer(h.whenIdle,100,h);}}},onIdle:function(e,d,a){var g=this,c=g.idleQueue,b,f,h;
for(b=0,f=c.length;b<f;b++){h=c[b];if(e===h[0]&&d===h[1]&&a===h[2]){return;}}c.push(arguments);if(g.isIdle){g.processIdleQueue();}else{if(!g.idleTimer){g.idleTimer=Ext.defer(g.whenIdle,100,g);}}},unIdle:function(e,d,a){var g=this,c=g.idleQueue,b,f,h;for(b=0,f=c.length;b<f;b++){h=c[b];if(e===h[0]&&d===h[1]&&a===h[2]){c.splice(b,1);
return true;}}if(!c.length&&g.idleTimer){clearTimeout(g.idleTimer);delete g.idleTimer;}if(!c.length&&g.idleQueueTimer){clearTimeout(g.idleQueueTimer);delete g.idleQueueTimer;}return false;},queueTask:function(c,b,a){this.taskQueue.push(arguments);this.processTaskQueue();},dequeueTask:function(e,d,a){var c=this.taskQueue,b,f,g;
for(b=0,f=c.length;b<f;b++){g=c[b];if(e===g[0]&&d===g[1]&&a===g[2]){c.splice(b,1);b--;f--;}}},invoke:function(d){var c=d[0],b=d[1],a=d[2];c=(typeof c=="string"?b[c]:c);if(Ext.isArray(a)){c.apply(b,a);}else{c.call(b,a);}},whenIdle:function(){delete this.idleTimer;this.isIdle=true;this.processIdleQueue();
},processIdleQueue:function(){if(!this.hasOwnProperty("idleQueueTimer")){this.idleQueueTimer=Ext.defer(this.processIdleQueueItem,1,this);}},processIdleQueueItem:function(){delete this.idleQueueTimer;if(!this.isIdle){return;}var a=this.idleQueue,b;if(a.length>0){b=a.shift();this.invoke(b);this.processIdleQueue();
}},processTaskQueue:function(){if(!this.hasOwnProperty("taskQueueTimer")){this.taskQueueTimer=Ext.defer(this.processTaskQueueItem,15,this);}},processTaskQueueItem:function(){delete this.taskQueueTimer;var a=this.taskQueue,b;if(a.length>0){b=a.shift();this.invoke(b);this.processTaskQueue();}},showFps:function(){var a={color:"white","background-color":"black","text-align":"center","font-family":"sans-serif","font-size":"8px","font-weight":"normal","font-style":"normal","line-height":"20px","-webkit-font-smoothing":"antialiased","zIndex":100000,position:"absolute"};
Ext.getBody().append([{style:Ext.applyIf({bottom:"50px",left:0,width:"50px",height:"20px"},a),html:"Average"},{style:Ext.applyIf({"background-color":"red","font-size":"18px","line-height":"50px",bottom:0,left:0,width:"50px",height:"50px"},a),id:"__averageFps",html:"0"},{style:Ext.applyIf({bottom:"50px",left:"50px",width:"50px",height:"20px"},a),html:"Min (Last 1k)"},{style:Ext.applyIf({"background-color":"orange","font-size":"18px","line-height":"50px",bottom:0,left:"50px",width:"50px",height:"50px"},a),id:"__minFps",html:"0"},{style:Ext.applyIf({bottom:"50px",left:"100px",width:"50px",height:"20px"},a),html:"Max (Last 1k)"},{style:Ext.applyIf({"background-color":"maroon","font-size":"18px","line-height":"50px",bottom:0,left:"100px",width:"50px",height:"50px"},a),id:"__maxFps",html:"0"},{style:Ext.applyIf({bottom:"50px",left:"150px",width:"50px",height:"20px"},a),html:"Current"},{style:Ext.applyIf({"background-color":"green","font-size":"18px","line-height":"50px",bottom:0,left:"150px",width:"50px",height:"50px"},a),id:"__currentFps",html:"0"}]);
Ext.AnimationQueue.resetFps();},resetFps:function(){var c=Ext.get("__currentFps"),b=Ext.get("__averageFps"),h=Ext.get("__minFps"),g=Ext.get("__maxFps"),d=1000,a=0,f=0,e=0;if(!c){return;}Ext.AnimationQueue.onFpsChanged=function(i){f++;if(!(f%10)){d=1000;a=0;}e+=i;d=Math.min(d,i);a=Math.max(a,i);c.setHtml(Math.round(i));
b.setHtml(Math.round(e/f));h.setHtml(Math.round(d));g.setHtml(Math.round(a));};}},function(){var a=window.location.search.substr(1),b=a.split("&");if(Ext.Array.contains(b,"showfps")){Ext.onReady(Ext.Function.bind(this.showFps,this));}});