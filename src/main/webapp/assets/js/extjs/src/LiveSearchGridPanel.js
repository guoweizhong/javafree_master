Ext.define("Ext.ux.LiveSearchGridPanel",{extend:"Ext.grid.Panel",requires:["Ext.toolbar.TextItem","Ext.form.field.Checkbox","Ext.form.field.Text","Ext.ux.statusbar.StatusBar"],searchValue:null,matches:[],currentIndex:null,searchRegExp:null,caseSensitive:false,regExpMode:false,matchCls:"x-livesearch-match",defaultStatusText:"Nothing Found",initComponent:function(){var a=this;
a.tbar=["Search",{xtype:"textfield",name:"searchField",hideLabel:true,width:200,listeners:{change:{fn:a.onTextFieldChange,scope:this,buffer:500}}},{xtype:"button",text:"&lt;",tooltip:"Find Previous Row",handler:a.onPreviousClick,scope:a},{xtype:"button",text:"&gt;",tooltip:"Find Next Row",handler:a.onNextClick,scope:a},"-",{xtype:"checkbox",hideLabel:true,margin:"0 0 0 4px",handler:a.regExpToggle,scope:a},"Regular expression",{xtype:"checkbox",hideLabel:true,margin:"0 0 0 4px",handler:a.caseSensitiveToggle,scope:a},"Case sensitive"];
a.bbar=new Ext.ux.StatusBar({defaultText:a.defaultStatusText,name:"searchStatusBar"});a.callParent(arguments);},afterRender:function(){var a=this;a.callParent(arguments);a.textField=a.down("textfield[name=searchField]");a.statusBar=a.down("statusbar[name=searchStatusBar]");a.view.on("cellkeydown",a.focusTextField,a);
},focusTextField:function(b,i,c,a,f,h,g,d){if(g.getKey()===g.S){g.preventDefault();this.textField.focus();}},tagsRe:/<[^>]*>/gm,tagsProtect:"\x0f",getSearchValue:function(){var b=this,c=b.textField.getValue();if(c===""){return null;}if(!b.regExpMode){c=Ext.String.escapeRegex(c);}else{try{new RegExp(c);
}catch(a){b.statusBar.setStatus({text:a.message,iconCls:"x-status-error"});return null;}if(c==="^"||c==="$"){return null;}}return c;},onTextFieldChange:function(){var f=this,e=0,b=f.view,a=b.cellSelector,c=b.innerSelector,d=f.visibleColumnManager.getColumns();b.refresh();f.statusBar.setStatus({text:f.defaultStatusText,iconCls:""});
f.searchValue=f.getSearchValue();f.matches=[];f.currentIndex=null;if(f.searchValue!==null){f.searchRegExp=new RegExp(f.getSearchValue(),"g"+(f.caseSensitive?"":"i"));f.store.each(function(h,g){var i=b.getNode(h);if(i){Ext.Array.forEach(d,function(l){var j=Ext.fly(i).down(l.getCellInnerSelector(),true),n,m,k;
if(j){n=j.innerHTML.match(f.tagsRe);m=j.innerHTML.replace(f.tagsRe,f.tagsProtect);m=m.replace(f.searchRegExp,function(o){++e;if(!k){f.matches.push({record:h,column:l});k=true;}return'<span class="'+f.matchCls+'">'+o+"</span>";},f);Ext.each(n,function(o){m=m.replace(f.tagsProtect,o);});j.innerHTML=m;}});
}},f);if(e){f.currentIndex=0;f.gotoCurrent();f.statusBar.setStatus({text:Ext.String.format("{0} match{1} found.",e,e===1?"es":""),iconCls:"x-status-valid"});}}if(f.currentIndex===null){f.getSelectionModel().deselectAll();f.textField.focus();}},onPreviousClick:function(){var c=this,d=c.matches,b=d.length,a=c.currentIndex;
if(b){c.currentIndex=a===0?b-1:a-1;c.gotoCurrent();}},onNextClick:function(){var c=this,d=c.matches,b=d.length,a=c.currentIndex;if(b){c.currentIndex=a===b-1?0:a+1;c.gotoCurrent();}},caseSensitiveToggle:function(b,a){this.caseSensitive=a;this.onTextFieldChange();},regExpToggle:function(b,a){this.regExpMode=a;
this.onTextFieldChange();},privates:{gotoCurrent:function(){var a=this.matches[this.currentIndex];this.getNavigationModel().setPosition(a.record,a.column);this.getSelectionModel().select(a.record);}}});