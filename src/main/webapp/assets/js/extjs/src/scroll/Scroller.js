Ext.define("Ext.scroll.Scroller",{extend:"Ext.Evented",alias:"scroller.scroller",mixins:["Ext.mixin.Factoryable"],requires:["Ext.util.CSS","Ext.util.translatable.ScrollPosition","Ext.Deferred"],factoryConfig:{defaultType:"scroller"},isScroller:true,config:{direction:undefined,element:undefined,scrollbars:null,snapSelector:null,snapOffset:null,msSnapInterval:null,x:true,y:true,scrollElement:null,size:null,spacerXY:null,touchAction:null},snappableCls:Ext.baseCSSPrefix+"scroller-snappable",elementCls:Ext.baseCSSPrefix+"scroller",spacerCls:Ext.baseCSSPrefix+"scroller-spacer",noScrollbarsCls:Ext.baseCSSPrefix+"no-scrollbars",scrollEndBuffer:100,statics:{create:function(a,b){return Ext.Factory.scroller(a,b);
},getScrollingElement:function(){var e=document,a=this.$standardScrollElement,d=e.scrollingElement,c,b;if(d){return d;}if(a===undefined){c=document.createElement("iframe");c.style.height="1px";document.body.appendChild(c);b=c.contentWindow.document;b.write('<!DOCTYPE html><div style="height:9999em">x</div>');
b.close();a=b.documentElement.scrollHeight>b.body.scrollHeight;c.parentNode.removeChild(c);this.$standardScrollElement=a;}return a?e.documentElement:e.body;},initViewportScroller:function(){var a=Ext.getViewportScroller();if(!a.getElement()){a.setElement(Ext.getBody());}}},constructor:function(a){var b=this;
b.position={x:0,y:0};b.callParent([a]);b.bufferedOnDomScrollEnd=Ext.Function.createBuffered(b.onDomScrollEnd,b.scrollEndBuffer,b);},destroy:function(){var b=this,c=b._partners,a;clearTimeout(b.restoreTimer);clearTimeout(b.bufferedOnDomScrollEnd.timer);b.setX(Ext.emptyString);b.setY(Ext.emptyString);if(b._spacer){b._spacer.destroy();
}if(b.scrollListener){b.scrollListener.destroy();}if(c){for(a in c){b.removePartner(c[a].scroller);}}b.setElement(null);b.bufferedOnDomScrollEnd=b._partners=b.component=null;if(b.translatable){b.translatable.destroy();b.translatable=null;}b.removeSnapStylesheet();b.callParent();},addPartner:function(d,b){var c=this,e=c._partners||(c._partners={}),a=d._partners||(d._partners={});
b=c.axisConfigs[b||"both"];e[d.getId()]={scroller:d,axes:b};a[c.getId()]={scroller:c,axes:b};},applyElement:function(b,a){var c=this;if(a&&c.scrollListener){c.scrollListener.destroy();}if(b){if(typeof b==="string"&&!Ext.get(b)){Ext.raise("Cannot create Ext.scroll.Scroller instance. "+"Element with id '"+b+"' not found.");
}b=Ext.get(b);}return b;},applySize:function(b,c){var a,d;if(b===null||typeof b==="number"){a=d=b;}else{if(b){a=b.x;d=b.y;}}if(a===null){a=0;}else{if(a===undefined){a=(c?c.x:0);}}if(d===null){d=0;}else{if(d===undefined){d=(c?c.y:0);}}if(!c||a!==c.x||d!==c.y){return{x:a,y:d};}},getClientSize:function(){var a=this.getElement().dom;
return{x:a.clientWidth,y:a.clientHeight};},getScrollbarSize:function(){var f=this,b=0,j=0,e=f.getElement(),d,i,h,g,c,a;if(e&&!e.destroyed){i=f.getX();h=f.getY();d=e.dom;if(i||h){a=Ext.getScrollbarSize();}if(i==="scroll"){g=true;}else{if(i){g=d.scrollWidth>d.clientWidth;}}if(h==="scroll"){c=true;}else{if(h){c=d.scrollHeight>d.clientHeight;
}}if(g){j=a.height;}if(c){b=a.width;}}return{width:b,height:j};},getPosition:function(){var a=this;if(a.positionDirty){a.updateDomScrollPosition();}return a.position;},getSize:function(){var b=this.getElement(),a,c;if(b&&!b.destroyed){c=b.dom;a={x:c.scrollWidth,y:c.scrollHeight};}else{a={x:0,y:0};}return a;
},getMaxPosition:function(){var b=this.getElement(),a=0,d=0,c;if(b&&!b.destroyed){c=b.dom;a=c.scrollWidth-c.clientWidth;d=c.scrollHeight-c.clientHeight;}return{x:a,y:d};},getMaxUserPosition:function(){var c=this,b=c.getElement(),a=0,e=0,d;if(b&&!b.destroyed){d=b.dom;if(c.getX()){a=d.scrollWidth-d.clientWidth;
}if(c.getY()){e=d.scrollHeight-d.clientHeight;}}return{x:a,y:e};},refresh:function(){this.positionDirty=true;this.fireEvent("refresh",this);return this;},removePartner:function(b){var c=this._partners,a=b._partners;if(c){delete c[b.getId()];}if(a){delete (a[this.getId()]);}},scrollBy:function(c,b,d){var a=this.getPosition();
if(c){if(c.length){d=b;b=c[1];c=c[0];}else{if(typeof c!=="number"){d=b;b=c.y;c=c.x;}}}c=(typeof c==="number")?c+a.x:null;b=(typeof b==="number")?b+a.y:null;return this.doScrollTo(c,b,d);},scrollIntoView:function(f,h,c,b){var g=this,a=g.getPosition(),e,d;if(f){e=g.getScrollIntoViewXY(f,h);if(e.y!==a.y||e.x!==a.x){if(b){g.on({scrollend:"doHighlight",scope:g,single:true,args:[f,b]});
}d=g.doScrollTo(e.x,e.y,c);}else{if(b){g.doHighlight(f,b);}d=Ext.Deferred.getCachedResolved();}}else{d=Ext.Deferred.getCachedRejected();}return d;},isInView:function(a){return this.doIsInView(a);},scrollTo:function(a,d,b){var c;if(a){if(a.length){b=d;d=a[1];a=a[0];}else{if(typeof a!=="number"){b=d;d=a.y;
a=a.x;}}}if(a<0||d<0){c=this.getMaxPosition();if(a<0){a+=c.x;}if(d<0){d+=c.y;}}return this.doScrollTo(a,d,b);},updateDirection:function(c){var b=this,a,d;if(!c){a=b.getX();d=b.getY();if(a&&d){c=(d==="scroll"&&a==="scroll")?"both":"auto";}else{if(d){c="vertical";}else{if(a){c="horizontal";}}}b._direction=c;
}else{if(c==="auto"){a=true;d=true;}else{if(c==="vertical"){a=false;d=true;}else{if(c==="horizontal"){a=true;d=false;}else{if(c==="both"){a="scroll";d="scroll";}}}}b.setX(a);b.setY(d);}},updateScrollbars:function(a,b){this.syncScrollbarCls();},updateSize:function(d){var e=this,c=e.getElement(),a=d.x,f=d.y,b;
if(c){e.positionDirty=true;b=e.getSpacer();if(!a&&!f){b.hide();}else{if(a>0){a-=1;}if(f>0){f-=1;}e.setSpacerXY({x:a,y:f});b.show();}}},updateMsSnapInterval:function(){this.initMsSnapInterval();},updateSnapSelector:function(){this.initSnap();},updateSnapOffset:function(){this.initSnap();},updateTouchAction:function(b){var a=this.getElement();
if(a){a.setTouchAction(b);}},updateElement:function(b){var c=this,f=c.getTouchAction(),a=c.scrollListener,d,e;if(a){a.destroy();c.scrollListener=null;c.setScrollElement(null);}if(b){if(b.dom===document.documentElement||b.dom===document.body){d=Ext.getWin();e=Ext.scroll.Scroller.getScrollingElement();
}else{e=d=b;}c.setScrollElement(Ext.get(e));c.scrollListener=d.on({scroll:c.onDomScroll,scope:c,destroyable:true});if(f){b.setTouchAction(f);}c.initXStyle();c.initYStyle();b.addCls(c.elementCls);c.initSnap();c.initMsSnapInterval();c.syncScrollbarCls();}},updateX:function(a){this.initXStyle();},updateY:function(a){this.initYStyle();
},deprecated:{"5":{methods:{getScroller:function(){return this;}}},"5.1.0":{methods:{scrollToTop:function(a){return this.scrollTo(0,0,a);},scrollToEnd:function(a){return this.scrollTo(Infinity,Infinity,a);}}}},privates:{axisConfigs:{x:{x:true},y:{y:true},both:{x:true,y:true}},getScrollIntoViewXY:function(d,e,f){var b=this.getPosition(),a=this.component?this.component.getScrollableClientRegion():this.getElement(),c;
c=Ext.fly(d).getScrollIntoViewXY(a,b.x,b.y,f);c.x=(e===false)?b.x:c.x;return c;},getSpacer:function(){var c=this,a=c._spacer,b;if(!a){b=c.getElement();a=c._spacer=b.createChild({cls:c.spacerCls,role:"presentation"},b.dom.firstChild);a.setVisibilityMode(2);a.hide();b.position();}return a;},applySpacerXY:function(b,a){if(a&&b.x===a.x&&b.y===a.y){b=undefined;
}return b;},updateSpacerXY:function(f){var c=this,a=c.getSpacer(),e=a.dom.style,b=f.y,d;e.marginTop="";c.translateSpacer(f.x,c.constrainScrollRange(b));e.lineHeight=Number(!parseInt(e.lineHeight,10))+"px";if(b>1000000){d=b-c.getElement().dom.scrollHeight;if(d>0){e.marginTop=Math.min(d,c.maxSpacerMargin||0)+"px";
}}},translateSpacer:function(a,b){this.getSpacer().translate(a,b);},doIsInView:function(d,f){var e=this,i=e.component,a={x:false,y:false},g,h=e.getElement(),b;if(d&&(f||(h.contains(d)||(i&&i.owns(d))))){b=h.getRegion();g=Ext.fly(d).getRegion();a.x=g.right>b.left&&g.left<b.right;a.y=g.bottom>b.top&&g.top<b.bottom;
}return a;},constrainScrollRange:function(c){if(c<1000000){return c;}if(!this.maxSpacerTranslate){var b=Math.pow(2,32),g=b,e=500,a=Ext.getBody().createChild({style:{position:"absolute",left:"-10000px",top:"0",width:"500px",height:"500px"},cn:{cls:this.spacerCls}},null,true),d=Ext.get(a.firstChild),f=d.dom.style;
d.translate(0,b-1);f.lineHeight=Number(!parseInt(f.lineHeight,10))+"px";while(g!==e+1){d.translate(0,(b=e+Math.floor((g-e)/2)));f.lineHeight=Number(!parseInt(f.lineHeight,10))+"px";if(a.scrollHeight<b){g=b;}else{e=b;}}d.translate(0,Ext.scroll.Scroller.prototype.maxSpacerTranslate=e);g=e*2;while(g!==e+1){d.dom.style.marginTop=((b=e+Math.floor((g-e)/2)))+"px";
f.lineHeight=Number(!parseInt(f.lineHeight,10))+"px";if(a.scrollHeight<b){g=b;}else{e=b;}}Ext.fly(a).destroy();Ext.scroll.Scroller.prototype.maxSpacerMargin=e-Ext.scroll.Scroller.prototype.maxSpacerTranslate;}return Math.min(c,this.maxSpacerTranslate);},convertX:function(a){return a;},doHighlight:function(b,a){if(a!==true){Ext.fly(b).highlight(a);
}else{Ext.fly(b).highlight();}},doScrollTo:function(i,h,a){var g=this,c=g.getScrollElement(),d,b,j,f,e,l,k;if(c&&!c.destroyed){b=c.dom;j=(i===Infinity);f=(h===Infinity);if(j||f){d=g.getMaxPosition();if(j){i=d.x;}if(f){h=d.y;}}if(i!==null){i=g.convertX(i);}if(a){l=g.translatable;if(!l){g.translatable=l=new Ext.util.translatable.ScrollPosition({element:c});
}k=new Ext.Deferred();l.on("animationend",function(){if(g.destroyed){k.reject();}else{k.resolve();}},Ext.global,{single:true,onFrame:true});l.translate(i,h,a);e=k.promise;}else{if(h!=null){b.scrollTop=h;}if(i!=null){b.scrollLeft=i;}e=Ext.Deferred.getCachedResolved();}g.positionDirty=true;}else{e=Ext.Deferred.getCachedRejected();
}return e;},fireScrollStart:function(a,f,e,d){var c=this,b=c.component;c.invokePartners("onPartnerScrollStart",a,f,e,d);c.startX=a-e;c.startY=f-d;if(c.hasListeners.scrollstart){c.fireEvent("scrollstart",c,a,f);}if(b&&b.onScrollStart){b.onScrollStart(a,f);}Ext.GlobalEvents.fireEvent("scrollstart",c,a,f);
},fireScroll:function(a,f,e,d){var c=this,b=c.component;c.invokePartners("onPartnerScroll",a,f,e,d);if(c.hasListeners.scroll){c.fireEvent("scroll",c,a,f,e,d);}if(b&&b.onScrollMove){b.onScrollMove(a,f);}Ext.GlobalEvents.fireEvent("scroll",c,a,f,e,d);},fireScrollEnd:function(a,h,g,f){var e=this,d=e.component,c=a-e.startX,b=h-e.startY;
e.startX=e.startY=null;e.invokePartners("onPartnerScrollEnd",a,h,g,f);if(e.hasListeners.scrollend){e.fireEvent("scrollend",e,a,h,c,b);}if(d&&d.onScrollEnd){d.onScrollEnd(a,h);}Ext.GlobalEvents.fireEvent("scrollend",e,a,h,c,b);},getElementScroll:function(a){return a.getScroll();},initSnap:function(){var d=this,g=d.getSnapOffset(),e=d.getSnapSelector(),c=d.getElement(),a,f,b;
if(c&&e){c.addCls(d.snappableCls);d.removeSnapStylesheet();if(g){a=g.x||0;f=g.y||0;if(a){a=-a+"px";}if(f){f=-f+"px";}}b=a+" "+f+";";d.snapStylesheet=Ext.util.CSS.createStyleSheet("#"+c.id+" "+e+"{-webkit-scroll-snap-coordinate:"+b+"scroll-snap-coordinate:"+b+"}");}},initMsSnapInterval:function(){var c=this.getElement(),b,a,e,d;
if(c){b=this.getMsSnapInterval();if(b){a=b.x;e=b.y;d=c.dom.style;if(a){d["-ms-scroll-snap-points-x"]="snapInterval(0px, "+a+"px)";}if(e){d["-ms-scroll-snap-points-y"]="snapInterval(0px, "+e+"px)";}}}},initXStyle:function(){var b=this.getElement(),a=this.getX();if(b&&b.dom){if(!a){a="hidden";}else{if(a===true){a="auto";
}}b.setStyle("overflow-x",a);}},initYStyle:function(){var a=this.getElement(),b=this.getY();if(a&&a.dom){if(!b){b="hidden";}else{if(b===true){b="auto";}}a.setStyle("overflow-y",b);}},invokePartners:function(a,i,g,d,h){var f=this,j=f._partners,c,b,e;if(!f.suspendSync){f.invokingPartners=true;for(b in j){e=j[b].axes;
c=j[b].scroller;if(!c.invokingPartners&&(d&&e.x||h&&e.y)){c[a](f,e.x?i:null,e.y?g:null,d,h);}}f.invokingPartners=false;}},suspendPartnerSync:function(){this.suspendSync=(this.suspendSync||0)+1;},resumePartnerSync:function(c){var b=this,a;if(b.suspendSync){b.suspendSync--;}if(!b.suspendSync&&c){a=b.getPosition();
b.invokePartners("onPartnerScroll",a.x,a.y);b.invokePartners("onPartnerScrollEnd",a.x,a.y);}},readPosition:function(a){var d=this,c=d.getScrollElement(),b;a=a||{};if(c&&!c.destroyed){b=d.getElementScroll(c);a.x=b.left;a.y=b.top;}return a;},updateDomScrollPosition:function(c){var d=this,b=d.position,i=b.x,h=b.y,g,f,a,e;
d.readPosition(b);g=b.x;f=b.y;d.positionDirty=false;if(!c){a=g-i;e=f-h;if(a||e){if(!d.isScrolling){d.isScrolling=Ext.isScrolling=true;d.fireScrollStart(g,f,a,e);}d.fireScroll(g,f,a,e);d.bufferedOnDomScrollEnd(g,f,a,e);}}return b;},syncWithPartners:function(){var c=this,d=c._partners,e,b,a;c.suspendPartnerSync();
for(e in d){b=d[e].scroller;a=b.getPosition();c.onPartnerScroll(b,a.x,a.y);}c.resumePartnerSync();},syncScrollbarCls:function(){var a=this.getElement();if(a){a.toggleCls(this.noScrollbarsCls,this.getScrollbars()===false);}},onDomScroll:function(){var a=!!this.restoreTimer;this.updateDomScrollPosition(a);
if(a){clearTimeout(this.onDomScrollEnd.timer);return;}},onDomScrollEnd:function(a,e,d,c){var b=this;if(b.destroying||b.destroyed){return;}b.isScrolling=Ext.isScrolling=false;b.trackingScrollLeft=a;b.trackingScrollTop=e;b.fireScrollEnd(a,e,d,c);},onPartnerScrollStart:function(b,a,e,d,c){this.isScrolling=true;
this.fireScrollStart(a,e,d,c);},onPartnerScroll:function(b,a,e,d,c){this.doScrollTo(a,e,false);this.updateDomScrollPosition(true);this.fireScroll(a,e,d,c);},onPartnerScrollEnd:function(b,a,e,d,c){this.onDomScrollEnd(a,e,d,c);},removeSnapStylesheet:function(){var a=this.snapStylesheet;if(a){Ext.util.CSS.removeStyleSheet(a);
this.snapStylesheet=null;}},restoreState:function(){var b=this,a=b.getScrollElement();if(a){if(b.trackingScrollTop!==undefined){if(!b.restoreTimer){b.restoreTimer=Ext.defer(function(){b.restoreTimer=null;},50);}b.doScrollTo(b.trackingScrollLeft,b.trackingScrollTop,false);}}}}},function(a){Ext.getViewportScroller=function(){return a.viewport||(a.viewport=new a());
};Ext.setViewportScroller=function(b){if(a.viewport!==b){Ext.destroy(a.viewport);a.viewport=b.isScroller?b:new a(b);}};Ext.onReady(function(){a.initViewportScrollerTimer=Ext.defer(a.initViewportScroller,100);});});