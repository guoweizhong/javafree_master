Ext.define("Ext.route.Route",{requires:["Ext.route.Action"],config:{name:null,url:null,allowInactive:false,caseInsensitive:false,handlers:[]},defaultMatcher:"([%a-zA-Z0-9\\-\\_\\s,]+)",paramMatchingRegex:/:([0-9A-Za-z\_]*)/g,isRoute:true,constructor:function(b){var c=this,a;this.initConfig(b);Ext.apply(c,b,{conditions:{}});
a=c.getUrl();c.paramsInMatchString=a.match(c.paramMatchingRegex)||[];c.matcherRegex=c.createMatcherRegex(a);},recognize:function(b){var d=this,c=d.recognizes(b),e,a;if(b===d.lastToken){return true;}if(c){e=d.matchesFor(b);a=b.match(d.matcherRegex);a.shift();return Ext.applyIf(e,{historyUrl:b,urlParams:a});
}return false;},recognizes:function(a){return this.matcherRegex.test(a);},execute:function(e,l){var k=this,b=k.getAllowInactive(),d=k.getHandlers(),j=Ext.route.Router.getQueueRoutes(),c=d.length,n=[],g=[],a=(l&&l.urlParams)||[],h,p,o,f,m;k.lastToken=e;if(!j){m=[];}return new Ext.Promise(function(q,i){for(h=0;
h<c;h++){p=d[h];o=p.scope;if(!b&&o.isActive&&!o.isActive()){continue;}if(j){if(p.before){n.push({fn:p.before,scope:o});}if(p.action){g.push({fn:p.action,scope:o});}}else{f={urlParams:a};if(p.before){f.befores={fn:p.before,scope:o};}if(p.action){f.actions={fn:p.action,scope:o};}f=new Ext.route.Action(f);
if(Ext.fireEvent("beforeroute",f,k)===false){f.destroy();}else{m.push(f.run());}}}if(j){f=new Ext.route.Action({actions:g,befores:n,urlParams:a});if(Ext.fireEvent("beforeroute",f,k)===false){f.destroy();i();}else{f.run().then(q,i);}}else{Ext.Promise.all(m).then(q,i);}});},matchesFor:function(b){var f={},e=this.paramsInMatchString,a=b.match(this.matcherRegex),d=e.length,c;
a.shift();for(c=0;c<d;c++){f[e[c].replace(":","")]=a[c];}return f;},createMatcherRegex:function(a){var d=this.paramsInMatchString,g=this.conditions,j=this.defaultMatcher,b=d.length,h=this.getCaseInsensitive()?"i":"",e,c,f;if(a==="*"){a=a.replace("*","\\*");}else{for(e=0;e<b;e++){c=d[e];f=g[c]||j;a=a.replace(new RegExp(c),f);
}}return new RegExp("^"+a+"$",h);},addHandler:function(b){var a=this.getHandlers();a.push(b);return this;},removeHandler:function(e,b){var a=this.getHandlers(),g=a.length,f=[],c,d;for(c=0;c<g;c++){d=a[c];if(d.scope===e){if(!b||(Ext.isDefined(b.action)?d.action===b.action:true&&Ext.isDefined(b.before)?d.before===b.before:true)){continue;
}}f.push(d);}this.setHandlers(f);return this;}});