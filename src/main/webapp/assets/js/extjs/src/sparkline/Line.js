Ext.define("Ext.sparkline.Line",{extend:"Ext.sparkline.Base",requires:["Ext.sparkline.RangeMap"],alias:"widget.sparklineline",config:{fillColor:"#def",spotColor:"#f80",highlightSpotColor:"#5f5",highlightLineColor:"#f22",spotRadius:1.5,minSpotColor:"#f80",maxSpotColor:"#f80",lineWidth:1,normalRangeMin:null,normalRangeMax:null,normalRangeColor:"#ccc",drawNormalOnTop:false,chartRangeMin:null,chartRangeMax:null,chartRangeMinX:null,chartRangeMaxX:null,valueSpots:null},tipTpl:"&#9679; {prefix}{y}{suffix}",applyValueSpots:function(a){if(a&&!a.get){a=new Ext.sparkline.RangeMap(a);
}this.updateConfigChange();return a;},onUpdate:function(){this.vertices=[];this.regionMap=[];this.xvalues=[];this.yvalues=[];this.yminmax=[];},getRegion:function(a,d){var b,c=this.regionMap;for(b=c.length;b--;){if(c[b]!==null&&a>=c[b][0]&&a<=c[b][1]){return c[b][2];}}return undefined;},getRegionFields:function(a){return{isNull:this.yvalues[a]===null,x:this.xvalues[a],y:this.yvalues[a],color:this.getLineColor(),fillColor:this.getFillColor(),offset:a};
},renderHighlight:function(f){var c=this,a=c.canvas,e=c.vertices[f],b=c.getSpotRadius(),g=c.getHighlightSpotColor(),d=c.getHighlightLineColor();if(!e){return;}if(b&&g){a.drawCircle(e[0],e[1],b,null,g).append();}if(d){a.drawLine(e[0],c.canvasTop,e[0],c.canvasTop+c.getHeight(),d).append();}},scanValues:function(){var e=this,b=e.values,h=b.length,a=e.xvalues,c=e.yvalues,f=e.yminmax,d,g;
for(d=0;d<h;d++){g=b[d];if(typeof g==="string"){g=g.split(":");}if(g&&g.length===2){a.push(Number(g[0]));c.push(g=Number(g[1]));f.push(g);}else{a.push(d);if(g==null||g==="null"){c.push(null);}else{c.push(g=Number(g));f.push(g);}}}if(e.xvalues){a=e.xvalues;}e.maxy=e.maxyorg=Math.max.apply(Math,f);e.miny=e.minyorg=Math.min.apply(Math,f);
e.maxx=Math.max.apply(Math,a);e.minx=Math.min.apply(Math,a);e.xvalues=a;e.yvalues=c;e.yminmax=f;},processRangeOptions:function(){var d=this,c=d.getNormalRangeMin(),f=d.getNormalRangeMax(),a=d.getChartRangeMin(),b=d.getChartRangeMinX(),e=d.getChartRangeMax(),g=d.getChartRangeMaxX();if(c!=null){if(c<d.miny){d.miny=c;
}if(f>d.maxy){d.maxy=f;}}if(a!=null&&(d.chartRangeClip||a<d.miny)){d.miny=a;}if(e!=null&&(d.chartRangeClip||e>d.maxy)){this.maxy=e;}if(b!=null&&(d.chartRangeClipX||b<d.minx)){d.minx=b;}if(g!=null&&(d.chartRangeClipX||g>d.maxx)){d.maxx=g;}},drawNormalRange:function(c,g,f,d,h){var a=this.getNormalRangeMin(),e=this.getNormalRangeMax(),b=g+Math.round(f-(f*((e-this.miny)/h))),i=Math.round((f*(e-a))/h);
this.canvas.drawRect(c,b,d,i,undefined,this.normalRangeColor).append();},renderGraph:function(){var p=this,j=p.canvas,L=p.getWidth(),l=p.getHeight(),d=p.vertices,K=p.getSpotRadius(),N=p.regionMap,A,f,B,s,q,r,I,z,E,D,h,v,m,o,g,J,e,C,n,c=p.getValueSpots(),G,t,F,H,M,k=p.getSpotColor(),b=p.getMinSpotColor(),w=p.getMaxSpotColor(),u=p.getNormalRangeMin(),a=p.getDrawNormalOnTop();
if(!p.callParent()){return;}p.scanValues();p.processRangeOptions();F=p.xvalues;H=p.yvalues;if(!p.yminmax.length||p.yvalues.length<2){return;}s=q=0;A=p.maxx-p.minx===0?1:p.maxx-p.minx;f=p.maxy-p.miny===0?1:p.maxy-p.miny;B=p.yvalues.length-1;if(K&&(L<(K*4)||l<(K*4))){K=0;}if(K){G=p.getHighlightSpotColor()&&!p.disableInteraction;
if(G||b||(k&&H[B]===p.miny)){l-=Math.ceil(K);}if(G||w||(k&&H[B]===p.maxy)){l-=Math.ceil(K);s+=Math.ceil(K);}if(G||((b||w)&&(H[0]===p.miny||H[0]===p.maxy))){q+=Math.ceil(K);L-=Math.ceil(K);}if(G||k||(b||w&&(H[B]===p.miny||H[B]===p.maxy))){L-=Math.ceil(K);}}l--;if(u!=null&&!a){p.drawNormalRange(q,s,l,L,f);
}I=[];z=[I];o=g=null;J=H.length;for(M=0;M<J;M++){E=F[M];h=F[M+1];D=H[M];v=q+Math.round((E-p.minx)*(L/A));m=M<J-1?q+Math.round((h-p.minx)*(L/A)):L;g=v+((m-v)/2);N[M]=[o||0,g,M];o=g;if(D===null){if(M){if(H[M-1]!==null){I=[];z.push(I);}d.push(null);}}else{if(D<p.miny){D=p.miny;}if(D>p.maxy){D=p.maxy;}if(!I.length){I.push([v,s+l]);
}r=[v,s+Math.round(l-(l*((D-this.miny)/f)))];I.push(r);d.push(r);}}e=[];C=[];n=z.length;for(M=0;M<n;M++){I=z[M];if(I.length){if(p.fillColor){I.push([I[I.length-1][0],(s+l)]);C.push(I.slice(0));I.pop();}if(I.length>2){I[0]=[I[0][0],I[1][1]];}e.push(I);}}n=C.length;for(M=0;M<n;M++){j.drawShape(C[M],p.fillColor,p.fillColor).append();
}if(u!=null&&a){p.drawNormalRange(q,s,l,L,f);}n=e.length;for(M=0;M<n;M++){j.drawShape(e[M],p.getLineColor(),null,p.getLineWidth()).append();}if(K&&c){if(c.get==null){c=new Ext.sparkline.RangeMap(c);}for(M=0;M<J;M++){t=c.get(H[M]);if(t){j.drawCircle(q+Math.round((F[M]-p.minx)*(L/A)),s+Math.round(l-(l*((H[M]-p.miny)/f))),K,null,t).append();
}}}if(K&&k&&H[B]!=null){j.drawCircle(q+Math.round((F[F.length-1]-p.minx)*(L/A)),s+Math.round(l-(l*((H[B]-p.miny)/f))),K,null,k).append();}if(p.maxy!==p.minyorg){if(K&&b){E=F[Ext.Array.indexOf(H,p.minyorg)];j.drawCircle(q+Math.round((E-p.minx)*(L/A)),s+Math.round(l-(l*((p.minyorg-p.miny)/f))),K,null,b).append();
}if(K&&w){E=F[Ext.Array.indexOf(H,p.maxyorg)];j.drawCircle(q+Math.round((E-p.minx)*(L/A)),s+Math.round(l-(l*((p.maxyorg-p.miny)/f))),K,null,w).append();}}p.canvasTop=s;if(p.currentPageXY&&p.canvasRegion.contains(p.currentPageXY)){p.updateDisplay();}j.render();}});