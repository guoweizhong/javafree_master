Ext.define("Ext.data.Batch",{mixins:{observable:"Ext.mixin.Observable"},config:{pauseOnException:false},current:-1,total:0,running:false,complete:false,exception:false,constructor:function(a){var b=this;b.mixins.observable.constructor.call(b,a);b.operations=[];b.exceptions=[];},add:function(b){var d=this,c,a;
if(Ext.isArray(b)){for(c=0,a=b.length;c<a;++c){d.add(b[c]);}}else{d.total++;b.setBatch(d);d.operations.push(b);}return d;},sort:function(){this.operations.sort(this.sortFn);},sortFn:function(c,a){var b=c.order-a.order;if(b){return b;}var f=c.entityType,d=a.entityType,e;if(!f||!d){return 0;}if(!(e=f.rank)){f.schema.rankEntities();
e=f.rank;}return(e-d.rank)*c.foreignKeyDirection;},start:function(a){var b=this;if(!b.operations.length||b.running){return b;}b.exceptions.length=0;b.exception=false;b.running=true;return b.runOperation(Ext.isDefined(a)?a:b.current+1);},retry:function(){return this.start(this.current);},runNextOperation:function(){var a=this;
if(a.running){a.runOperation(a.current+1);}return a;},pause:function(){this.running=false;return this;},getOperations:function(){return this.operations;},getExceptions:function(){return this.exceptions;},getCurrent:function(){var a=null,b=this.current;if(!(b===-1||this.complete)){a=this.operations[b];
}return a;},getTotal:function(){return this.total;},isRunning:function(){return this.running;},isComplete:function(){return this.complete;},hasException:function(){return this.exception;},runOperation:function(c){var d=this,b=d.operations,a=b[c];if(a===undefined){d.running=false;d.complete=true;d.fireEvent("complete",d,b[b.length-1]);
}else{d.current=c;a.setInternalCallback(d.onOperationComplete);a.setInternalScope(d);a.execute();}return d;},onOperationComplete:function(a){var c=this,b=a.hasException();if(b){c.exception=true;c.exceptions.push(a);c.fireEvent("exception",c,a);}if(b&&c.getPauseOnException()){c.pause();}else{c.fireEvent("operationcomplete",c,a);
c.runNextOperation();}}});