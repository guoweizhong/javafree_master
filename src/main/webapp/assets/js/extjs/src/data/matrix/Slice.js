Ext.define("Ext.data.matrix.Slice",{constructor:function(a,b){this.id=b;this.side=a;this.members={};},attach:function(a){var b=this;Ext.Assert.falsey(b.store,"Store is already attached");b.store=a;a.matrix=b;a.on("load",b.onStoreLoad,b,{single:true});},commit:function(){var a=this.members,b;for(b in a){a[b][2]=0;
}},onStoreLoad:function(a){this.update(a.getData().items,0);},update:function(m,f){if(!(m instanceof Array)){Ext.raise("Only array of records or record ids are supported");}var s=this,h=Ext.data.matrix.Slice,c=s.side,j=c.index,e=m.length,l=s.id,r=s.members,b=c.inverse,q=b.slices,g,o,n,p,a,k,d;for(n=0;
n<e;++n){o=d=null;p=m[n];a=p.isEntity?(d=p).id:p;g=r[a];if(f<0&&g&&g[2]===1){delete r[a];k=q[a];if(k){delete k.members[l];}o=1;}else{if(!g){g=[a,a,f];g[j]=l;r[a]=g;k=q[a];if(!k){q[a]=k=new h(b,a);}k.members[l]=g;o=1;}else{if(f!==g[2]&&f!==0&&!(f===1&&g[2]===0)){g[2]=f;k=q[a];o=1;}}}if(o){if(s.notify){s.notify.call(s.scope,s,a,f);
}if(k&&k.notify){k.notify.call(k.scope,k,l,f);}}}},updateId:function(b){var i=this,a=i.id,h=i.side,l=h.slices,k=l[a],c=k.members,f=h.index,d=h.inverse.slices,g,e,j;i.id=b;l[b]=k;delete l[a];for(e in c){g=c[e];g[f]=b;j=d[e].members;j[b]=j[a];delete j[a];}},destroy:function(){var b=this,a=b.store;if(a){a.matrix=null;
a.un("load",b.onStoreLoad,b);}b.notify=b.scope=b.store=b.side=b.members=null;b.callParent();}});