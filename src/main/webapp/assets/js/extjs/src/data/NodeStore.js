Ext.define("Ext.data.NodeStore",{extend:"Ext.data.Store",alias:"store.node",requires:["Ext.data.TreeModel","Ext.data.NodeInterface"],isNodeStore:true,config:{node:null,recursive:false,rootVisible:false,folderSort:false},implicitModel:"Ext.data.TreeModel",getTotalCount:function(){return this.getCount();
},updateFolderSort:function(b){var a=this.getData();a.setTrackGroups(false);if(b){a.setGrouper({groupFn:this.folderSortFn});}else{a.setGrouper(null);}},folderSortFn:function(a){return a.data.leaf?1:0;},afterReject:function(a){var b=this;if(b.contains(a)){b.onUpdate(a,Ext.data.Model.REJECT,null);b.fireEvent("update",b,a,Ext.data.Model.REJECT,null);
}},afterCommit:function(a,c){var b=this;if(!c){c=null;}if(b.contains(a)){b.onUpdate(a,Ext.data.Model.COMMIT,c);b.fireEvent("update",b,a,Ext.data.Model.COMMIT,c);}},onNodeAppend:function(a,b){if(a===this.getNode()){this.add([b].concat(this.retrieveChildNodes(b)));}},onNodeInsert:function(c,e,b){var d=this,a;
if(c===d.getNode()){a=d.indexOf(b)||0;d.insert(0,[e].concat(d.retrieveChildNodes(e)));}},onNodeRemove:function(a,b){if(a===this.getNode()){this.remove([b].concat(this.retrieveChildNodes(b)));}},onNodeExpand:function(b,a){if(b===this.getNode()){this.loadRecords(a);}},applyNode:function(a){if(a){if(!a.isModel){a=new (this.getModel())(a);
}if(!a.isNode){Ext.data.NodeInterface.decorate(a);}}return a;},updateNode:function(b,d){var a=this,c;if(d&&!d.destroyed){d.un({append:"onNodeAppend",insert:"onNodeInsert",remove:"onNodeRemove",scope:a});d.unjoin(a);}if(b){b.on({scope:a,append:"onNodeAppend",insert:"onNodeInsert",remove:"onNodeRemove"});
b.join(a);c=[];if(b.childNodes.length){c=c.concat(a.retrieveChildNodes(b));}if(a.getRootVisible()){c.push(b);}else{if(b.isLoaded()||b.isLoading()){b.set("expanded",true);}}a.getData().clear();a.fireEvent("clear",a);a.suspendEvents();if(a.isInitializing){a.inlineData=c;}else{a.add(c);}a.resumeEvents();
if(c.length===0){a.loaded=b.loaded=true;}a.fireEvent("refresh",a,a.data);}},isVisible:function(b){var a=b.parentNode;if(!this.getRecursive()&&a!==this.getNode()){return false;}while(a){if(!a.isExpanded()){return false;}if(a===this.getNode()){break;}a=a.parentNode;}return true;},privates:{retrieveChildNodes:function(a){var d=this.getNode(),b=this.getRecursive(),c=[],e=a;
if(!a.childNodes.length||(!b&&a!==d)){return c;}if(!b){return a.childNodes;}while(e){if(e._added){delete e._added;if(e===a){break;}else{e=e.nextSibling||e.parentNode;}}else{if(e!==a){c.push(e);}if(e.firstChild){e._added=true;e=e.firstChild;}else{e=e.nextSibling||e.parentNode;}}}return c;}}});