Ext.define("Ext.data.reader.Reader",{alternateClassName:["Ext.data.Reader","Ext.data.DataReader"],requires:["Ext.data.ResultSet","Ext.XTemplate","Ext.util.LruCache"],mixins:["Ext.mixin.Observable","Ext.mixin.Factoryable"],alias:"reader.base",factoryConfig:{defaultType:null},config:{groupRootProperty:"",implicitIncludes:true,keepRawData:null,messageProperty:"",model:null,proxy:null,readRecordsOnFailure:true,rootProperty:"",successProperty:"success",summaryRootProperty:"",totalProperty:"total",transform:null,typeProperty:""},isReader:true,constructor:function(a){if(a&&a.hasOwnProperty("root")){a=Ext.apply({},a);
a.rootProperty=a.root;delete a.root;Ext.log.error('Ext.data.reader.Reader: Using the deprecated "root" configuration. Use "rootProperty" instead.');}var b=this;b.duringInit=1;b.mixins.observable.constructor.call(b,a);--b.duringInit;b.buildExtractors();},forceBuildExtractors:function(){if(!this.duringInit){this.buildExtractors(true);
}},updateGroupRootProperty:function(){this.forceBuildExtractors();},updateMessageProperty:function(){this.forceBuildExtractors();},applyModel:function(a){return Ext.data.schema.Schema.lookupEntity(a);},updateSuccessProperty:function(){this.forceBuildExtractors();},updateTotalProperty:function(){this.forceBuildExtractors();
},applyTransform:function(a){if(a){if(Ext.isFunction(a)){a={fn:a};}else{if(a.charAt){a={fn:this[a]};}}return a.fn.bind(a.scope||this);}return a;},read:function(b,e){var d,a,c;if(b){c=b.responseText;if(c){a=this.getResponseData(b);if(a&&a.__$isError){return new Ext.data.ResultSet({total:0,count:0,records:[],success:false,message:a.msg});
}else{d=this.readRecords(a,e);}}else{if(c!==""){d=this.readRecords(b,e);}}}return d||this.nullResultSet;},getNullResultSet:function(){return this.nullResultSet;},createReadError:function(a){return{__$isError:true,msg:a};},readRecords:function(r,f,j){var q=this,d=j&&j.recordsOnly,m=j&&j.asRoot,g=null,p=null,c,b,n,l,a,s,k,e,h,i,o;
i=q.getMeta?q.getMeta(r):r.metaData;if(i){q.onMetaChange(i);}h=q.getTransform();if(h){r=h(r);}q.buildExtractors();if(q.getKeepRawData()){q.rawData=r;}if(q.hasListeners.rawdata){q.fireEventArgs("rawdata",[r]);}r=q.getData(r);c=true;b=0;n=[];if(q.getSuccessProperty()){k=q.getSuccess(r);if(k===false||k==="false"){c=false;
}}if(q.getMessageProperty()){e=q.getMessage(r);}if(c||q.getReadRecordsOnFailure()){l=(m||Ext.isArray(r))?r:q.getRoot(r);if(l){s=l.length;}if(q.getTotalProperty()){k=parseInt(q.getTotal(r),10);if(!isNaN(k)){a=s=k;}}if(l){n=q.extractData(l,f);b=n.length;}if(q.getGroupRootProperty()){l=q.getGroupRoot(r);
if(l){o={includes:false,model:q.getModel().getSummaryModel()};g=q.extractData(l,o)||null;}}if(q.getSummaryRootProperty()){l=q.getSummaryRoot(r);if(l){o=o||{includes:false,model:q.getModel().getSummaryModel()};p=q.extractData(l,o)||null;if(p){p=p[0];}}}}return d?n:new Ext.data.ResultSet({total:s||b,remoteTotal:a,metadata:i,count:b,records:n,success:c,message:e,groupData:g,summaryData:p});
},extractData:function(o,f){var m=this,g=f&&f.model?Ext.data.schema.Schema.lookupEntity(f.model):m.getModel(),d=g.schema,p=f&&"includes" in f?f.includes:d.hasAssociations(g)&&m.getImplicitIncludes(),n=m.getFieldExtractorInfo(g),a=o.length,c=new Array(a),k=m.getTypeProperty(),l,b,e,j,h;if(!a&&Ext.isObject(o)){o=[o];
a=1;}for(h=0;h<a;h++){j=o[h];if(!j.isModel){b=j;if(k&&(e=m.getChildType(d,b,k))){l=e.getProxy().getReader();j=l.extractRecord(b,f,e,d.hasAssociations(e)&&l.getImplicitIncludes(),l.getFieldExtractorInfo(e));}else{j=m.extractRecord(b,f,g,p,n);}if(j.isModel&&j.isNode){j.raw=b;}}if(j.onLoad){j.onLoad();}c[h]=j;
}return c;},getChildType:function(b,c,d){var a;switch(typeof d){case"string":return b.getEntity(c[d]);case"object":a=d.namespace;return b.getEntity((a?a+".":"")+c[d.name]);case"function":return b.getEntity(d(c));}},extractRecordData:function(c,d){var b=d&&d.model?Ext.data.schema.Schema.lookupEntity(d.model):this.getModel(),a=this.getFieldExtractorInfo(b);
return this.extractRecord(c,d,b,false,a);},extractRecord:function(a,b,c,i,g){var f=this,e=(b&&b.recordCreator)||f.defaultRecordCreator,h,d;h=f.extractModelData(a,g);d=e.call(f,h,c||f.getModel(),b);if(i&&d.isModel){f.readAssociated(d,a,b);}return d;},getFieldExtractorInfo:function(b){var d=b.fieldExtractors,a,c;
if(!d){return;}a=this.$className;c=d[a];if(c===undefined){d[a]=c=this.buildFieldExtractors(b);}return c;},buildFieldExtractors:function(d){var h=d.getFields(),j=h.length,f=[],l=[],e=null,b=0,k,a,g,c;for(g=0;g<j;++g){k=h[g];c=this.createFieldAccessor(k);if(c){a=k.name;f.push("val = extractors["+b+"](raw, self); if (val !== undefined) { data['"+a+"'] = val; }");
l.push(c);++b;}}if(f.length){e={extractors:l,fn:new Function("raw","data","extractors","self","var val;"+f.join("\n"))};}return e;},defaultRecordCreator:function(b,c){var a=new c(b);a.phantom=false;return a;},getModelData:function(a){return{};},extractModelData:function(b,a){var d=this.getModelData(b),c;
if(a){c=a.fn;c(b,d,a.extractors,this);}return d;},readAssociated:function(a,e,d){var c=a.associations,b,f;for(b in c){if(c.hasOwnProperty(b)){f=c[b];if(f.cls){f.read(a,e,this,d);}}}},getData:Ext.identityFn,getRoot:Ext.identityFn,getResponseData:function(a){Ext.raise("getResponseData must be implemented in the Ext.data.reader.Reader subclass");
},onMetaChange:function(g){var f=this,b=g.fields,c,e,a,d;f.metaData=g;if(g.root){f.setRootProperty(g.root);}if(g.totalProperty){f.setTotalProperty(g.totalProperty);}if(g.successProperty){f.setSuccessProperty(g.successProperty);}if(g.messageProperty){f.setMessageProperty(g.messageProperty);}a=g.clientIdProperty;
if(b){e=Ext.define(null,{extend:"Ext.data.Model",fields:b,clientIdProperty:a});f.setModel(e);d=f.getProxy();if(d){d.setModel(e);}}else{if(a){c=f.getModel();if(c){c.self.prototype.clientIdProperty=a;}}}},buildExtractors:function(d){var b=this,c,a,e;if(d||!b.hasExtractors){c=b.getTotalProperty();a=b.getSuccessProperty();
e=b.getMessageProperty();if(c){b.getTotal=b.getAccessor(c);}if(a){b.getSuccess=b.getAccessor(a);}if(e){b.getMessage=b.getAccessor(e);}b.hasExtractors=true;return true;}},getAccessor:function(e){var d=this,a=d.extractorCache,b,c;if(typeof e==="string"){c=d.getAccessorKey(e);if(c){b=a.get(c);}if(!b){b=d.createAccessor(e);
if(c){a.add(c,b);}}}else{b=d.createAccessor(e);}return b;},getAccessorKey:function(b){var a=this.$className;return a?a+b:"";},createAccessor:Ext.emptyFn,createFieldAccessor:Ext.emptyFn,destroy:function(){var a=this;a.model=a.getTotal=a.getSuccess=a.getMessage=a.rawData=null;a.onMetaChange=null;a.transform=null;
a.callParent();},privates:{copyFrom:function(a){var b=this;a.buildExtractors();b.getTotal=a.getTotal;b.getSuccess=a.getSuccess;b.getMessage=a.getMessage;++b.duringInit;b.setConfig(a.getConfig());--b.duringInit;b.hasExtractors=true;},getGroupRoot:Ext.privateFn,getSummaryRoot:Ext.privateFn}},function(b){var a=b.prototype;
Ext.apply(a,{nullResultSet:new Ext.data.ResultSet({total:0,count:0,records:[],success:true,message:""})});a.extractorCache=new Ext.util.LruCache();});