Ext.define("Ext.data.Store",{extend:"Ext.data.ProxyStore",alias:"store.store",mixins:["Ext.data.LocalStore"],requires:["Ext.data.Model","Ext.data.proxy.Ajax","Ext.data.reader.Json","Ext.data.writer.Json","Ext.util.GroupCollection","Ext.util.DelayedTask"],uses:["Ext.data.StoreManager","Ext.util.Grouper"],config:{data:undefined,clearRemovedOnLoad:true,clearOnPageLoad:true,associatedEntity:null,role:null,session:null},addRecordsOptions:{addRecords:true},loadCount:0,complete:false,moveMapCount:0,constructor:function(a){var b=this,c;
if(a){if(a.buffered){if(this.self!==Ext.data.Store){Ext.raise("buffered config not supported on derived Store classes. "+"Please derive from Ext.data.BufferedStore.");}return new Ext.data.BufferedStore(a);}if(a.remoteGroup){Ext.log.warn("Ext.data.Store: remoteGroup has been removed. Use remoteSort instead.");
}}b.callParent([a]);c=b.inlineData;if(c){delete b.inlineData;b.loadInlineData(c);}},applyData:function(c,a){var b=this;b.getFields();b.getModel();if(c&&c.isCollection){a=c;}else{if(!a){a=b.constructDataCollection();}if(c){if(b.isInitializing){b.inlineData=c;}else{b.loadData(c);}}}return a;},loadInlineData:function(c){var b=this,a=b.getProxy();
if(a&&a.isMemoryProxy){a.setData(c);b.suspendEvents();b.read();b.resumeEvents();}else{b.removeAll(true);b.suspendEvents();b.loadData(c);b.resumeEvents();}},onCollectionAdd:function(b,a){this.onCollectionAddItems(b,a.items,a);},onCollectionFilterAdd:function(b,a){this.onCollectionAddItems(b,a);},onCollectionAddItems:function(f,b,a){var k=this,h=b.length,m=a?!a.next:false,g=k.removed,e=k.ignoreCollectionAdd,j=k.getSession(),o=a&&a.replaced,c,l,d,n;
if(k.activeRanges){k.syncActiveRanges();}for(c=0;c<h;++c){d=b[c];if(j){j.adopt(d);}if(!e){d.join(k);if(g&&g.length){Ext.Array.remove(g,d);}l=l||d.phantom||d.dirty;}}if(e){return;}if(o){n=[];do{Ext.Array.push(n,o.items);o=o.next;}while(o);k.setMoving(n,true);}if(a){if(a.replaced){if(m){k.fireEvent("datachanged",k);
k.fireEvent("refresh",k);}}else{k.fireEvent("add",k,b,a.at);if(m){k.fireEvent("datachanged",k);}}}if(n){k.setMoving(n,false);}k.needsSync=k.needsSync||l;},onCollectionBeforeItemChange:function(e,d){var a=d.item,c=d.modified||null,b=d.meta;this.fireEvent("beforeupdate",this,a,b,c,d);},onCollectionFilteredItemChange:function(){this.onCollectionItemChange.apply(this,arguments);
},onCollectionItemChange:function(f,e){var d=this,a=e.item,c=e.modified||null,b=e.meta;if(d.fireChangeEvent(a)){d.onUpdate(a,b,c,e);d.fireEvent("update",d,a,b,c,e);d.fireEvent("datachanged",d);}},afterChange:function(a,c,b){this.getData().itemChanged(a,c||null,undefined,b);},afterCommit:function(a,b){this.afterChange(a,b,Ext.data.Model.COMMIT);
},afterEdit:function(a,b){this.needsSync=this.needsSync||a.dirty;this.afterChange(a,b,Ext.data.Model.EDIT);},afterReject:function(a){this.afterChange(a,null,Ext.data.Model.REJECT);},afterDrop:function(a){this.getData().remove(a);},afterErase:function(a){this.removeFromRemoved(a);},addSorted:function(a){var c=this,e=c.getRemoteSort(),d=c.getData(),b;
if(e){d.setSorters(c.getSorters());}b=d.findInsertionIndex(a);if(e){d.setSorters(null);}return c.insert(b,a);},remove:function(b,j,g){var h=this,c=h.getDataSource(),f,d,a,e;if(b){if(b.isModel){if(c.indexOf(b)>-1){a=[b];f=1;}else{f=0;}}else{a=[];for(d=0,f=b.length;d<f;++d){e=b[d];if(e&&e.isEntity){if(!c.contains(e)){continue;
}}else{if(!(e=c.getAt(e))){continue;}}a.push(e);}f=a.length;}}if(!f){return[];}h.removeIsMove=j===true;h.removeIsSilent=g;c.remove(a);h.removeIsSilent=false;return a;},onCollectionRemove:function(g,a){var m=this,h=m.removed,c=a.items,k=c.length,j=a.at,b=a.replacement,o=m.removeIsMove||(b&&Ext.Array.equals(c,b.items)),l=m.removeIsSilent,n=!a.next,e=m.getDataSource(),d,f;
if(m.ignoreCollectionRemove){return;}if(b){m.setMoving(b.items,true);}for(d=k-1;d>=0;d--){f=c[d];if(!e.contains(f)){if(h&&!o&&!f.phantom&&!f.erasing){f.removedFrom=j+d;h.push(f);m.needsSync=true;}else{f.unjoin(m);}}}if(!l){if(!b||!b.items.length){m.fireEvent("remove",m,c,j,o);if(n){m.fireEvent("datachanged",m);
}}}if(b){m.setMoving(b.items,false);}},onFilterEndUpdate:function(){var a=this;if(a.destroying||a.destroyed){return;}if(a.activeRanges){a.syncActiveRanges();}a.callParent(arguments);a.callObservers("Filter");},removeAt:function(a,b){var c=this.getData();a=Math.max(a,0);if(a<c.length){if(arguments.length===1){b=1;
}else{if(!b){return;}}c.removeAt(a,b);}},removeAll:function(b){var c=this,d=c.getData(),a=d.getRange();if(d.length){c.removeIsSilent=true;c.callObservers("BeforeRemoveAll");d.removeAll();c.removeIsSilent=false;if(!b){c.fireEvent("clear",c,a);c.fireEvent("datachanged",c);}c.callObservers("AfterRemoveAll",[!!b]);
}return a;},setRecords:function(a){var b=this.getCount();++this.loadCount;if(b){this.getData().splice(0,b,a);}else{this.add(a);}},splice:function(a,c,b){return this.getData().splice(a,c,b);},onProxyLoad:function(b){var d=this,c=b.getResultSet(),a=b.getRecords(),e=b.wasSuccessful();if(d.destroyed){return;
}if(c){d.totalCount=c.getTotal();}if(e){a=d.processAssociation(a);d.loadRecords(a,b.getAddRecords()?{addRecords:true}:undefined);d.attachSummaryRecord(c);}else{d.loading=false;}if(d.hasListeners.load){d.fireEvent("load",d,a,e,b);}d.callObservers("AfterLoad",[a,e,b]);},onProxyWrite:function(a){if(a.wasSuccessful()){this.attachSummaryRecord(a.getResultSet());
}this.callParent([a]);},filterDataSource:function(e){var f=this.getDataSource(),b=f.items,a=b.length,c=[],d;for(d=0;d<a;d++){if(e.call(f,b[d])){c.push(b[d]);}}return c;},getNewRecords:function(){return this.filterDataSource(this.filterNew);},getRejectRecords:function(){return this.filterDataSource(this.filterRejects);
},getUpdatedRecords:function(){return this.filterDataSource(this.filterUpdated);},loadData:function(f,a){var e=this,d=f.length,c=[],b;for(b=0;b<d;b++){c.push(e.createModel(f[b]));}c=e.processAssociation(c);e.loadRecords(c,a?e.addRecordsOptions:undefined);},loadRawData:function(e,b){var d=this,f=d.getSession(),a=d.getProxy().getReader().read(e,f?{recordCreator:f.recordCreator}:undefined),c=a.getRecords(),g=a.getSuccess();
if(g){d.totalCount=a.getTotal();d.loadRecords(c,b?d.addRecordsOptions:undefined);}return g;},loadRecords:function(a,c){var g=this,f=a.length,h=g.getData(),e,d,b;if(c){e=c.addRecords;}if(!g.getRemoteSort()&&!g.getSortOnLoad()){b=true;h.setAutoSort(false);}if(!e){g.clearData(true);}g.loading=false;g.ignoreCollectionAdd=true;
g.callObservers("BeforePopulate");h.add(a);g.ignoreCollectionAdd=false;if(b){h.setAutoSort(true);}for(d=0;d<f;d++){a[d].join(g);}if(!g.isEmptyStore){++g.loadCount;g.complete=true;}if(g.hasListeners.datachanged){g.fireEvent("datachanged",g);}if(g.hasListeners.refresh){g.fireEvent("refresh",g);}g.callObservers("AfterPopulate");
},loadPage:function(d,a){var c=this,b=c.getPageSize();c.currentPage=d;a=Ext.apply({page:d,start:(d-1)*b,limit:b,addRecords:!c.getClearOnPageLoad()},a);c.read(a);},nextPage:function(a){this.loadPage(this.currentPage+1,a);},previousPage:function(a){this.loadPage(this.currentPage-1,a);},clearData:function(c){var j=this,g=j.removed,d=j.getDataSource(),h=j.getClearRemovedOnLoad(),k=g&&c&&!h,a,e,b,f;
if(d){a=d.items;for(b=0,f=a.length;b<f;++b){e=a[b];if(k&&Ext.Array.contains(g,e)){continue;}e.unjoin(j);}j.ignoreCollectionRemove=true;j.callObservers("BeforeClear");d.removeAll();j.ignoreCollectionRemove=false;j.callObservers("AfterClear");}if(g&&(!c||h)){g.length=0;}},onIdChanged:function(c,b,a){this.getData().updateKey(c,b);
this.fireEvent("idchanged",this,c,b,a);},commitChanges:function(){var c=this,d=c.getModifiedRecords(),a=d.length,b=0;Ext.suspendLayouts();c.beginUpdate();for(;b<a;b++){d[b].commit();}c.cleanRemoved();c.endUpdate();Ext.resumeLayouts(true);c.fireEvent("commit",c);},filterNewOnly:function(a){return a.phantom===true;
},filterRejects:function(a){return a.phantom||a.dirty;},rejectChanges:function(){var h=this,j=h.getRejectRecords(),f=j.length,d,b,a,g,c,e;Ext.suspendLayouts();h.beginUpdate();for(d=0;d<f;d++){b=j[d];if(b.phantom){a=a||[];a.push(b);}else{b.reject();}}if(a){h.remove(a);for(d=0,f=a.length;d<f;++d){a[d].reject();
}}j=h.getRawRemovedRecords();if(j){f=j.length;g=!h.getRemoteSort()&&h.isSorted();if(g){c=h.getData();e=c.getAutoSort();c.setAutoSort(false);}for(d=f-1;d>=0;d--){b=j[d];b.reject();if(!g){h.insert(b.removedFrom||0,b);}}if(g){c.setAutoSort(e);h.add(j);}j.length=0;}h.endUpdate();Ext.resumeLayouts(true);h.fireEvent("reject",h);
},doDestroy:function(){var b=this,a=b.loadTask,d=b.getData(),c=d.getSource();b.clearData();b.setSession(null);b.observers=null;if(a){a.cancel();b.loadTask=null;}if(c){c.destroy();}b.callParent();},privates:{commitOptions:{commit:true},attachSummaryRecord:function(k){if(!k){return;}var j=this,h=k.getSummaryData(),a=j.getGrouper(),g=j.summaryRecord,e=j.commitOptions,b,f,d,c,l;
if(h){if(g){g.set(h.data,e);}else{j.summaryRecord=h;h.isRemote=true;}}if(a){h=k.getGroupData();if(h){b=j.getGroups();for(d=0,f=h.length;d<f;++d){c=h[d];l=b.getItemGroup(c);if(l){g=l.summaryRecord;if(g){g.set(c.data,e);}else{l.summaryRecord=c;c.isRemote=true;}}}}}},fetch:function(b){b=Ext.apply({},b);
this.setLoadOptions(b);var a=this.createOperation("read",b);a.execute();},fireChangeEvent:function(a){return this.getDataSource().contains(a);},onBeforeLoad:function(a){this.callObservers("BeforeLoad",[a]);},onRemoteFilterSet:function(a,b){if(a){this.getData().setFilters(b?null:a);}this.callParent([a,b]);
},onRemoteSortSet:function(b,c){var a=this.getData();if(b){a.setSorters(c?null:b);}a.setAutoGroup(!c);this.callParent([b,c]);},isMoving:function(c,e){var f=this.moveMap,b=0,a,d;if(f){if(c){if(Ext.isArray(c)){for(d=0,a=c.length;d<a;++d){b+=f[c[d].id]?1:0;}}else{if(f[c.id]){++b;}}}else{b=e?f:this.moveMapCount;
}}return b;},setLoadOptions:function(c){var d=this,a=d.getPageSize(),e,b;if(d.getRemoteSort()&&!c.grouper){b=d.getGrouper();if(b){c.grouper=b;}}if(a||"start" in c||"limit" in c||"page" in c){c.page=c.page!=null?c.page:d.currentPage;c.start=(c.start!==undefined)?c.start:(c.page-1)*a;c.limit=c.limit!=null?c.limit:a;
d.currentPage=c.page;}c.addRecords=c.addRecords||false;if(!c.recordCreator){e=d.getSession();if(e){c.recordCreator=e.recordCreator;}}d.callParent([c]);},setMoving:function(b,f){var d=this,e=d.moveMap||(d.moveMap={}),a=b.length,c,g;for(c=0;c<a;++c){g=b[c].id;if(f){if(e[g]){++e[g];}else{e[g]=1;++d.moveMapCount;
}}else{if(--e[g]===0){delete e[g];--d.moveMapCount;}}}if(d.moveMapCount===0){d.moveMap=null;}},processAssociation:function(a){var c=this,b=c.getAssociatedEntity();if(b){a=c.getRole().processLoad(c,b,a,c.getSession());}return a;}}});