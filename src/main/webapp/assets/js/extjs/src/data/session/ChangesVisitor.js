Ext.define("Ext.data.session.ChangesVisitor",{constructor:function(c){var a=this,b;a.session=c;b=c.getCrudProperties();a.result=null;a.writerOptions={};a.createKey=b.create;a.readKey=b.read;a.updateKey=b.update;a.dropKey=b.drop;},onDirtyRecord:function(f){var i=this,l=i.crud,e=f.phantom,c=f.dropped,g=!e&&!c,j=f.$className,b=(e||c)?"allDataOptions":"partialDataOptions",h=i.writerOptions,a=f.entityName,n,d,k,m;
if(e&&c){return false;}l=e?i.createKey:(c?i.dropKey:i.updateKey);h=h[j]||(h[j]={});if(c){if(!(n=h.drop)){h.drop=n={all:f.getProxy().getWriter().getWriteAllFields()};}if(!n.all){k=f.id;}}if(!k){if(!(n=h[b])){n=f.getProxy().getWriter().getConfig(b);h[b]=n=Ext.Object.chain(n);i.setupOptions(n);}k=f.getData(n);
}m=i.result||(i.result={});d=m[a]||(m[a]={});d=d[l]||(d[l]=[]);d.push(k);},setupOptions:function(a){a.serialize=true;},onMatrixChange:function(d,i,h,a){var g=this,b=d.left.type,f=d.right.role,e=a<0?g.dropKey:g.createKey,c,j;j=g.result||(g.result={});c=j[b]||(j[b]={});c=c[f]||(c[f]={});c=c[e]||(c[e]={});
c=c[i]||(c[i]=[]);c.push(h);}});