Ext.define("Ext.data.schema.Role",{isRole:true,left:true,owner:false,side:"left",isMany:false,defaultReaderType:"json",_internalReadOptions:{recordsOnly:true,asRoot:true},constructor:function(b,c){var d=this,a=c.extra;Ext.apply(d,c);if(a){a=Ext.apply({},a);delete a.type;Ext.apply(d,a);delete d.extra;
}d.association=b;if(b.owner===d.side){b.owner=d;d.owner=true;}},processUpdate:function(){Ext.raise('Only the "many" for an association may be processed. "'+this.role+'" is not valid.');},processLoad:function(b,c,a,d){return a;},checkMembership:Ext.emptyFn,adoptAssociated:function(b,c){var a=this.getAssociatedItem(b);
if(a){c.adopt(a);}},$roleFilterId:"$associationRoleFilter",createAssociationStore:function(f,k,e,l){var h=this,d=h.association,g=d.getFieldName(),i=d.isManyToMany,b=h.storeConfig,a=k.getId(),c={asynchronousLoad:false,model:h.cls,role:h,session:f,associatedEntity:k,disableMetaChangeEvent:true,pageSize:null,remoteFilter:true,trackRemoved:!f},j;
if(i){c.filters=[{id:h.$roleFilterId,property:h.inverse.field,value:a,exactMatch:true}];}else{if(g){c.filters=[{id:h.$roleFilterId,property:g,value:a,exactMatch:true}];c.foreignKeyName=g;}}if(b){Ext.apply(c,b);}j=Ext.Factory.store(c);h.onStoreCreate(j,f,a);if(!i||f){j.on({scope:h,add:"onAddToMany",remove:"onRemoveFromMany",clear:"onRemoveFromMany"});
}if(e){j.loadData(e);}j.complete=!!l;return j;},onStoreCreate:Ext.emptyFn,getAssociatedStore:function(q,e,b,t,v){var x=this,o=x.getStoreName(),f=q[o],m=f,a=q.session,k=e&&e.reload,p=q.$source,g=false,l=false,j,c,s,u,n,h,d,w,r;if(!f){if(a){if(p){l=p.phantom;}if(!t&&p){d=p[o];if(d&&!d.isLoading()){t=[];
n=d.getData().items;for(s=0,u=n.length;s<u;++s){h=n[s];t.push(a.getRecord(h.self,h.id));}g=!!d.complete;j=true;}}if(!j){w=!!t;t=x.findRecords(a,q,t,v);if(!w&&(!t||!t.length)){t=null;}g=l||w;}}else{g=!!t;}f=x.createAssociationStore(a,q,t,g||q.phantom);f.$source=d;if(!t&&(x.autoLoad||e)){k=true;}q[o]=f;
}if(e){if(k||f.isLoading()){f.on("load",function(z,y,A,i){c=[z,i];b=b||e.scope||q;if(A){Ext.callback(e.success,b,c);}else{Ext.callback(e.failure,b,c);}c.push(A);Ext.callback(e,b,c);Ext.callback(e.callback,b,c);},null,{single:true});}else{c=[f,null];b=b||e.scope||q;Ext.callback(e.success,b,c);c.push(true);
Ext.callback(e,b,c);Ext.callback(e.callback,b,c);}}r=f.isLoading();if(k){if(!r){f.load();}}else{if(m&&t&&!r){f.loadData(t);}}return f;},getAssociatedItem:function(b){var a=this.isMany?this.getStoreName():this.getInstanceName();return b[a]||null;},onDrop:Ext.emptyFn,onIdChanged:Ext.emptyFn,getReaderRoot:function(){var a=this;
return a.associationKey||(a.associationKey=a.association.schema.getNamer().readerRoot(a.role));},getReader:function(){var c=this,a=c.reader,d=c.cls,e=!c.associationKey,b=this.getReaderRoot();if(a&&!a.isReader){if(Ext.isString(a)){a={type:a};}Ext.applyIf(a,{model:d,rootProperty:b,useSimpleAccessors:e,type:c.defaultReaderType});
a=c.reader=Ext.createByAlias("reader."+a.type,a);}return a;},getInstanceName:function(){var a=this;return a.instanceName||(a.instanceName=a.association.schema.getNamer().instanceName(a.role));},getOldInstanceName:function(){return this.oldInstanceName||(this.oldInstanceName="$old"+this.getInstanceName());
},getStoreName:function(){var a=this;return a.storeName||(a.storeName=a.association.schema.getNamer().storeName(a.role));},constructReader:function(e){var f=this,a=f.getReader(),g=f.cls,h=!f.associationKey,b=f.getReaderRoot(),c,d;if(!a){d=g.getProxy();if(d){c=d.getReader();a=new c.self();a.copyFrom(c);
a.setRootProperty(b);}else{a=new e.self({model:g,useSimpleAccessors:h,rootProperty:b});}f.reader=a;}return a;},read:function(c,f,d,e){var a=this.constructReader(d),b=a.getRoot(f);if(b){return a.readRecords(b,e,this._internalReadOptions);}},getCallbackOptions:function(a,b,c){if(typeof a==="function"){a={callback:a,scope:b||c};
}else{if(a){a=Ext.apply({},a);a.scope=b||a.scope||c;}}return a;},doGetFK:function(b,m,k){var h=this,l=h.cls,e=h.association.getFieldName(),j=h.getInstanceName(),i=b[j],a=m&&m.reload,d=i!==undefined&&!a,g=b.session,c,f;if(!d){if(g){c=b.get(e);if(c||c===0){d=g.peekRecord(l,c,true)&&!a;i=g.getRecord(l,c,false);
}else{d=true;b[j]=i=null;}}else{if(e){c=b.get(e);if(!c&&c!==0){d=true;b[j]=i=null;}else{if(!i){i=l.createWithId(c);}}}else{d=true;i=null;}}}else{if(i){d=!i.isLoading();}}if(d){if(m){f=[i,null];k=k||m.scope||b;Ext.callback(m.success,k,f);f.push(true);Ext.callback(m,k,f);Ext.callback(m.callback,k,f);}}else{b[j]=i;
m=h.getCallbackOptions(m,k,b);i.load(m);}return i;},doSetFK:function(a,i,m,l){var h=this,f=h.association.getFieldName(),j=h.getInstanceName(),e=a[j],c=h.inverse,d=c.setterName,g=a.session,k,b;if(i&&i.isEntity){if(e!==i){b=h.getOldInstanceName();a[b]=e;a[j]=i;if(e&&e.isEntity){e[c.getInstanceName()]=undefined;
}if(f){a.set(f,i.getId());}delete a[b];a.onAssociatedRecordSet(i,h);if(d){i[d](a);}}}else{if(!f){Ext.raise('No foreignKey specified for "'+h.association.left.role+'" by '+a.$className);}k=(a.changingKey&&!c.isMany)||a.set(f,i);if(k&&e&&e.isEntity&&!e.isEqual(e.getId(),i)){a[j]=undefined;if(!c.isMany){e[c.getInstanceName()]=undefined;
}}}if(m){if(Ext.isFunction(m)){m={callback:m,scope:l||a};}return a.save(m);}}});