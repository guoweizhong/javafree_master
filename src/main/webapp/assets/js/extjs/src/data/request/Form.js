Ext.define("Ext.data.request.Form",{extend:"Ext.data.request.Base",alias:"request.form",start:function(d){var c=this,b=c.options,a=c.requestOptions;c.callParent([d]);c.form=c.upload(b.form,a.url,a.data,b);return c;},abort:function(b){var a=this,d;if(a.isLoading()){try{d=a.frame.dom;if(d.stop){d.stop();
}else{d.document.execCommand("Stop");}}catch(c){}}a.callParent([b]);a.onComplete();a.cleanup();},cleanup:function(){var a=this,b=a.frame;if(b){b.un("load",a.onComplete,a);Ext.removeNode(b);}a.frame=a.form=null;},isLoading:function(){return !!this.frame;},upload:function(b,g,t,f){b=Ext.getDom(b);f=f||{};
var r=document.createElement("iframe"),l=Ext.get(r),n=l.id,c=[],d="multipart/form-data",s={target:b.target,method:b.method,encoding:b.encoding,enctype:b.enctype,action:b.action},a=function(h,v){i=document.createElement("input");Ext.fly(i).set({type:"hidden",value:v,name:h});b.appendChild(i);c.push(i);
},i,k,p,u,o,j,m,q,e;l.set({name:n,cls:Ext.baseCSSPrefix+"hidden-display",src:Ext.SSL_SECURE_URL,tabIndex:-1});document.body.appendChild(r);document.body.appendChild(b);if(document.frames){document.frames[n].name=n;}Ext.fly(b).set({target:n,method:"POST",enctype:d,encoding:d,action:g||s.action});if(t){k=Ext.Object.fromQueryString(t)||{};
for(u in k){if(k.hasOwnProperty(u)){p=k[u];if(Ext.isArray(p)){o=p.length;for(j=0;j<o;j++){a(u,p[j]);}}else{a(u,p);}}}}this.frame=l;l.on({load:this.onComplete,scope:this,single:!Ext.isOpera});b.submit();document.body.removeChild(b);Ext.fly(b).set(s);for(m=c.length,q=0;q<m;q++){Ext.removeNode(c[q]);}return b;
},getDoc:function(){var a=this.frame.dom;return(a&&(a.contentWindow.document||a.contentDocument))||(window.frames[a.id]||{}).document;},getTimeout:function(){return this.options.timeout;},onComplete:function(){var g=this,b=g.frame,a=g.owner,k=g.options,i,h,j,d,c;if(!b){return;}if(g.aborted||g.timedout){g.result=c=g.createException();
c.responseXML=null;c.responseText='{success:false,message:"'+Ext.String.trim(c.statusText)+'"}';c.request=g;i=k.failure;j=false;}else{try{h=g.getDoc();g.result=c={responseText:"",responseXML:null,request:g};if(h){if(Ext.isOpera&&h.location==Ext.SSL_SECURE_URL){return;}if(h.body){if((d=h.body.firstChild)&&/pre/i.test(d.tagName)){c.responseText=d.textContent||d.innerText;
}else{if((d=h.getElementsByTagName("textarea")[0])){c.responseText=d.value;}else{c.responseText=h.body.textContent||h.body.innerText;}}}c.responseXML=h.XMLDocument||h;i=k.success;j=true;c.status=200;}else{Ext.raise("Could not acquire a suitable connection for the file upload service.");}}catch(f){g.result=c=g.createException();
c.status=400;c.statusText=(f.message||f.description)+"";c.responseText='{success:false,message:"'+Ext.String.trim(c.statusText)+'"}';c.responseXML=null;i=k.failure;j=false;}}g.frame=null;g.success=j;a.fireEvent(j?"requestcomplete":"requestexception",a,c,k);Ext.callback(i,k.scope,[c,k]);Ext.callback(k.callback,k.scope,[k,j,c]);
a.onRequestComplete(g);Ext.asap(b.destroy,b);g.callParent();},destroy:function(){this.cleanup();this.callParent();}});