Ext.define("Ext.data.schema.ManyToOne",{extend:"Ext.data.schema.Association",isManyToOne:true,isToOne:true,kind:"many-to-one",Left:Ext.define(null,{extend:"Ext.data.schema.Role",isMany:true,onDrop:function(g,e){var f=this,j=f.getAssociatedItem(g),b,d,c,h,a;if(j){b=j.removeAll();if(b&&f.inverse.owner){for(c=0,d=b.length;
c<d;++c){b[c].drop();}}j.destroy();g[f.getStoreName()]=null;}else{if(e){b=e.getRefs(g,f);if(b){for(a in b){b[a].drop();}}}}},onIdChanged:function(g,b,c){var j=this.association.getFieldName(),h=this.getAssociatedItem(g),d,e,f,a;if(h){a=h.getFilters().get(this.$roleFilterId);if(a){a.setValue(c);}if(!g.session&&j){d=h.getDataSource().items;
for(e=0,f=d.length;e<f;++e){d[e].set(j,c);}}}},processUpdate:function(f,b){var g=this,d=g.inverse.cls,e=b.R,a,h,i,c;if(e){for(a in e){h=f.peekRecord(d,a);if(h){c=f.getEntityList(g.cls,e[a]);i=g.getAssociatedItem(h);if(i){i.loadData(c);i.complete=true;}else{h[g.getterName](null,null,c);}}else{f.onInvalidAssociationEntity(d,a);
}}}},findRecords:function(h,j,d,n){var g=d,k=h.getRefs(j,this,true),l=this.association.field,m,c,b,e,f,a;if(l&&(k||n)){m=l.name;g=[];if(d){a={};for(e=0,f=d.length;e<f;++e){c=d[e];b=c.id;if(k&&k[b]){g.push(c);}else{if(n&&c.data[m]===undefined){g.push(c);c.data[m]=j.id;h.updateReference(c,l,j.id,undefined);
}}a[b]=true;}}if(k){for(b in k){if(!a||!a[b]){g.push(k[b]);}}}}return g;},processLoad:function(b,a,e,d){var c=e;if(d){c=this.findRecords(d,a,e,true);}this.onLoadMany(a,c,d);return c;},adoptAssociated:function(b,f){var c=this.getAssociatedItem(b),e,d,a;if(c){c.setSession(f);e=c.getData().items;for(d=0,a=e.length;
d<a;++d){f.adopt(e[d]);}}},createGetter:function(){var a=this;return function(b,c,d){return a.getAssociatedStore(this,b,c,d,true);};},createSetter:null,onAddToMany:function(b,c){var a=b.getAssociatedEntity();if(this.association.field){this.syncFK(c,a,false);}else{this.setInstances(a,c);}},onLoadMany:function(a,c,b){this.setInstances(a,c,b);
},onRemoveFromMany:function(a,b){if(this.association.field){this.syncFK(b,a.getAssociatedEntity(),true);}else{this.setInstances(null,b);}},read:function(g,a,k,c){var f=this,j=f.inverse.getInstanceName(),b=f.callParent([g,a,k,c]),h,e,d;if(b){h=g[f.getterName](null,null,b);delete g.data[f.role];b=h.getData().items;
for(d=0,e=b.length;d<e;++d){b[d][j]=g;}}},setInstances:function(k,e,j){var m=this.inverse.getInstanceName(),b=k?k.getId():null,l=this.association.field,h=e.length,g,d,c,f,a;for(g=0;g<h;++g){d=e[g];d[m]=k;if(l){a=l.name;f=d.data;c=f[a];if(c!==b){f[a]=b;if(j){j.updateReference(d,l,b,c);}}}}},syncFK:function(e,k,l){var j=this.association.getFieldName(),g=this.inverse,f=g.setterName,m=g.getInstanceName(),h=e.length,b=k.getId(),a,d,c;
while(h-->0){d=e[h];a=!d.isEqual(b,d.get(j));c=l?null:k;if(a!==l){d.changingKey=true;d[f](c);d.changingKey=false;}else{d[m]=c;}}}}),Right:Ext.define(null,{extend:"Ext.data.schema.Role",left:false,side:"right",onDrop:function(c,b){var a=this.association.field;if(a){c.set(a.name,null);}c[this.getInstanceName()]=null;
},createGetter:function(){var a=this;return function(b,c){return a.doGetFK(this,b,c);};},createSetter:function(){var a=this;return function(b,c,d){return a.doSetFK(this,b,c,d);};},checkMembership:function(c,d){var b=this.association.field,a;if(b){a=this.getSessionStore(c,d.get(b.name));if(a&&!a.contains(d)){a.add(d);
}}},onValueChange:function(d,g,b,a){var h=this,l=h.getInstanceName(),n=h.cls,c,m,k,e,j,f;if(!d.changingKey){c=b||b===0;if(!c){d[l]=null;}if(g){k=h.getSessionStore(g,a);if(k){k.remove(d);}if(c){k=h.getSessionStore(g,b);if(k&&!k.isLoading()){k.add(d);}if(n){f=g.peekRecord(n,b);}d[l]=f||undefined;}}else{m=d.joined;
if(m){for(e=m.length-1;e>=0;e--){k=m[e];if(k.isStore){j=k.getAssociatedEntity();if(j&&j.self===h.cls&&j.getId()===a){k.remove(d);}}}}}}if(h.owner&&b===null){h.association.schema.queueKeyCheck(d,h);}},checkKeyForDrop:function(b){var a=this.association.field;if(b.get(a.name)===null){b.drop();}},getSessionStore:function(c,b){var a=this.cls,d;
if(a){d=c.peekRecord(a,b);if(d){return this.inverse.getAssociatedItem(d);}}},read:function(f,c,b,e){var d=this.callParent([f,c,b,e]),a;if(d){a=d[0];if(a){f[this.getInstanceName()]=a;delete f.data[this.role];}}}})});