Ext.define("Ext.data.NodeInterface",{requires:["Ext.data.field.Boolean","Ext.data.field.Integer","Ext.data.field.String","Ext.data.writer.Json","Ext.mixin.Observable"],statics:{decorate:function(b){var d=Ext.data.schema.Schema.lookupEntity(b),f=d.prototype,a,c,e;if(!d.prototype.isObservable){d.mixin(Ext.mixin.Observable.prototype.mixinId,Ext.mixin.Observable);
}if(f.isNode){return;}a=f.idProperty;c=d.getField(a);e=c.type;d.override(this.getPrototypeBody());d.addFields([{name:"parentId",type:e,defaultValue:null,allowNull:c.allowNull},{name:"index",type:"int",defaultValue:-1,persist:false,convert:null},{name:"depth",type:"int",defaultValue:0,persist:false,convert:null},{name:"expanded",type:"bool",defaultValue:false,persist:false,convert:null},{name:"expandable",type:"bool",defaultValue:true,persist:false,convert:null},{name:"checked",type:"auto",defaultValue:null,persist:false,convert:null},{name:"leaf",type:"bool",defaultValue:false},{name:"cls",type:"string",defaultValue:"",persist:false,convert:null},{name:"iconCls",type:"string",defaultValue:"",persist:false,convert:null},{name:"icon",type:"string",defaultValue:"",persist:false,convert:null},{name:"glyph",type:"string",defaultValue:"",persist:false,convert:null},{name:"root",type:"boolean",defaultValue:false,persist:false,convert:null},{name:"isLast",type:"boolean",defaultValue:false,persist:false,convert:null},{name:"isFirst",type:"boolean",defaultValue:false,persist:false,convert:null},{name:"allowDrop",type:"boolean",defaultValue:true,persist:false,convert:null},{name:"allowDrag",type:"boolean",defaultValue:true,persist:false,convert:null},{name:"loaded",type:"boolean",defaultValue:false,persist:false,convert:null},{name:"loading",type:"boolean",defaultValue:false,persist:false,convert:null},{name:"href",type:"string",defaultValue:"",persist:false,convert:null},{name:"hrefTarget",type:"string",defaultValue:"",persist:false,convert:null},{name:"qtip",type:"string",defaultValue:"",persist:false,convert:null},{name:"qtitle",type:"string",defaultValue:"",persist:false,convert:null},{name:"qshowDelay",type:"int",defaultValue:0,persist:false,convert:null},{name:"children",type:"auto",defaultValue:null,persist:false,convert:null},{name:"visible",type:"boolean",defaultValue:true,persist:false},{name:"text",type:"string",persist:false}]);
},getPrototypeBody:function(){var a={idchanged:true,append:true,remove:true,move:true,insert:true,beforeappend:true,beforeremove:true,beforemove:true,beforeinsert:true,expand:true,collapse:true,beforeexpand:true,beforecollapse:true,sort:true},b={silent:true};return{isNode:true,firstChild:null,lastChild:null,parentNode:null,previousSibling:null,nextSibling:null,constructor:function(){var c=this;
c.mixins.observable.constructor.call(c);c.callParent(arguments);c.childNodes=[];return c;},createNode:function(c){var i=this,g=i.childType,l,j,e,k,h,f,d=i.self;if(!c.isModel){if(g){d=i.schema.getEntity(g);}else{l=i.getTreeStore();j=l&&l.getProxy().getReader();e=i.getProxy();k=e?e.getReader():null;h=!j||(k&&k.initialConfig.typeProperty)?k:j;
if(h){f=h.getTypeProperty();if(f){d=h.getChildType(i.schema,c,f);}}}c=new d(c);}if(!c.childNodes){c.firstChild=c.lastChild=c.parentNode=c.previousSibling=c.nextSibling=null;c.childNodes=[];}return c;},isLeaf:function(){return this.get("leaf")===true;},setFirstChild:function(c){this.firstChild=c;},setLastChild:function(c){this.lastChild=c;
},updateInfo:function(h,d){var j=this,e=j.phantom,l;h={silent:true,commit:h};if(d.depth!=null&&d.depth!==j.data.depth){var k={depth:d.depth+1},c=j.childNodes,f=c.length,g;for(g=0;g<f;g++){c[g].updateInfo(h,k);}}l=j.set(d,h);j.phantom=e;return l;},isLast:function(){return this.get("isLast");},isFirst:function(){return this.get("isFirst");
},hasChildNodes:function(){return !this.isLeaf()&&this.childNodes.length>0;},isExpandable:function(){var c=this;if(c.get("expandable")){return !(c.isLeaf()||(c.isLoaded()&&!c.phantom&&!c.hasChildNodes()));}return false;},triggerUIUpdate:function(){this.callJoined("afterEdit",[]);},appendChild:function(g,r,j){var o=this,k,n,m,q,c,t={isLast:true,parentId:o.getId(),depth:(o.data.depth||0)+1},s,f=o.getTreeStore(),e=f&&f.triStateCheckbox?1:false,d=f&&f.bulkUpdate,l,h,p;
Ext.suspendLayouts();if(Ext.isArray(g)){n=g.length;s=new Array(n);o.callTreeStore("beginFill");for(k=0;k<n;k++){s[k]=o.appendChild(g[k],r,j);}o.callTreeStore("endFill",[s]);}else{g=o.createNode(g);if(r!==true&&o.fireBubbledEvent("beforeappend",[o,g])===false){Ext.resumeLayouts(true);return false;}m=o.childNodes.length;
q=g.parentNode;if(q){if(r!==true&&g.fireBubbledEvent("beforemove",[g,q,o,m])===false){Ext.resumeLayouts(true);return false;}if(q.removeChild(g,false,r,q.getTreeStore()===f)===false){Ext.resumeLayouts(true);return false;}}f&&f.beginUpdate();m=o.childNodes.length;if(m===0){o.setFirstChild(g);}o.childNodes[m]=g;
g.parentNode=o;g.nextSibling=null;o.setLastChild(g);c=o.childNodes[m-1];if(c){g.previousSibling=c;c.nextSibling=g;c.updateInfo(j,{isLast:false});if(!d){c.triggerUIUpdate();}}else{g.previousSibling=null;}t.isFirst=m===0;t.index=m;p=g.updateInfo(j,t);if(o.isLeaf()){o.set("leaf",false);}if(!o.isLoaded()){if(d){o.data.loaded=true;
}else{o.set("loaded",true);}}else{if(o.childNodes.length===1&&!d){o.triggerUIUpdate();}}if(m&&o.childNodes[m-1].isExpanded()&&!d){o.childNodes[m-1].cascade(o.triggerUIUpdate);}if(f){f.registerNode(o,!d);if(d){f.registerNode(g);}}if(r!==true){o.fireBubbledEvent("append",[o,g,m]);if(q){g.fireBubbledEvent("move",[g,q,o,m]);
}}o.callTreeStore("onNodeAppend",[g,m]);if(p){g.callJoined("afterEdit",[p]);}s=g;if(f){f.endUpdate();}}Ext.resumeLayouts(true);return s;},getOwnerTree:function(){var c=this.getTreeStore();return c&&c.ownerTree;},getTreeStore:function(){var c=this;while(c&&!c.treeStore){c=c.parentNode;}return c&&c.treeStore;
},removeChild:function(h,f,p,o){var n=this,m=n.indexOf(h),k,j,d,g=n.getTreeStore(),e=g&&g.bulkUpdate,l,c=[];if(m===-1||(p!==true&&n.fireBubbledEvent("beforeremove",[n,h,!!o])===false)){return false;}Ext.suspendLayouts();g&&g.beginUpdate();Ext.Array.erase(n.childNodes,m,1);if(n.firstChild===h){n.setFirstChild(h.nextSibling);
}if(n.lastChild===h){n.setLastChild(h.previousSibling);}d=h.previousSibling;if(d){h.previousSibling.nextSibling=h.nextSibling;}if(h.nextSibling){h.nextSibling.previousSibling=h.previousSibling;if(m===0){h.nextSibling.updateInfo(false,{isFirst:true});}for(k=m,j=n.childNodes.length;k<j;k++){n.childNodes[k].updateInfo(false,{index:k});
}}else{if(d){d.updateInfo(false,{isLast:true});if(!e){if(d.isExpanded()){d.cascade(n.triggerUIUpdate);}else{d.triggerUIUpdate();}}}}if(!n.childNodes.length&&!e){n.triggerUIUpdate();}Ext.resumeLayouts(true);if(p!==true){l={parentNode:h.parentNode,previousSibling:h.previousSibling,nextSibling:h.nextSibling};
n.callTreeStore("beforeNodeRemove",[[h],!!o,c]);h.previousSibling=h.nextSibling=h.parentNode=null;n.fireBubbledEvent("remove",[n,h,!!o,l]);n.callTreeStore("onNodeRemove",[[h],!!o,c]);}if(f){h.erase(true);}else{h.clear();}if(!o){h.set({parentId:null,lastParentId:n.getId()},b);}if(g){g.endUpdate();}return h;
},copy:function(g,k,e){var j=this,d,f=[g],c=j.childNodes?j.childNodes.length:0,h;if(k&&k.isSession){f.push(k);}else{if(arguments.length<3){e=k;}}d=j.callParent(f);if(e){for(h=0;h<c;h++){d.appendChild(j.childNodes[h].copy(undefined,true));}}return d;},clear:function(d,c){var e=this,f;e.parentNode=e.previousSibling=e.nextSibling=null;
if(d){e.firstChild=e.lastChild=e.childNodes=null;}if(c){e.firstChild=e.lastChild=null;e.childNodes.length=0;if(e.data){e.data.children=null;}}},drop:function(){var g=this,j=g.childNodes,d=g.parentNode,c,e,f,h=g.getTreeStore();g.callParent();if(d){d.removeChild(g);}else{if(g.get("root")){h.setRoot(null);
}}h&&h.beginUpdate();for(e=0,c=j?j.length:0;e<c;e++){f=j[e];f.clear();f.drop();}h&&h.endUpdate();},erase:function(d){var g=this,h=g.childNodes,c=h&&h.length,e,f;g.remove();g.clear(true);g.callParent([d]);for(e=0;e<c;e++){f=h[e];f.parentNode=null;f.erase(d);}},insertBefore:function(g,l,r){var m=this,k=m.indexOf(l),o=g.parentNode,q=k,h,c,j,f=m.getTreeStore(),d=f&&f.bulkUpdate,n,p,e;
if(!l){return m.appendChild(g);}if(g===l){return false;}g=m.createNode(g);if(r!==true&&m.fireBubbledEvent("beforeinsert",[m,g,l])===false){return false;}if(o===m&&m.indexOf(g)<k){q--;}if(o){if(r!==true&&g.fireBubbledEvent("beforemove",[g,o,m,k,l])===false){return false;}if(o.removeChild(g,false,r,o.getTreeStore()===f)===false){return false;
}}f&&f.beginUpdate();if(q===0){m.setFirstChild(g);}Ext.Array.splice(m.childNodes,q,0,g);g.parentNode=m;g.nextSibling=l;l.previousSibling=g;c=m.childNodes[q-1];if(c){g.previousSibling=c;c.nextSibling=g;}else{g.previousSibling=null;}n=g.updateInfo(false,{parentId:m.getId(),index:q,isFirst:q===0,isLast:false,depth:(m.data.depth||0)+1});
for(j=q+1,h=m.childNodes.length;j<h;j++){p=m.childNodes[j];e=p.updateInfo(false,{index:j});if(e){p.callJoined("afterEdit",[e]);}}if(!m.isLoaded()){if(d){m.data.loaded=true;}else{m.set("loaded",true);}}else{if(m.childNodes.length===1&&!d){m.triggerUIUpdate();}}if(f){f.registerNode(m,!d);}if(r!==true){m.fireBubbledEvent("insert",[m,g,l]);
if(o){g.fireBubbledEvent("move",[g,o,m,q,l]);}}m.callTreeStore("onNodeInsert",[g,q]);if(n){g.callJoined("afterEdit",[n]);}if(f){f.endUpdate();}return g;},insertChild:function(c,e){var d=this.childNodes[c];if(d){return this.insertBefore(e,d);}else{return this.appendChild(e);}},isLastVisible:function(){var e=this,c=e.data.isLast,d=e.nextSibling;
if(!c&&e.getTreeStore().isFiltered()){while(d){if(d.data.visible){return false;}d=d.nextSibling;}return true;}return c;},remove:function(d,e){var f=this,c=f.parentNode;if(c){c.removeChild(f,d,e);}else{if(d){f.erase(true);}}return f;},removeAll:function(d,m,g){var k=this,l=k.childNodes,j=l.length,f,e,h,c=[];
if(!j){return k;}if(!g){e=k.getTreeStore();if(e){e.beginUpdate();e.suspendEvent("remove");k.callTreeStore("beforeNodeRemove",[l,false,c]);}}for(h=0;h<j;++h){f=l[h];f.previousSibling=f.nextSibling=f.parentNode=null;k.fireBubbledEvent("remove",[k,f,false]);if(d){f.erase(true);}else{f.removeAll(false,m,true);
}}if(!g&&e){e.resumeEvent("remove");k.callTreeStore("onNodeRemove",[l,false,c]);e.endUpdate();}k.firstChild=k.lastChild=null;l.length=0;if(!g){k.triggerUIUpdate();}return k;},getChildAt:function(c){return this.childNodes[c];},replaceChild:function(c,f,e){var d=f?f.nextSibling:null;this.removeChild(f,false,e);
this.insertBefore(c,d,e);return f;},indexOf:function(c){return Ext.Array.indexOf(this.childNodes,c);},indexOfId:function(f){var e=this.childNodes,c=e.length,d=0;for(;d<c;++d){if(e[d].getId()===f){return d;}}return -1;},getPath:function(f,e){f=f||this.idProperty;e=e||"/";var d=[this.get(f)],c=this.parentNode;
while(c){d.unshift(c.get(f));c=c.parentNode;}return e+d.join(e);},getDepth:function(){return this.get("depth");},bubble:function(e,d,c){var f=this;while(f){if(e.apply(d||f,c||[f])===false){break;}f=f.parentNode;}},cascade:function(k,l,f,c){var g=this,h=k;if(arguments.length===1&&!Ext.isFunction(k)){c=k.after;
l=k.scope;f=k.args;h=k.before;}if(!h||h.apply(l||g,f||[g])!==false){var j=g.childNodes,d=j.length,e;for(e=0;e<d;e++){j[e].cascade.call(j[e],h,l,f,c);}if(c){c.apply(l||g,f||[g]);}}},cascadeBy:function(){return this.cascade.apply(this,arguments);},eachChild:function(f,e,c){var h=this.childNodes,g=h.length,d;
for(d=0;d<g;d++){if(f.apply(e||this,c||[h[d]])===false){break;}}},findChild:function(d,e,c){return this.findChildBy(function(){return this.get(d)==e;},null,c);},findChildBy:function(j,h,d){var g=this.childNodes,c=g.length,f=0,k,e;for(;f<c;f++){k=g[f];if(j.call(h||k,k)===true){return k;}else{if(d){e=k.findChildBy(j,h,d);
if(e!==null){return e;}}}}return null;},contains:function(c){return c.isAncestor(this);},isAncestor:function(c){var d=this.parentNode;while(d){if(d===c){return true;}d=d.parentNode;}return false;},sort:function(l,e,k){var h=this,j=h.childNodes,g=j.length,f,d,c={isFirst:true};if(g>0){if(!l){l=h.getTreeStore().getSortFn();
}Ext.Array.sort(j,l);h.setFirstChild(j[0]);h.setLastChild(j[g-1]);for(f=0;f<g;f++){d=j[f];d.previousSibling=j[f-1];d.nextSibling=j[f+1];c.isLast=(f===g-1);c.index=f;d.updateInfo(false,c);c.isFirst=false;if(e&&!d.isLeaf()){d.sort(l,true,true);}}if(k!==true){h.fireBubbledEvent("sort",[h,j]);h.callTreeStore("onNodeSort",[j]);
}}},isExpanded:function(){return this.get("expanded");},isLoaded:function(){return this.get("loaded");},isBranchLoaded:function(){var c=!this.isLeaf()&&this.isLoaded();if(c){this.cascade(function(d){if(!d.isLeaf()){c=c||d.isBranchLoaded();}return c;});}return c;},isLoading:function(){return this.get("loading");
},isRoot:function(){return !this.parentNode;},isVisible:function(){var c=this.parentNode;while(c){if(!c.isExpanded()){return false;}c=c.parentNode;}return true;},expand:function(c,h,d){var e=this,f,g;if(!e.isLeaf()){if(e.isLoading()){e.on("expand",function(){e.expand(c,h,d);},e,{single:true});}else{if(!e.isExpanded()){if(e.fireBubbledEvent("beforeexpand",[e])!==false){if(c){if(e.parentNode&&e.parentNode.isSynchronousRecursiveExpand){e.isSynchronousRecursiveExpand=true;
}else{f=e.getTreeStore();if(f.getProxy().isSynchronous||e.isBranchLoaded()){e.isSynchronousRecursiveExpand=true;f.suspendEvent("add","datachanged");g=true;}}}e.callTreeStore("onBeforeNodeExpand",[e.onChildNodesAvailable,e,[c,h,d]]);if(g){f.resumeEvent("add","datachanged");f.fireEvent("datachanged",f);
f.fireEvent("refresh",f);}e.isSynchronousRecursiveExpand=false;}}else{if(c){e.expandChildren(true,h,d);}else{Ext.callback(h,d||e,[e.childNodes]);}}}}else{Ext.callback(h,d||e);}},onChildNodesAvailable:function(f,e,l,m){var j=this,d=j.getTreeStore(),c=d&&d.bulkUpdate,h,g,k;Ext.suspendLayouts();for(h=j.parentNode;
h;h=h.parentNode){if(!h.isExpanded()){(k||(k=[])).unshift(h);}}if(c||!d.isVisible(j)){j.data.expanded=true;}else{j.set("expanded",true);}if(k){for(g=1;g<k.length;g++){h=k[g];if(c||!d.isVisible(h)){h.data.expanded=true;}else{h.set("expanded",true);}}k[0].expand();for(g=1;g<k.length;g++){h=k[g];h.fireBubbledEvent("expand",[h,h.childNodes]);
}}else{j.callTreeStore("onNodeExpand",[f,false]);}j.fireBubbledEvent("expand",[j,f]);if(e){j.expandChildren(true,l,m);}else{Ext.callback(l,m||j,[j.childNodes]);}Ext.resumeLayouts(true);},expandChildren:function(g,n,o,h){var l=this,m,j,d,c,k,f,e;if(Ext.isBoolean(n)){m=n;n=o;o=h;h=m;}if(h===undefined){e=l.getTreeStore();
h=e&&e.singleExpand;}d=l.childNodes;c=[];k=h?Math.min(d.length,1):d.length;for(j=0;j<k;++j){f=d[j];if(!f.isLeaf()){c[c.length]=f;}}k=c.length;for(j=0;j<k;++j){c[j].expand(g);}if(n){Ext.callback(n,o||l,[l.childNodes]);}},collapse:function(e,l,m){var k=this,h=k.isExpanded(),d=k.getTreeStore(),c=d&&d.bulkUpdate,j=k.childNodes.length,f,g;
if(!k.isLeaf()&&((!h&&e)||k.fireBubbledEvent("beforecollapse",[k])!==false)){Ext.suspendLayouts();if(k.isExpanded()){if(e){g=function(){for(f=0;f<j;f++){k.childNodes[f].setCollapsed(true);}};if(l){l=Ext.Function.createSequence(g,Ext.Function.bind(l,m,[k.childNodes]));}else{l=g;}}else{if(l){l=Ext.Function.bind(l,m,[k.childNodes]);
}}if(c||!d.contains(k)){k.data.expanded=false;}else{k.set("expanded",false);}k.callTreeStore("onNodeCollapse",[k.childNodes,l,m]);k.fireBubbledEvent("collapse",[k,k.childNodes]);l=null;}else{if(e){for(f=0;f<j;f++){k.childNodes[f].setCollapsed(true);}}}Ext.resumeLayouts(true);}Ext.callback(l,m||k,[k.childNodes]);
},setCollapsed:function(d){var f=this,c=f.childNodes.length,e;if(!f.isLeaf()&&f.fireBubbledEvent("beforecollapse",[f])!==false){f.data.expanded=false;f.fireBubbledEvent("collapse",[f,f.childNodes]);if(d){for(e=0;e<c;e++){f.childNodes[e].setCollapsed(true);}}}},collapseChildren:function(e,k,l){var j=this,g,c=j.childNodes,h=c.length,f=[],d;
for(g=0;g<h;++g){d=c[g];if(!d.isLeaf()&&d.isLoaded()&&d.isExpanded()){f.push(d);}}h=f.length;if(h){for(g=0;g<h;++g){d=f[g];if(g===h-1){d.collapse(e,k,l);}else{d.collapse(e);}}}else{Ext.callback(k,l);}},fireEvent:function(c){return this.fireBubbledEvent(c,Ext.Array.slice(arguments,1));},fireBubbledEvent:function(d,f){var c,g,e;
if(a[d]){for(g=this;c!==false&&g;g=(e=g).parentNode){c=g.fireEventArgs.call(g,d,f);}if(c!==false){g=e.getTreeStore();if(g&&g.hasListeners&&g.hasListeners[d="node"+d]){c=g.fireEventArgs(d,f);}}return c;}else{return this.fireEventArgs.apply(this,arguments);}},serialize:function(e){var h=e||new Ext.data.writer.Json({writeAllFields:true}),d=h.getRecordData(this),j=this.childNodes,c=j.length,g,f;
if(c>0){d.children=g=[];for(f=0;f<c;f++){g.push(j[f].serialize(h));}}return d;},callTreeStore:function(g,c){var e=this,f=e.getTreeStore(),d=f&&f[g];if(f&&d){c=c||[];if(c[0]!==e){c.unshift(e);}d.apply(f,c);}},addCls:function(c){this.replaceCls(null,c);},removeCls:function(c){this.replaceCls(c);},replaceCls:function(c,e){var d=this._parseCls(this.data.cls),f=this._parseCls(c);
if(f.length){d=Ext.Array.difference(d,f);}f=this._parseCls(e);if(f.length){d=Ext.Array.unique(d.concat(f));}this.set("cls",d.join(" "));},toggleCls:function(d,g){if(g===undefined){var f=this._parseCls(this.data.cls),j=this._parseCls(d),c=j.length,e,h;for(e=0;e<c;++e){h=j[e];if(Ext.Array.contains(f,h)){Ext.Array.remove(f,h);
}else{f.push(h);}}this.set("cls",f.join(" "));}else{if(g){this.addCls(d);}else{this.removeCls(d);}}},privates:{_noCls:[],spacesRe:/\s+/,join:function(c){if(c.isTreeStore){if(this.isRoot()){this.treeStore=this.store=c;}}else{this.callParent([c]);}},callJoined:function(d,c){this.callParent([d,c]);this.callTreeStore(d,c);
},_parseCls:function(c){if(!c){return this._noCls;}if(typeof c==="string"){return c.split(this.spacesRe);}return c;}}};}}});