Ext.define("Ext.data.Connection",{mixins:{observable:"Ext.mixin.Observable"},requires:["Ext.data.request.Ajax","Ext.data.request.Form","Ext.data.flash.BinaryXhr","Ext.Deferred"],statics:{requestId:0},enctypeRe:/multipart\/form-data/i,config:{url:null,async:true,username:"",password:"",disableCaching:true,withCredentials:false,binary:false,cors:false,isXdr:false,defaultXdrContentType:"text/plain",disableCachingParam:"_dc",timeout:30000,extraParams:null,autoAbort:false,method:null,defaultHeaders:null,defaultPostHeader:"application/x-www-form-urlencoded; charset=UTF-8",useDefaultXhrHeader:true,defaultXhrHeader:"XMLHttpRequest"},constructor:function(a){this.mixins.observable.constructor.call(this,a);
this.requests={};},request:function(b){b=b||{};var d=this,a,c;if(d.fireEvent("beforerequest",d,b)!==false){a=d.setOptions(b,b.scope||Ext.global);c=d.createRequest(b,a);return c.start(a.data);}c={status:-1,statusText:"Request cancelled in beforerequest event handler"};Ext.callback(b.callback,b.scope,[b,false,c]);
return Ext.Deferred.rejected([b,false,c]);},createRequest:function(b,a){var e=this,c=b.type||a.type,d;if(!c){c=e.isFormUpload(b)?"form":"ajax";}if(b.autoAbort||e.getAutoAbort()){e.abort();}d=Ext.Factory.request({type:c,owner:e,options:b,requestOptions:a,ownerConfig:e.getConfig()});e.requests[d.id]=d;
e.latestId=d.id;return d;},isFormUpload:function(a){var b=this.getForm(a);if(b){return a.isUpload||this.enctypeRe.test(b.getAttribute("enctype"));}return false;},getForm:function(a){return Ext.getDom(a.form);},setOptions:function(l,k){var i=this,e=l.params||{},h=i.getExtraParams(),d=l.urlParams,c=l.url||i.getUrl(),g=l.cors,j=l.jsonData,b,a,f;
if(g!==undefined){i.setCors(g);}if(Ext.isFunction(e)){e=e.call(k,l);}if(Ext.isFunction(c)){c=c.call(k,l);}c=this.setupUrl(l,c);if(!c){Ext.raise({options:l,msg:"No URL specified"});}f=l.rawData||l.binaryData||l.xmlData||j||null;if(j&&!Ext.isPrimitive(j)){f=Ext.encode(f);}if(l.binaryData){if(!Ext.isArray(l.binaryData)){Ext.log.warn("Binary submission data must be an array of byte values! Instead got "+typeof(l.binaryData));
}if(i.nativeBinaryPostSupport()){f=(new Uint8Array(l.binaryData));if((Ext.isChrome&&Ext.chromeVersion<22)||Ext.isSafari||Ext.isGecko){f=f.buffer;}}}if(Ext.isObject(e)){e=Ext.Object.toQueryString(e);}if(Ext.isObject(h)){h=Ext.Object.toQueryString(h);}e=e+((h)?((e)?"&":"")+h:"");d=Ext.isObject(d)?Ext.Object.toQueryString(d):d;
e=this.setupParams(l,e);b=(l.method||i.getMethod()||((e||f)?"POST":"GET")).toUpperCase();this.setupMethod(l,b);a=l.disableCaching!==false?(l.disableCaching||i.getDisableCaching()):false;if(b==="GET"&&a){c=Ext.urlAppend(c,(l.disableCachingParam||i.getDisableCachingParam())+"="+(new Date().getTime()));
}if((b=="GET"||f)&&e){c=Ext.urlAppend(c,e);e=null;}if(d){c=Ext.urlAppend(c,d);}return{url:c,method:b,data:f||e||null};},setupUrl:function(b,a){var c=this.getForm(b);if(c){a=a||c.action;}return a;},setupParams:function(a,d){var c=this.getForm(a),b;if(c&&!this.isFormUpload(a)){b=Ext.Element.serializeForm(c);
d=d?(d+"&"+b):b;}return d;},setupMethod:function(a,b){if(this.isFormUpload(a)){return"POST";}return b;},isLoading:function(a){if(!a){a=this.getLatest();}return a?a.isLoading():false;},abort:function(a){if(!a){a=this.getLatest();}if(a&&a.isLoading()){a.abort();}},abortAll:function(){var b=this.requests,a;
for(a in b){this.abort(b[a]);}},getLatest:function(){var b=this.latestId,a;if(b){a=this.requests[b];}return a||null;},clearTimeout:function(a){if(!a){a=this.getLatest();}if(a){a.clearTimer();}},onRequestComplete:function(a){delete this.requests[a.id];},nativeBinaryPostSupport:function(){return Ext.isChrome||(Ext.isSafari&&Ext.isDefined(window.Uint8Array))||(Ext.isGecko&&Ext.isDefined(window.Uint8Array));
}});