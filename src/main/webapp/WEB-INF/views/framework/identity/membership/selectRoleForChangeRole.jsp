<%@ page contentType="text/html; charset=UTF-8"%><script type="text/javascript">var current_memberids="${param.current_memberids}";var selectRoleParentWinGridPanel=Ext.getCmp("${param.parentWinGridPanelID}");var selectRoleWin=Ext.getCmp("${param.popupwinid}");Ext.require(["Ext.data.*","Ext.grid.*","Ext.tree.*","Ext.form.ComboBox","Ext.util.*","Ext.grid.plugin.BufferedRenderer","Ext.toolbar.Paging","Ext.ux.ProgressBarPager","Ext.ux.form.SearchField","Ext.ux.CheckColumn"]);var ICONPATH=javafree.CONTEXTPATH+"/assets/images/";Ext.onReady(function(){var d=50;var e=javafree.CONTEXTPATH+"/identity/role/doGetRoleGridJson";var c=Ext.create("Ext.data.Store",{fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"note",type:"string"},{name:"createDate",type:"string"},{name:"sn",type:"int"}],pageSize:d,proxy:{type:"jsonp",enablePaging:true,url:e,reader:{rootProperty:"rows",totalProperty:"total"},simpleSortMode:true},autoLoad:true,remoteSort:true,sorters:{property:"sn",direction:"ASC"}});var b=[{width:180,fieldLabel:"查询",emptyText:"角色名称...",labelWidth:30,xtype:"searchfield",fieldStyle:"border-left: 0px!important;border-top: 0px!important;border-bottom: 0px!important;",store:c},{pressed:false,cls:"x-btn-text-icon",icon:ICONPATH+"button/accept.png",text:"确定选择",handler:function(){a()}},"-",{pressed:false,cls:"x-btn-text-icon",icon:ICONPATH+"button/delete.png",text:"关闭窗口",handler:function(){if(selectRoleWin){selectRoleWin.close()}}}];function a(){var m=f.getSelectionModel().getSelection();if(m.length>0){if(m.length>1){Ext.MessageBox.show({title:"提示",msg:"每次只能选择一条记录！",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING})}else{var l=[],j=[];for(var o=0,q=m.length;o<q;o++){l.push(m[o].get("id"));j.push(m[o].get("name"))}var n=j.toString();var p=l.toString();var k="R";var h=javafree.CONTEXTPATH+"/identity/membership/doEditMembershipForDeptRole";Ext.Ajax.request({url:h,method:"POST",scope:this,params:{current_memberids:current_memberids,fromType:k,selectedids:p,selectedNames:n},success:function(i){var r=Ext.JSON.decode(i.responseText);if(r.success==true){Ext.MessageBox.alert({title:"提示信息:",msg:r.info,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO,fn:function(){if(selectRoleParentWinGridPanel){selectRoleParentWinGridPanel.store.load()}}})}else{Ext.MessageBox.show({title:"错误提示:",msg:r.error,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}},failure:function(i){Ext.MessageBox.show({title:"系统提示信息:",msg:"与服务器端通讯失败,请与管理员联系!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING})}})}}}var g=Ext.create("Ext.selection.CheckboxModel",{columns:[{xtype:"checkcolumn",dataIndex:"id"}]});var f=Ext.create("Ext.grid.Panel",{title:"",tbar:b,selModel:g,multiSelect:true,forceFit:true,store:c,columns:[new Ext.grid.RowNumberer({header:"NO.",width:35}),{header:"角色名称",dataIndex:"name",width:"40%"},{header:"说明",width:220,sortable:true,dataIndex:"note"},{header:"次序号",dataIndex:"sn",sortable:true,align:"center",width:80}],bbar:{xtype:"pagingtoolbar",store:c,displayInfo:true,plugins:new Ext.ux.ProgressBarPager()}});if(selectRoleWin){selectRoleWin.removeAll();selectRoleWin.add(f)}});</script>