<%@ page contentType="text/html; charset=UTF-8"%><%@ include file="/WEB-INF/views/framework/common/taglibs.jsp"%><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>编辑文章信息</title></head><body><link rel="stylesheet" href="${pageContext.request.contextPath}/assets/plugins/fileupload/UploadPanel.css"/><script type="text/javascript" src="${pageContext.request.contextPath}/assets/plugins/fileupload/swfupload.js"></script><script type="text/javascript" src="${pageContext.request.contextPath}/assets/plugins/fileupload/UploadPanel.js"></script><script type="text/javascript">jQuery.metadata.setType("attr","validate");jQuery().ready(function(){jQuery("#article_form").validate()});function formSubmitSave(){$("#buttonType").val("1");$("#content").val(UE.getEditor("editor").getContent());var b="";$("input[name='categoryPath']").each(function(){b=$(this).val()});if(b!=""){}else{Ext.MessageBox.show({title:"错误提示:",msg:"所属栏目不能为空，请选择！",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return false}if(jQuery("#article_form").valid()){var a=function(d){var c=Ext.JSON.decode(d);if(c.success==true){Ext.MessageBox.alert({title:"提示信息:",msg:c.info,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO,fn:function(){}})}else{Ext.MessageBox.show({title:"错误提示:",msg:c.error,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};jQuery("#article_form").ajaxSubmit(a)}}function formSubmitSaveAdd(){$("#content").val(UE.getEditor("editor").getContent());$("#buttonType").val("1");var b="";$("input[name='categoryPath']").each(function(){b=$(this).val()});if(b!=""){}else{Ext.MessageBox.show({title:"错误提示:",msg:"所属栏目不能为空，请选择！",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return false}if(jQuery("#article_form").valid()){var a=function(d){var c=Ext.JSON.decode(d);if(c.success==true){Ext.MessageBox.alert({title:"提示信息:",msg:c.info,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO,fn:function(){var f=Ext.getCmp("${param.popupwinid}");if(f){f.removeAll();f.close()}var e=javafree.CONTEXTPATH+"/cms/admin/article/doGetArticle?parentWinGridPanelID=${param.parentWinGridPanelID}";javafree.CenterPanel.popupWindow(e,"新增文章信息",1200,600,true)}})}else{Ext.MessageBox.show({title:"错误提示:",msg:c.error,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};jQuery("#article_form").ajaxSubmit(a)}}function formClose(){var a=Ext.getCmp("${param.parentWinGridPanelID}");if(a){a.store.reload()}var b=Ext.getCmp("${param.popupwinid}");if(b){b.removeAll();b.close()}}var formttbar=[{pressed:false,cls:"x-btn-text-icon",icon:ICONPATH+"button/save_add.png",text:"保存并新增",handler:function(){formSubmitSaveAdd()}},"-",{pressed:false,cls:"x-btn-text-icon",icon:ICONPATH+"button/saved.png",text:"保存",handler:function(){formSubmitSave()}},"-",{pressed:false,cls:"x-btn-text-icon",icon:ICONPATH+"button/dialog-close.png",text:"关闭",handler:function(){formClose()}}];Ext.onReady(function(){Ext.QuickTips.init();var b=Ext.create("Ext.panel.Panel",{layout:"fit",items:[{title:"",border:false,bodyCls:"form_panel_body",autoScroll:true,contentEl:"article_form-main-content",tbar:formttbar,anchor:"98% 98%"}]});var a=Ext.getCmp("${param.popupwinid}");if(a){a.removeAll();a.add(b);a.doLayout()}else{javafree.CenterPanel.addCmp(b);javafree.CenterPanel.doLayout()}});</script><div id="article_form-main-content" class="main_from"><form:form id="article_form" modelAttribute="article" action="${pageContext.request.contextPath}/cms/admin/article/doEditArticle" method="post" enctype="multipart/form-data"><form:hidden path="id"/><form:hidden path="creatorid"/><form:hidden path="creator"/><form:hidden path="createDate"/><form:hidden path="contenttmpl"/><form:hidden path="categoryPath"/><form:hidden path="categoryName"/><form:hidden path="contentTypeName"/><form:hidden path="quoteId"/><input type="hidden" name="content" id="content"/><input type="hidden" name="buttonType" id="buttonType"/><div class="form_table_box" style="margin:0 auto; width:98%"><div class="form_table"><h2 class="form_title_head"><div class="tip"><span class="star">标注的为必填项</span></div> 编辑文章信息 </h2><table width="100%" border="0" cellspacing="0" cellpadding="0" class="form_table_blk_border"><tr><td class="form-TdField"><div class="col-xs-9"><div class="widget-body"><div class="row"><table width="100%" border="0" cellspacing="0" cellpadding="0" class="form_table_blk_none"><tr><td colspan="5"><form:input path="title" cssStyle="width:100%;font-size:18px;font-weight:bold" validate="{required:true}" placeholder="标题*" data-rel="tooltip" title="文章标题" data-placement="bottom"/></td></tr><tr><td width="35%"><form:input path="subtitle" cssStyle="width:96%;font-size:16px;" placeholder="简短标题" cssClass="form_input_ruler" data-rel="tooltip" title="文章简短标题" data-placement="bottom"/></td><td width="20%" nowrap="nowrap"><label>标题颜色：</label><input type="text" name="titleColor" value="${article.titleColor}" id="titleColor" style="width:55%;"/></td><td width="6%"><div id="colorSelector" style="float:left;"><div style="background-color: #0000ff"></div></div></td><td width="14%"><label><input name="titleBold" id="titleBold" value="${article.titleBold}" type="checkbox" class="ace"/><span class="lbl"> 标题加粗</span></label></td><td width="25%"><label><input name="islink" onclick="$('#linkUrl').toggle(this.checked);" id="islink" value="${article.islink}" type="checkbox" class="ace"/><span class="lbl"> 外部链接</span></label>&nbsp;&nbsp;&nbsp; <label><input name="titleImg" onclick="$('#titleImgTR').toggle(this.checked);" id="titleImg" value="${article.titleImg}" type="checkbox" class="ace"/><span class="lbl"> 有标题图</span></label></td></tr><tr id="linkUrl" style="display:none"><td colspan="5" nowrap="nowrap"><label>外部链接：</label><form:input path="link" cssStyle="width:90%;" validate="{url:true}" placeholder="链接URL*" data-rel="tooltip" title="链接URL" data-placement="bottom"/></td></tr><tr id="titleImgTR" style="display:none"><td nowrap="nowrap"><form:input path="titleImgURL" cssStyle="width:70%" placeholder="标题图URL" data-rel="tooltip" title="标题图URL" data-placement="bottom"/><button type="button" id="uploadImgBut" class="btn btn-sm btn-success" style="margin-bottom:7px;margin-top:3px"><i class="fa fa-upload bigger-125"></i> 选择图片 </button></td><td id="imgCut" colspan="4" nowrap="nowrap" style="display:none">&nbsp;&nbsp;<button type="button" id="viewImgBut" class="btn btn-sm" style="margin-bottom:7px;margin-top:3px"><i class="fa fa-eye bigger-125"></i> 查看图片 </button>&nbsp;&nbsp;&nbsp;<label>高:</label><form:input path="titleImgHeight" cssStyle="width:10%" validate="{digits:true}"/>&nbsp;<label>宽:</label><form:input path="titleImgWidth" cssStyle="width:10%" validate="{digits:true}"/>&nbsp;&nbsp;<button type="button" id="cutImgBut" class="btn btn-sm btn-danger" style="margin-bottom:7px;margin-top:3px"><i class="fa fa-scissors bigger-125"></i> 剪切图片 </button></td></tr><tr><td colspan="5"><textarea name="editor" id="editor">${article.content}</textarea></td></tr></table></div></div></div><div class="col-xs-3"><div class="widget-body"><div class="row" style="padding-left:10px;"><table width="100%" border="0" cellspacing="0" cellpadding="0" class="form_table_blk_none"><tr><td colspan="2"><label><span class="star">所属栏目:</span></label><div id="particle_combobox_id" class="Td-NoPadding"/></td></tr><tr><td colspan="2"><label>摘要：</label><form:textarea path="summary" cssClass="form-control limited" cssStyle="width:99%" maxlength="200"/></td></tr><tr><td colspan="2"><label>引用其它稿件内容：<span class="help-button" style="margin-bottom:2px;" data-rel="popover" data-trigger="hover" data-placement="right bottom" data-html="true" data-content="<dt>说明：</dt><dd>引用其它稿件内容,<br> 是引用稿件库中已经存在的其它稿件内容信息。 </dd>" >?</span></label><br/><form:input path="quoteTitle" readonly="true" cssStyle="width:70%" placeholder="请选择其它稿件" data-rel="tooltip" title="请选择其它稿件" data-placement="bottom"/><button type="button" id="selectContent" class="btn btn-sm btn-success" style="margin-bottom:7px;margin-top:3px"><i class="fa fa-search bigger-125"></i> 选择稿件 </button></td></tr><tr><td colspan="2"><label>Tag标签：<span class="help-button" style="margin-bottom:2px;" data-rel="popover" data-trigger="hover" data-placement="right bottom" data-html="true" data-content="<dt>说明：</dt><dd>关键字标签,<br> 当有多个词时用逗号分开。 </dd>" >?</span></label><br/><form:input path="tags" placeholder="有多个词时用,分开" cssStyle="width:99%"/></td></tr><tr><td colspan="2"><label>新闻来源:</label><br/><form:input path="origin" cssStyle="width:99%"/></td></tr><tr><td colspan="2"><label>来源URL:</label><br/><form:input path="originUrl" cssStyle="width:99%" validate="{url:true}"/></td></tr><tr><td width="50%"><label>责任编辑:</label><br/><form:input path="author" cssStyle="width:99%"/></td><td><label><span class="star">内容类型:</span></label><div id="contentType_combobox_id" class="Td-NoPadding"/></td></tr><tr><td width="50%"><label>固顶级别:<span class="help-button" style="margin-bottom:2px;" data-rel="popover" data-trigger="hover" data-placement="right bottom" data-html="true" data-content="<dt>说明：</dt><dd>固顶级别分8级,数字越大越靠前<br> 数值为0表示不固顶<br>固顶有期限限制。 </dd>" >?</span></label><br/><select name="topLevelForSelect" id="topLevelForSelect" style="width:99%"><option value="0" selected="selected">不固顶</option><option value="1">固顶1</option><option value="2">固顶2</option><option value="3">固顶3</option><option value="4">固顶4</option><option value="5">固顶5</option><option value="6">固顶6</option><option value="7">固顶7</option><option value="8">固顶8</option></select></td><td width="50%"><label>固顶有效期至:</label><br/><div id="topLevelDate_div" style="margin-top:4px;"></div></td></tr><tr><td colspan="2"><label>内容模板:<span class="help-button" style="margin-bottom:2px;" data-rel="popover" data-trigger="hover" data-placement="right bottom" data-html="true" data-content="<dt>说明：</dt><dd>显示时采用的模板文件<br> 如果不指定，则采用所属栏目的内容模板。<br>如果栏目也没有指定，则采用内容类型的显示模板 </dd>" >?</span></label><br/><div id="contenttmpl_combobox_id" class="Td-NoPadding"></td></tr></table></div></div></div></td></tr></table></div></div></form:form></div><script type="text/javascript">Ext.require(["Ext.form.field.ComboBox","Ext.window.MessageBox","Ext.form.FieldSet","Ext.tip.QuickTipManager","Ext.ux.TreePicker","Ext.data.*","Ext.form.DateField","Ext.form.field.File","Ext.form.field.Number","Ext.form.Panel","Ext.window.MessageBox"]);Ext.onReady(function(){Ext.create("Ext.ux.TreePicker",{renderTo:"particle_combobox_id",fieldLabel:"",emptyText:"请选择所属栏目..",width:"99%",labelWidth:10,margin:"0 0 0 0",displayField:"name",rootVisible:false,fieldStyle:"border-left: 0px!important;border-top: 0px!important;border-bottom: 0px!important;",value:"${article.categoryPath}",minPickerHeight:400,onLoad:function(){this.setValue("${article.categoryPath}");this.setRawValue("${article.categoryName}")},onItemClick:function(b,a,c,f,d){this.selectItem(a);if("root"!=a.get("path")){$("input[name='categoryPath']").each(function(){$(this).val(a.get("path"))});$("input[name='categoryName']").each(function(){$(this).val(a.get("name"))})}},store:Ext.create("Ext.data.TreeStore",{fields:["path","name"],root:{name:"根目录",expanded:true},proxy:{type:"ajax",url:javafree.CONTEXTPATH+"/cms/admin/category/doGetCategoryTreeJson",reader:{type:"json"}},folderSort:true,sorters:[{property:"sn",direction:"ASC"}]})});Ext.create("Ext.form.field.ComboBox",{fieldLabel:"",emptyText:"请选择内容类型..",renderTo:"contentType_combobox_id",displayField:"name",fieldStyle:"border-left: 0px!important;border-top: 0px!important;border-bottom: 0px!important;",valueField:"code",hiddenName:"contentTypeCode",value:"${article.contentTypeCode}",editable:true,autoSelect:true,allowBlank:false,blankText:"请选择",width:"100%",onLoad:function(){this.setRawValue("${article.contentTypeName}")},store:Ext.create("Ext.data.Store",{fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"code",type:"string"},{name:"sn",type:"int"}],pageSize:500,proxy:{type:"jsonp",enablePaging:true,url:javafree.CONTEXTPATH+"/cms/admin/contentType/doGetContentTypeGridJson",reader:{rootProperty:"rows",totalProperty:"total"},simpleSortMode:true},autoLoad:true,remoteSort:true,sorters:{property:"sn",direction:"ASC"}}),queryParam:"query",queryMode:"remote",forceSelection:true,listeners:{select:function(){Ext.getDom("contentTypeName").value=this.getDisplayValue()}},typeAhead:true});Ext.create("Ext.ux.TreePicker",{renderTo:"contenttmpl_combobox_id",fieldLabel:"",emptyText:"--默认模板--",width:"100%",labelWidth:10,margin:"0 0 0 0",displayField:"name",rootVisible:false,fieldStyle:"border-left: 0px!important;border-top: 0px!important;border-bottom: 0px!important;",value:"${article.contenttmpl}",minPickerHeight:400,onLoad:function(){this.setRawValue("${article.contenttmpl}")},onItemClick:function(b,a,c,f,d){if(a.isLeaf()){this.selectItem(a);if("root"!=a.get("id")){Ext.getDom("contenttmpl").value=a.get("filePath");this.setRawValue(a.get("filePath"))}}else{Ext.MessageBox.show({title:"错误提示:",msg:"只能选择文件,不能选择文件夹！",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}},store:Ext.create("Ext.data.TreeStore",{fields:["id","name","filePath"],root:{name:"文件根目录",expanded:true,},proxy:{type:"ajax",url:javafree.CONTEXTPATH+"/cms/admin/template/doGetTemplateTreeJsonForSelect",reader:{type:"json"}},folderSort:true,sorters:[{property:"fileName",direction:"ASC"}]})});Ext.create("Ext.form.field.ComboBox",{typeAhead:true,fieldStyle:"border-left: 0px!important;border-top: 0px!important;border-bottom: 0px!important;",transform:"topLevelForSelect",width:"100%",value:"${article.topLevel}",hiddenName:"topLevel",editable:true,autoSelect:true,allowBlank:false,blankText:"请选择",forceSelection:true});if("${article.topLevelDate}"!=""){Ext.create("Ext.form.DateField",{typeAhead:true,editable:true,fieldStyle:"border-left: 0px!important;border-top: 0px!important;border-bottom: 0px!important;",renderTo:"topLevelDate_div",format:"Y-m-d H:i:s",name:"topLevelDate",value:new Date("${article.topLevelDate}"),width:"100%"})}else{Ext.create("Ext.form.DateField",{typeAhead:true,editable:true,fieldStyle:"border-left: 0px!important;border-top: 0px!important;border-bottom: 0px!important;",renderTo:"topLevelDate_div",format:"Y-m-d H:i:s",name:"topLevelDate",width:"100%"})}});$(document).ready(function(){UE.delEditor("editor");var a=UE.getEditor("editor",{initialFrameHeight:400,initialFrameWidth:"100%"});a.addshortcutkey({snapscreen:"ctrl+shift+65"});if($("#titleBold").val()=="1"){$("#titleBold").prop("checked",true)}else{$("#titleBold").prop("checked",false)}$("#titleBold").on("click",function(){if(this.checked){$("#titleBold").val("1")}else{$("#titleBold").val("0")}});if($("#islink").val()=="1"){$("#islink").prop("checked",true);$("#linkUrl").toggle(true)}else{$("#islink").prop("checked",false);$("#linkUrl").toggle(false)}$("#islink").on("click",function(){if(this.checked){$("#islink").val("1")}else{$("#islink").val("0")}});if($("#titleImg").val()=="1"){$("#titleImg").prop("checked",true);$("#titleImgTR").toggle(true);$("#imgCut").toggle(true)}else{$("#titleImg").prop("checked",false);$("#titleImgTR").toggle(false)}$("#titleImg").on("click",function(){if(this.checked){$("#titleImg").val("1")}else{$("#titleImg").val("0")}});$("#colorSelector div").css("backgroundColor",$("#titleColor").val()==""?"#ff00ff":$("#titleColor").val());$("#colorSelector").ColorPicker({color:"#0000ff",onShow:function(b){$(b).fadeIn(500);return false},onHide:function(b){$(b).fadeOut(500);return false},onChange:function(b,d,c){$("#titleColor").val("#"+d);$("#colorSelector div").css("backgroundColor","#"+d)}});$("[data-rel=popover]").popover();$("[data-rel=tooltip]").tooltip({container:"body"});$("#viewImgBut").click(function(){var c=$("#titleImgURL").val();if(c!=""){var b=javafree.CONTEXTPATH+c;$.fancybox.open(b)}});$("#cutImgBut").click(function(){var b=javafree.CONTEXTPATH+"/cms/admin/imagecut/doGetImagecut?imageurl="+$("#titleImgURL").val()+"&callbackFn=cutImgFn";javafree.CenterPanel.popupWindow(b,"剪切标题图片")});$("#selectContent").click(function(){var b=javafree.CONTEXTPATH+"/cms/admin/content/doGetSelectContentList?callbackFn=selectContentFn";javafree.CenterPanel.popupWindow(b,"选择引用稿件",800,500)});$("#uploadImgBut").click(function(){var c=javafree.CONTEXTPATH+"/cms/admin/imagecut/uploadImgFile";var b=Ext.create("Javafree.FileUploadWindow",{file_size_limit:10000,file_types:"*.jpg;*.jpeg;*.gif;*.png;*.bmp",file_upload_limit:1,file_queue_limit:1,upload_url:c,callbackFunc:function(){if(this.savedpath[0]&&this.savedpath[0]!=""){$("#titleImgURL").val(this.savedpath[0]);$("#imgCut").toggle(true);var e=javafree.CONTEXTPATH+this.savedpath[0];var d=new Image();d.src=e;d.onload=function(){$("#titleImgWidth").val(d.width);$("#titleImgHeight").val(d.height)}}}});b.show()})});function cutImgFn(a){$("#titleImgURL").val(a);var c=javafree.CONTEXTPATH+a;var b=new Image();b.src=c;b.onload=function(){$("#titleImgWidth").val(b.width);$("#titleImgHeight").val(b.height)}}function selectContentFn(b,a){$("#quoteId").val(b);$("#quoteTitle").val(a)};</script></body></html>