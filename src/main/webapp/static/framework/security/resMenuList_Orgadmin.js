Ext.require(["Ext.data.*","Ext.grid.*","Ext.tree.*","Ext.form.ComboBox","Ext.util.*","Ext.grid.plugin.BufferedRenderer","Ext.toolbar.Paging","Ext.ux.ProgressBarPager","Ext.ux.form.SearchField","Ext.ux.CheckColumn","Ext.tab.*"]);var ICONPATH=javafree.CONTEXTPATH+"/assets/images/";Ext.onReady(function(){var v=50;
var e="";var f=javafree.CONTEXTPATH+"/security/resource/doGetMemuRecourceTreeJson";var s=Ext.create("Ext.data.TreeStore",{fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"note",type:"string"},{name:"description",type:"string"},{name:"url",type:"string"},{name:"type",type:"string"},{name:"reg_src",type:"string"},{name:"tagettype",type:"string"},{name:"iconcls",type:"string"},{name:"childreCount",type:"int"},{name:"sn",type:"int"}],proxy:{type:"ajax",url:f},folderSort:false});
s.sort({property:"sn",direction:"ASC"},"prepend",false);var m={doSelect_auth_fn:function(){var F=w.getSelectionModel().getSelection();if(F.length>0){var E=[];for(var H=0,D=F.length;H<D;H++){E.push(F[H].get("id"));}var G=javafree.CONTEXTPATH+"/security/resource/doGetSelectAuthList?parentWinGridPanelID_user="+z.getId()+"&parentWinGridPanelID_role="+t.getId()+"&parentWinGridPanelID_dept="+p.getId()+"&parentWinGridPanelID_group="+B.getId()+"&parentWinGridPanelID_tab="+r.getId()+"&current_resids="+E.toString();
javafree.CenterPanel.popupWindow(G,"选择授权对象",800,580);}else{Ext.MessageBox.show({title:"错误提示:",msg:"请您先选中将要分配的菜单项!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING});}}};var o=[{pressed:false,cls:"x-btn-text-icon",icon:ICONPATH+"button/ns-expand.png",text:"全部展开",scope:this,handler:function(){w.getEl().mask("正在展开...");
w.expandAll(function(){w.getEl().unmask();});}},{pressed:false,cls:"x-btn-text-icon",icon:ICONPATH+"button/ns-collapse.png",text:"全部折叠",handler:function(){w.collapseAll();}},{width:150,fieldLabel:"",emptyText:"菜单名称...",labelWidth:0,xtype:"searchfield",fieldStyle:"border-left: 0px!important;border-top: 0px!important;border-bottom: 0px!important;",store:s},{pressed:false,icon:ICONPATH+"button/group_key.png",cls:"x-btn-text-icon",text:"选择授权对象",handler:function(){m.doSelect_auth_fn();
}}];var A=Ext.create("Ext.selection.CheckboxModel",{columns:[{xtype:"checkcolumn",dataIndex:"id"}]});function i(E,F,D){E=D.get("reg_src");if("IPNUT"==D.get("reg_src")){return"手工录入";}else{return"系统配置";}}var w=Ext.create("Ext.tree.Panel",{title:"",tbar:o,useArrows:false,rootVisible:false,store:s,selModel:A,multiSelect:true,forceFit:true,columns:[new Ext.grid.RowNumberer({header:"NO.",width:35}),{xtype:"treecolumn",text:"菜单名称",width:180,sortable:true,dataIndex:"note"},{text:"菜单URL",width:240,sortable:true,hidden:true,dataIndex:"url"},{text:"数据来源",width:45,sortable:true,dataIndex:"reg_src",hidden:true,renderer:i},{text:"说明",width:100,sortable:true,dataIndex:"description",hidden:true},{text:"跳转方式",width:100,sortable:true,dataIndex:"tagettype",hidden:true},{text:"图标样式",width:100,sortable:true,dataIndex:"iconcls",hidden:true},{text:"编码",width:100,sortable:true,dataIndex:"code",hidden:true},{text:"次序号",width:70,sortable:true,align:"center",dataIndex:"sn",hidden:true}],listeners:{"itemclick":function(E,D,H,F,I,G){e=D.data.id;
Ext.apply(l.proxy.extraParams,{"resourceid":D.data.id});l.load({callback:function(K,J,M){if(M){var L=0;r.items.each(function(N){++L;if(L==1){N.setTitle("用户("+K.length+")");}});}}});Ext.apply(b.proxy.extraParams,{"resourceid":D.data.id});b.load({callback:function(K,J,M){if(M){var L=0;r.items.each(function(N){++L;
if(L==2){N.setTitle("机构/部门("+K.length+")");}});}}});Ext.apply(a.proxy.extraParams,{"resourceid":D.data.id});a.load({callback:function(K,J,M){if(M){var L=0;r.items.each(function(N){++L;if(L==3){N.setTitle("角色("+K.length+")");}});}}});Ext.apply(y.proxy.extraParams,{"resourceid":D.data.id});y.load({callback:function(K,J,M){if(M){var L=0;
r.items.each(function(N){++L;if(L==4){N.setTitle("组群("+K.length+")");}});}}});}}});var d={doDelResOrgcode:function(J,E){var F=J.getSelectionModel().getSelection();if(F.length>0){var F=J.getSelectionModel().getSelection();var I=[];for(var H=0,D=F.length;H<D;H++){I.push(F[H].get("id"));}var G=javafree.CONTEXTPATH+"/security/resourceorg/doDelResOrg?IDS="+I.toString();
this.doPostRequest(G,J,E);}else{Ext.MessageBox.show({title:"错误提示:",msg:"请您选中要删除的菜单项!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING});}},doDelResAuth:function(J,E){var F=J.getSelectionModel().getSelection();if(F.length>0){var F=J.getSelectionModel().getSelection();var I=[];for(var H=0,D=F.length;
H<D;H++){I.push(F[H].get("id"));}var G=javafree.CONTEXTPATH+"/security/resourceauth/doDelResAuth?IDS="+I.toString();this.doPostRequest(G,J,E);}else{Ext.MessageBox.show({title:"错误提示:",msg:"请您选中要删除的菜单项!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING});}},doPostRequest:function(E,F,D){Ext.Ajax.request({url:E,method:"POST",scope:this,success:function(G){var H=Ext.JSON.decode(G.responseText);
if(H.success==true){Ext.MessageBox.alert({title:"提示信息:",msg:H.info,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO,fn:function(){F.store.load({callback:function(J,I,L){if(L){var K=0;r.items.each(function(M){++K;if(K==D){if(K==1){M.setTitle("用户("+J.length+")");}if(K==2){M.setTitle("机构/部门("+J.length+")");
}if(K==3){M.setTitle("角色("+J.length+")");}if(K==4){M.setTitle("组群("+J.length+")");}if(K==5){M.setTitle("机构编码("+J.length+")");}}});}}});}});}else{Ext.MessageBox.show({title:"错误提示:",msg:H.error,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});}},failure:function(G){Ext.MessageBox.show({title:"系统提示信息:",msg:"与服务器端通讯失败,请与管理员联系!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING});
}});}};var x=javafree.CONTEXTPATH+"/security/resourceauth/doGetResAuthGridJson";var l=Ext.create("Ext.data.Store",{fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"fromType",type:"string"},{name:"authority_name",type:"string"},{name:"orgcode",type:"string"},{name:"creator",type:"string"},{name:"createDate",type:"string"}],pageSize:v,proxy:{type:"jsonp",enablePaging:true,url:x+"?fromType=U",reader:{rootProperty:"rows",totalProperty:"total"},simpleSortMode:true},autoLoad:false,remoteSort:true,sorters:{property:"name",direction:"ASC"}});
var j=[{width:200,fieldLabel:"查询",emptyText:"用户名称...",labelWidth:30,xtype:"searchfield",fieldStyle:"border-left: 0px!important;border-top: 0px!important;border-bottom: 0px!important;",store:l},{pressed:false,cls:"x-btn-text-icon",icon:ICONPATH+"button/delete.png",text:"删除授权用户",handler:function(){d.doDelResAuth(z,1);
}}];var k=Ext.create("Ext.selection.CheckboxModel",{columns:[{xtype:"checkcolumn",dataIndex:"id"}]});var z=Ext.create("Ext.grid.Panel",{title:"",tbar:j,selModel:k,multiSelect:true,forceFit:true,store:l,columns:[new Ext.grid.RowNumberer({header:"NO.",width:35}),{header:"用户名称",dataIndex:"name",width:200},{header:"机构编码",width:180,sortable:true,dataIndex:"orgcode"},{header:"操作人",width:80,sortable:true,dataIndex:"creator"}],bbar:{xtype:"pagingtoolbar",store:l,displayInfo:true,plugins:new Ext.ux.ProgressBarPager()}});
var b=Ext.create("Ext.data.Store",{fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"fromType",type:"string"},{name:"authority_name",type:"string"},{name:"orgcode",type:"string"},{name:"creator",type:"string"},{name:"createDate",type:"string"}],pageSize:v,proxy:{type:"jsonp",enablePaging:true,url:x+"?fromType=D",reader:{rootProperty:"rows",totalProperty:"total"},simpleSortMode:true},autoLoad:false,remoteSort:true,sorters:{property:"name",direction:"ASC"}});
var c=[{width:200,fieldLabel:"查询",emptyText:"机构名称...",labelWidth:30,xtype:"searchfield",fieldStyle:"border-left: 0px!important;border-top: 0px!important;border-bottom: 0px!important;",store:b},{pressed:false,cls:"x-btn-text-icon",icon:ICONPATH+"button/delete.png",text:"删除授权部门",handler:function(){d.doDelResAuth(p,2);
}}];var C=Ext.create("Ext.selection.CheckboxModel",{columns:[{xtype:"checkcolumn",dataIndex:"id"}]});var p=Ext.create("Ext.grid.Panel",{title:"",tbar:c,selModel:C,multiSelect:true,forceFit:true,store:b,columns:[new Ext.grid.RowNumberer({header:"NO.",width:35}),{header:"机构名称",dataIndex:"name",width:200},{header:"机构编码",width:180,sortable:true,dataIndex:"orgcode"},{header:"操作人",width:80,sortable:true,dataIndex:"creator"}],bbar:{xtype:"pagingtoolbar",store:b,displayInfo:true,plugins:new Ext.ux.ProgressBarPager()}});
var a=Ext.create("Ext.data.Store",{fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"fromType",type:"string"},{name:"authority_name",type:"string"},{name:"orgcode",type:"string"},{name:"creator",type:"string"},{name:"createDate",type:"string"}],pageSize:v,proxy:{type:"jsonp",enablePaging:true,url:x+"?fromType=R",reader:{rootProperty:"rows",totalProperty:"total"},simpleSortMode:true},autoLoad:false,remoteSort:true,sorters:{property:"name",direction:"ASC"}});
var n=[{width:200,fieldLabel:"查询",emptyText:"角色名称...",labelWidth:30,xtype:"searchfield",fieldStyle:"border-left: 0px!important;border-top: 0px!important;border-bottom: 0px!important;",store:a},{pressed:false,cls:"x-btn-text-icon",icon:ICONPATH+"button/delete.png",text:"删除授权角色",handler:function(){d.doDelResAuth(t,3);
}}];var g=Ext.create("Ext.selection.CheckboxModel",{columns:[{xtype:"checkcolumn",dataIndex:"id"}]});var t=Ext.create("Ext.grid.Panel",{title:"",tbar:n,selModel:g,multiSelect:true,forceFit:true,store:a,columns:[new Ext.grid.RowNumberer({header:"NO.",width:35}),{header:"角色名称",dataIndex:"name",width:200},{header:"机构编码",width:180,sortable:true,dataIndex:"orgcode"},{header:"操作人",width:80,sortable:true,dataIndex:"creator"}],bbar:{xtype:"pagingtoolbar",store:a,displayInfo:true,plugins:new Ext.ux.ProgressBarPager()}});
var y=Ext.create("Ext.data.Store",{fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"fromType",type:"string"},{name:"authority_name",type:"string"},{name:"orgcode",type:"string"},{name:"creator",type:"string"},{name:"createDate",type:"string"}],pageSize:v,proxy:{type:"jsonp",enablePaging:true,url:x+"?fromType=G",reader:{rootProperty:"rows",totalProperty:"total"},simpleSortMode:true},autoLoad:false,remoteSort:true,sorters:{property:"name",direction:"ASC"}});
var u=[{width:200,fieldLabel:"查询",emptyText:"组群名称...",labelWidth:30,xtype:"searchfield",fieldStyle:"border-left: 0px!important;border-top: 0px!important;border-bottom: 0px!important;",store:y},{pressed:false,cls:"x-btn-text-icon",icon:ICONPATH+"button/delete.png",text:"删除授权群组",handler:function(){d.doDelResAuth(B,4);
}}];var h=Ext.create("Ext.selection.CheckboxModel",{columns:[{xtype:"checkcolumn",dataIndex:"id"}]});var B=Ext.create("Ext.grid.Panel",{title:"",tbar:u,selModel:h,multiSelect:true,forceFit:true,store:y,columns:[new Ext.grid.RowNumberer({header:"NO.",width:35}),{header:"组群名称",dataIndex:"name",width:200},{header:"机构编码",width:180,sortable:true,dataIndex:"orgcode"},{header:"操作人",width:80,sortable:true,dataIndex:"creator"}],bbar:{xtype:"pagingtoolbar",store:y,displayInfo:true,plugins:new Ext.ux.ProgressBarPager()}});
var r=Ext.widget("tabpanel",{activeTab:0,tabPosition:"top",items:[{title:"用户",iconCls:"btn-icon-md  orange2 fa fa-user",layout:"fit",items:z},{title:"机构/部门",iconCls:"btn-icon-md orange2 fa fa-sitemap",layout:"fit",items:p},{title:"角色",iconCls:"btn-icon-md orange2 fa fa-child",layout:"fit",items:t},{title:"组群",iconCls:"btn-icon-md orange2 fa fa-users",layout:"fit",items:B}]});
var q=Ext.create("Ext.panel.Panel",{layout:{type:"border"},style:{borderBottom:"1px solid #cecece"},defaults:{split:true},items:[{region:"west",split:true,width:"60%",border:false,minWidth:400,maxSize:900,autoScroll:true,layout:"fit",items:w},{region:"center",width:"40%",border:false,minWidth:300,maxSize:800,split:true,autoScroll:true,layout:"fit",floatable:true,items:r}]});
javafree.CenterPanel.addCmp(q);});